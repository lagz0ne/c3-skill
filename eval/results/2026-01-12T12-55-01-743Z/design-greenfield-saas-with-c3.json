{
  "name": "Design greenfield SaaS with C3",
  "pass": true,
  "score": 100,
  "duration": 460287,
  "trace": [
    {
      "timestamp": "2026-01-12T12:42:11.573Z",
      "event": "PreToolUse",
      "tool": "Skill",
      "input": {
        "skill": "c3-skill:onboard"
      }
    },
    {
      "timestamp": "2026-01-12T12:42:11.740Z",
      "event": "PostToolUse",
      "tool": "Skill",
      "input": {
        "skill": "c3-skill:onboard"
      },
      "result": {
        "success": true,
        "commandName": "c3-skill:onboard",
        "allowedTools": [
          "Bash(rm:*)",
          "Bash(test:*)",
          "Bash(PROJECT=*)",
          "Read",
          "Glob",
          "Grep",
          "Write",
          "Edit",
          "AskUserQuestion",
          "Skill"
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:42:17.125Z",
      "event": "PreToolUse",
      "tool": "Bash",
      "input": {
        "command": "pwd && ls -la",
        "description": "Check current directory structure"
      }
    },
    {
      "timestamp": "2026-01-12T12:42:17.148Z",
      "event": "PostToolUse",
      "tool": "Bash",
      "input": {
        "command": "pwd && ls -la",
        "description": "Check current directory structure"
      },
      "result": {
        "stdout": "/tmp/tmp.ePSVRl4JKW",
        "stderr": "",
        "interrupted": false,
        "isImage": false
      }
    },
    {
      "timestamp": "2026-01-12T12:42:22.296Z",
      "event": "PreToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "in_progress",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "pending",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:42:22.305Z",
      "event": "PostToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "in_progress",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "pending",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      },
      "result": {
        "oldTodos": [],
        "newTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "in_progress",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "pending",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:42:24.884Z",
      "event": "PreToolUse",
      "tool": "Bash",
      "input": {
        "command": "mkdir -p .c3/refs",
        "description": "Create C3 directory structure"
      }
    },
    {
      "timestamp": "2026-01-12T12:42:24.906Z",
      "event": "PostToolUse",
      "tool": "Bash",
      "input": {
        "command": "mkdir -p .c3/refs",
        "description": "Create C3 directory structure"
      },
      "result": {
        "stdout": "",
        "stderr": "",
        "interrupted": false,
        "isImage": false
      }
    },
    {
      "timestamp": "2026-01-12T12:42:27.974Z",
      "event": "PreToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "in_progress",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:42:27.982Z",
      "event": "PostToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "in_progress",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      },
      "result": {
        "oldTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "in_progress",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "pending",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ],
        "newTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "in_progress",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:43:21.683Z",
      "event": "PreToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/adr-000-initial-architecture.md",
        "content": "# ADR-000: TaskFlow Initial Architecture\n\n## Status\nACCEPTED\n\n## Date\n2026-01-12\n\n## Context\n\nTaskFlow is a task management SaaS platform designed for small teams. The system needs to support:\n- Real-time collaboration on task boards\n- Multi-tenant architecture with team workspaces\n- Web application with future mobile API support\n- Scalable architecture that can evolve from monolith to microservices\n\n### Business Requirements\n- Team-based task management with workspaces\n- Real-time updates when team members modify tasks\n- Google OAuth for seamless authentication\n- Responsive web interface with potential mobile apps\n\n### Technical Constraints\n- Small team, need to ship fast\n- Must support real-time collaboration\n- Need to scale to thousands of teams\n\n## Decision\n\n### Overall Architecture: Modular Monolith\nWe adopt a **modular monolith** architecture that provides clear boundaries between domains while maintaining deployment simplicity. This allows future extraction to microservices if needed.\n\n### Technology Stack\n\n| Layer | Technology | Rationale |\n|-------|------------|-----------|\n| Frontend | React SPA (TypeScript) | Modern component architecture, large ecosystem |\n| API Gateway | Express.js (TypeScript) | Lightweight, flexible, excellent middleware support |\n| Backend | Node.js (TypeScript) | Shared language with frontend, strong async support |\n| Database | PostgreSQL | ACID compliance, excellent for relational data |\n| Cache | Redis | High-performance caching + pub/sub for real-time |\n| Real-time | WebSocket (Socket.IO) | Bidirectional communication for collaboration |\n| Auth | Google OAuth + JWT | Delegated auth reduces security burden |\n\n### System Boundaries (C3 Context)\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│                         TASKFLOW SYSTEM                          │\n│  ┌─────────────┐  ┌──────────────┐  ┌─────────────────────────┐ │\n│  │   Web App   │  │  API Server  │  │  Background Workers     │ │\n│  │  (React)    │──│  (Express)   │──│  (Notifications, etc.)  │ │\n│  └─────────────┘  └──────────────┘  └─────────────────────────┘ │\n│         │                │                      │                │\n│         └────────────────┼──────────────────────┘                │\n│                          ▼                                       │\n│              ┌──────────────────────┐                           │\n│              │  PostgreSQL + Redis  │                           │\n│              └──────────────────────┘                           │\n└─────────────────────────────────────────────────────────────────┘\n         │                    │                    │\n         ▼                    ▼                    ▼\n   ┌──────────┐        ┌──────────────┐     ┌───────────┐\n   │  Users   │        │ Google OAuth │     │  Email    │\n   │ (Teams)  │        │   Provider   │     │  Service  │\n   └──────────┘        └──────────────┘     └───────────┘\n```\n\n### Container Architecture (Deployable Units)\n\n| Container | ID | Purpose | Technology |\n|-----------|-----|---------|------------|\n| Web Application | c3-web | User interface | React + TypeScript |\n| API Server | c3-api | REST + WebSocket API | Express + Socket.IO |\n| Background Workers | c3-workers | Async jobs | Bull + Redis |\n| PostgreSQL | c3-db | Primary data store | PostgreSQL 15 |\n| Redis | c3-cache | Cache + Pub/Sub | Redis 7 |\n\n### Module Architecture (Within API Server)\n\nThe modular monolith is organized into **Foundation Modules** (cross-cutting) and **Feature Modules** (domain-specific):\n\n#### Foundation Modules\n| Module | ID | Responsibility |\n|--------|-----|----------------|\n| Auth | c3-auth | Authentication, OAuth, JWT, sessions |\n| Tenancy | c3-tenancy | Multi-tenant isolation, workspace context |\n| Real-time | c3-realtime | WebSocket connections, pub/sub |\n| Database | c3-database | Connection pooling, migrations, transactions |\n| Cache | c3-cache-module | Redis client, caching strategies |\n\n#### Feature Modules\n| Module | ID | Responsibility |\n|--------|-----|----------------|\n| Users | c3-users | User profiles, preferences |\n| Workspaces | c3-workspaces | Team workspaces, membership |\n| Boards | c3-boards | Task boards, columns |\n| Tasks | c3-tasks | Task CRUD, assignments, due dates |\n| Comments | c3-comments | Task comments, @mentions |\n| Notifications | c3-notifications | In-app + email notifications |\n\n### Data Architecture\n\n#### Multi-Tenancy Strategy\n- **Shared database, shared schema** with `workspace_id` foreign key\n- Row-level security policies in PostgreSQL\n- Middleware enforces tenant context on every request\n\n#### Key Entities\n```\nWorkspace (tenant boundary)\n├── Members (users in workspace)\n├── Boards\n│   ├── Columns\n│   └── Tasks\n│       ├── Assignees\n│       ├── Labels\n│       └── Comments\n└── Invitations\n```\n\n### Real-time Architecture\n\n```\nClient A                    Server                    Client B\n   │                          │                          │\n   │──[task.update]──────────▶│                          │\n   │                          │──[validate + save]       │\n   │                          │──[Redis PUBLISH]─────────│\n   │                          │                          │\n   │                          │◀─[Redis SUBSCRIBE]───────│\n   │                          │                          │\n   │                          │──[task.updated]─────────▶│\n   │◀─[task.updated]──────────│                          │\n```\n\n- Socket.IO rooms per board for efficient broadcasting\n- Redis pub/sub for multi-instance WebSocket scaling\n- Optimistic updates on client with server reconciliation\n\n### Authentication Flow\n\n```\n┌────────┐      ┌───────────┐      ┌──────────────┐\n│ Client │──1──▶│ API Server│──2──▶│ Google OAuth │\n│        │◀─5───│           │◀─3───│              │\n└────────┘      └───────────┘      └──────────────┘\n                     │ 4\n                     ▼\n               ┌──────────┐\n               │ Database │\n               │ (user +  │\n               │ session) │\n               └──────────┘\n\n1. Redirect to /auth/google\n2. Redirect to Google consent\n3. OAuth callback with code\n4. Create/update user, issue JWT\n5. Return JWT + redirect to app\n```\n\n### API Design Principles\n\n1. **RESTful Resources**: Standard CRUD operations\n2. **Workspace Scoping**: `/api/workspaces/:workspaceId/boards/:boardId`\n3. **Consistent Response Format**: `{ data, error, meta }`\n4. **Pagination**: Cursor-based for large collections\n5. **Versioning**: URL prefix `/api/v1/`\n\n### Directory Structure\n\n```\ntaskflow/\n├── apps/\n│   ├── web/                    # React SPA\n│   │   ├── src/\n│   │   │   ├── components/     # Shared UI components\n│   │   │   ├── features/       # Feature-based organization\n│   │   │   ├── hooks/          # Custom React hooks\n│   │   │   ├── lib/            # Utilities, API client\n│   │   │   └── stores/         # State management\n│   │   └── package.json\n│   │\n│   └── api/                    # Express API server\n│       ├── src/\n│       │   ├── foundation/     # Cross-cutting modules\n│       │   │   ├── auth/\n│       │   │   ├── database/\n│       │   │   ├── cache/\n│       │   │   ├── realtime/\n│       │   │   └── tenancy/\n│       │   ├── features/       # Domain modules\n│       │   │   ├── users/\n│       │   │   ├── workspaces/\n│       │   │   ├── boards/\n│       │   │   ├── tasks/\n│       │   │   ├── comments/\n│       │   │   └── notifications/\n│       │   ├── shared/         # Shared utilities\n│       │   └── main.ts         # Entry point\n│       └── package.json\n│\n├── packages/                   # Shared packages\n│   ├── types/                  # Shared TypeScript types\n│   └── validation/             # Shared validation schemas\n│\n├── infrastructure/             # Docker, K8s configs\n├── .c3/                        # Architecture docs\n└── package.json                # Monorepo root\n```\n\n### Module Dependencies\n\n```\n                    ┌─────────────┐\n                    │   Tenancy   │\n                    └──────┬──────┘\n                           │\n        ┌──────────────────┼──────────────────┐\n        ▼                  ▼                  ▼\n   ┌─────────┐       ┌──────────┐       ┌──────────┐\n   │  Auth   │       │ Database │       │  Cache   │\n   └────┬────┘       └────┬─────┘       └────┬─────┘\n        │                 │                  │\n        └─────────────────┼──────────────────┘\n                          ▼\n                    ┌──────────┐\n                    │ Realtime │\n                    └────┬─────┘\n                         │\n    ┌────────────────────┼────────────────────┐\n    ▼          ▼         ▼         ▼          ▼\n┌───────┐ ┌────────┐ ┌──────┐ ┌────────┐ ┌──────────┐\n│ Users │ │Workspaces│ │Boards│ │ Tasks  │ │Notifications│\n└───────┘ └────────┘ └──────┘ └────────┘ └──────────┘\n```\n\nFoundation modules are imported by feature modules, never the reverse.\nFeature modules may have controlled dependencies (e.g., Tasks → Boards).\n\n## Consequences\n\n### Positive\n- **Fast initial development**: Single deployable unit\n- **Clear boundaries**: Modular structure enables future splitting\n- **Real-time native**: WebSocket architecture from day one\n- **Type safety**: TypeScript end-to-end\n- **Scalable**: Redis pub/sub enables horizontal scaling\n\n### Negative\n- **Monorepo complexity**: Need good tooling (pnpm/turborepo)\n- **Shared database bottleneck**: May need sharding at scale\n- **WebSocket state**: Sticky sessions or Redis coordination needed\n\n### Risks\n- **Module coupling**: Discipline required to maintain boundaries\n- **Real-time complexity**: Conflict resolution for concurrent edits\n\n## Implementation Phases\n\n### Phase 1: Foundation (Week 1-2)\n- [ ] Project scaffolding (monorepo setup)\n- [ ] Database schema and migrations\n- [ ] Auth module with Google OAuth\n- [ ] Tenancy middleware\n\n### Phase 2: Core Features (Week 3-4)\n- [ ] Workspaces CRUD\n- [ ] Boards and columns\n- [ ] Tasks with drag-and-drop\n\n### Phase 3: Collaboration (Week 5-6)\n- [ ] Real-time sync with WebSocket\n- [ ] Comments and @mentions\n- [ ] Notifications\n\n### Phase 4: Polish (Week 7-8)\n- [ ] Activity feeds\n- [ ] Search functionality\n- [ ] Performance optimization\n\n## References\n\n- C3 Architecture: `.c3/c3-architecture.md`\n- API Contracts: `.c3/refs/api-contracts.md`\n- Database Schema: `.c3/refs/database-schema.md`\n"
      }
    },
    {
      "timestamp": "2026-01-12T12:43:21.714Z",
      "event": "PostToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/adr-000-initial-architecture.md",
        "content": "# ADR-000: TaskFlow Initial Architecture\n\n## Status\nACCEPTED\n\n## Date\n2026-01-12\n\n## Context\n\nTaskFlow is a task management SaaS platform designed for small teams. The system needs to support:\n- Real-time collaboration on task boards\n- Multi-tenant architecture with team workspaces\n- Web application with future mobile API support\n- Scalable architecture that can evolve from monolith to microservices\n\n### Business Requirements\n- Team-based task management with workspaces\n- Real-time updates when team members modify tasks\n- Google OAuth for seamless authentication\n- Responsive web interface with potential mobile apps\n\n### Technical Constraints\n- Small team, need to ship fast\n- Must support real-time collaboration\n- Need to scale to thousands of teams\n\n## Decision\n\n### Overall Architecture: Modular Monolith\nWe adopt a **modular monolith** architecture that provides clear boundaries between domains while maintaining deployment simplicity. This allows future extraction to microservices if needed.\n\n### Technology Stack\n\n| Layer | Technology | Rationale |\n|-------|------------|-----------|\n| Frontend | React SPA (TypeScript) | Modern component architecture, large ecosystem |\n| API Gateway | Express.js (TypeScript) | Lightweight, flexible, excellent middleware support |\n| Backend | Node.js (TypeScript) | Shared language with frontend, strong async support |\n| Database | PostgreSQL | ACID compliance, excellent for relational data |\n| Cache | Redis | High-performance caching + pub/sub for real-time |\n| Real-time | WebSocket (Socket.IO) | Bidirectional communication for collaboration |\n| Auth | Google OAuth + JWT | Delegated auth reduces security burden |\n\n### System Boundaries (C3 Context)\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│                         TASKFLOW SYSTEM                          │\n│  ┌─────────────┐  ┌──────────────┐  ┌─────────────────────────┐ │\n│  │   Web App   │  │  API Server  │  │  Background Workers     │ │\n│  │  (React)    │──│  (Express)   │──│  (Notifications, etc.)  │ │\n│  └─────────────┘  └──────────────┘  └─────────────────────────┘ │\n│         │                │                      │                │\n│         └────────────────┼──────────────────────┘                │\n│                          ▼                                       │\n│              ┌──────────────────────┐                           │\n│              │  PostgreSQL + Redis  │                           │\n│              └──────────────────────┘                           │\n└─────────────────────────────────────────────────────────────────┘\n         │                    │                    │\n         ▼                    ▼                    ▼\n   ┌──────────┐        ┌──────────────┐     ┌───────────┐\n   │  Users   │        │ Google OAuth │     │  Email    │\n   │ (Teams)  │        │   Provider   │     │  Service  │\n   └──────────┘        └──────────────┘     └───────────┘\n```\n\n### Container Architecture (Deployable Units)\n\n| Container | ID | Purpose | Technology |\n|-----------|-----|---------|------------|\n| Web Application | c3-web | User interface | React + TypeScript |\n| API Server | c3-api | REST + WebSocket API | Express + Socket.IO |\n| Background Workers | c3-workers | Async jobs | Bull + Redis |\n| PostgreSQL | c3-db | Primary data store | PostgreSQL 15 |\n| Redis | c3-cache | Cache + Pub/Sub | Redis 7 |\n\n### Module Architecture (Within API Server)\n\nThe modular monolith is organized into **Foundation Modules** (cross-cutting) and **Feature Modules** (domain-specific):\n\n#### Foundation Modules\n| Module | ID | Responsibility |\n|--------|-----|----------------|\n| Auth | c3-auth | Authentication, OAuth, JWT, sessions |\n| Tenancy | c3-tenancy | Multi-tenant isolation, workspace context |\n| Real-time | c3-realtime | WebSocket connections, pub/sub |\n| Database | c3-database | Connection pooling, migrations, transactions |\n| Cache | c3-cache-module | Redis client, caching strategies |\n\n#### Feature Modules\n| Module | ID | Responsibility |\n|--------|-----|----------------|\n| Users | c3-users | User profiles, preferences |\n| Workspaces | c3-workspaces | Team workspaces, membership |\n| Boards | c3-boards | Task boards, columns |\n| Tasks | c3-tasks | Task CRUD, assignments, due dates |\n| Comments | c3-comments | Task comments, @mentions |\n| Notifications | c3-notifications | In-app + email notifications |\n\n### Data Architecture\n\n#### Multi-Tenancy Strategy\n- **Shared database, shared schema** with `workspace_id` foreign key\n- Row-level security policies in PostgreSQL\n- Middleware enforces tenant context on every request\n\n#### Key Entities\n```\nWorkspace (tenant boundary)\n├── Members (users in workspace)\n├── Boards\n│   ├── Columns\n│   └── Tasks\n│       ├── Assignees\n│       ├── Labels\n│       └── Comments\n└── Invitations\n```\n\n### Real-time Architecture\n\n```\nClient A                    Server                    Client B\n   │                          │                          │\n   │──[task.update]──────────▶│                          │\n   │                          │──[validate + save]       │\n   │                          │──[Redis PUBLISH]─────────│\n   │                          │                          │\n   │                          │◀─[Redis SUBSCRIBE]───────│\n   │                          │                          │\n   │                          │──[task.updated]─────────▶│\n   │◀─[task.updated]──────────│                          │\n```\n\n- Socket.IO rooms per board for efficient broadcasting\n- Redis pub/sub for multi-instance WebSocket scaling\n- Optimistic updates on client with server reconciliation\n\n### Authentication Flow\n\n```\n┌────────┐      ┌───────────┐      ┌──────────────┐\n│ Client │──1──▶│ API Server│──2──▶│ Google OAuth │\n│        │◀─5───│           │◀─3───│              │\n└────────┘      └───────────┘      └──────────────┘\n                     │ 4\n                     ▼\n               ┌──────────┐\n               │ Database │\n               │ (user +  │\n               │ session) │\n               └──────────┘\n\n1. Redirect to /auth/google\n2. Redirect to Google consent\n3. OAuth callback with code\n4. Create/update user, issue JWT\n5. Return JWT + redirect to app\n```\n\n### API Design Principles\n\n1. **RESTful Resources**: Standard CRUD operations\n2. **Workspace Scoping**: `/api/workspaces/:workspaceId/boards/:boardId`\n3. **Consistent Response Format**: `{ data, error, meta }`\n4. **Pagination**: Cursor-based for large collections\n5. **Versioning**: URL prefix `/api/v1/`\n\n### Directory Structure\n\n```\ntaskflow/\n├── apps/\n│   ├── web/                    # React SPA\n│   │   ├── src/\n│   │   │   ├── components/     # Shared UI components\n│   │   │   ├── features/       # Feature-based organization\n│   │   │   ├── hooks/          # Custom React hooks\n│   │   │   ├── lib/            # Utilities, API client\n│   │   │   └── stores/         # State management\n│   │   └── package.json\n│   │\n│   └── api/                    # Express API server\n│       ├── src/\n│       │   ├── foundation/     # Cross-cutting modules\n│       │   │   ├── auth/\n│       │   │   ├── database/\n│       │   │   ├── cache/\n│       │   │   ├── realtime/\n│       │   │   └── tenancy/\n│       │   ├── features/       # Domain modules\n│       │   │   ├── users/\n│       │   │   ├── workspaces/\n│       │   │   ├── boards/\n│       │   │   ├── tasks/\n│       │   │   ├── comments/\n│       │   │   └── notifications/\n│       │   ├── shared/         # Shared utilities\n│       │   └── main.ts         # Entry point\n│       └── package.json\n│\n├── packages/                   # Shared packages\n│   ├── types/                  # Shared TypeScript types\n│   └── validation/             # Shared validation schemas\n│\n├── infrastructure/             # Docker, K8s configs\n├── .c3/                        # Architecture docs\n└── package.json                # Monorepo root\n```\n\n### Module Dependencies\n\n```\n                    ┌─────────────┐\n                    │   Tenancy   │\n                    └──────┬──────┘\n                           │\n        ┌──────────────────┼──────────────────┐\n        ▼                  ▼                  ▼\n   ┌─────────┐       ┌──────────┐       ┌──────────┐\n   │  Auth   │       │ Database │       │  Cache   │\n   └────┬────┘       └────┬─────┘       └────┬─────┘\n        │                 │                  │\n        └─────────────────┼──────────────────┘\n                          ▼\n                    ┌──────────┐\n                    │ Realtime │\n                    └────┬─────┘\n                         │\n    ┌────────────────────┼────────────────────┐\n    ▼          ▼         ▼         ▼          ▼\n┌───────┐ ┌────────┐ ┌──────┐ ┌────────┐ ┌──────────┐\n│ Users │ │Workspaces│ │Boards│ │ Tasks  │ │Notifications│\n└───────┘ └────────┘ └──────┘ └────────┘ └──────────┘\n```\n\nFoundation modules are imported by feature modules, never the reverse.\nFeature modules may have controlled dependencies (e.g., Tasks → Boards).\n\n## Consequences\n\n### Positive\n- **Fast initial development**: Single deployable unit\n- **Clear boundaries**: Modular structure enables future splitting\n- **Real-time native**: WebSocket architecture from day one\n- **Type safety**: TypeScript end-to-end\n- **Scalable**: Redis pub/sub enables horizontal scaling\n\n### Negative\n- **Monorepo complexity**: Need good tooling (pnpm/turborepo)\n- **Shared database bottleneck**: May need sharding at scale\n- **WebSocket state**: Sticky sessions or Redis coordination needed\n\n### Risks\n- **Module coupling**: Discipline required to maintain boundaries\n- **Real-time complexity**: Conflict resolution for concurrent edits\n\n## Implementation Phases\n\n### Phase 1: Foundation (Week 1-2)\n- [ ] Project scaffolding (monorepo setup)\n- [ ] Database schema and migrations\n- [ ] Auth module with Google OAuth\n- [ ] Tenancy middleware\n\n### Phase 2: Core Features (Week 3-4)\n- [ ] Workspaces CRUD\n- [ ] Boards and columns\n- [ ] Tasks with drag-and-drop\n\n### Phase 3: Collaboration (Week 5-6)\n- [ ] Real-time sync with WebSocket\n- [ ] Comments and @mentions\n- [ ] Notifications\n\n### Phase 4: Polish (Week 7-8)\n- [ ] Activity feeds\n- [ ] Search functionality\n- [ ] Performance optimization\n\n## References\n\n- C3 Architecture: `.c3/c3-architecture.md`\n- API Contracts: `.c3/refs/api-contracts.md`\n- Database Schema: `.c3/refs/database-schema.md`\n"
      },
      "result": {
        "type": "create",
        "filePath": "/tmp/tmp.ePSVRl4JKW/.c3/adr-000-initial-architecture.md",
        "content": "# ADR-000: TaskFlow Initial Architecture\n\n## Status\nACCEPTED\n\n## Date\n2026-01-12\n\n## Context\n\nTaskFlow is a task management SaaS platform designed for small teams. The system needs to support:\n- Real-time collaboration on task boards\n- Multi-tenant architecture with team workspaces\n- Web application with future mobile API support\n- Scalable architecture that can evolve from monolith to microservices\n\n### Business Requirements\n- Team-based task management with workspaces\n- Real-time updates when team members modify tasks\n- Google OAuth for seamless authentication\n- Responsive web interface with potential mobile apps\n\n### Technical Constraints\n- Small team, need to ship fast\n- Must support real-time collaboration\n- Need to scale to thousands of teams\n\n## Decision\n\n### Overall Architecture: Modular Monolith\nWe adopt a **modular monolith** architecture that provides clear boundaries between domains while maintaining deployment simplicity. This allows future extraction to microservices if needed.\n\n### Technology Stack\n\n| Layer | Technology | Rationale |\n|-------|------------|-----------|\n| Frontend | React SPA (TypeScript) | Modern component architecture, large ecosystem |\n| API Gateway | Express.js (TypeScript) | Lightweight, flexible, excellent middleware support |\n| Backend | Node.js (TypeScript) | Shared language with frontend, strong async support |\n| Database | PostgreSQL | ACID compliance, excellent for relational data |\n| Cache | Redis | High-performance caching + pub/sub for real-time |\n| Real-time | WebSocket (Socket.IO) | Bidirectional communication for collaboration |\n| Auth | Google OAuth + JWT | Delegated auth reduces security burden |\n\n### System Boundaries (C3 Context)\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│                         TASKFLOW SYSTEM                          │\n│  ┌─────────────┐  ┌──────────────┐  ┌─────────────────────────┐ │\n│  │   Web App   │  │  API Server  │  │  Background Workers     │ │\n│  │  (React)    │──│  (Express)   │──│  (Notifications, etc.)  │ │\n│  └─────────────┘  └──────────────┘  └─────────────────────────┘ │\n│         │                │                      │                │\n│         └────────────────┼──────────────────────┘                │\n│                          ▼                                       │\n│              ┌──────────────────────┐                           │\n│              │  PostgreSQL + Redis  │                           │\n│              └──────────────────────┘                           │\n└─────────────────────────────────────────────────────────────────┘\n         │                    │                    │\n         ▼                    ▼                    ▼\n   ┌──────────┐        ┌──────────────┐     ┌───────────┐\n   │  Users   │        │ Google OAuth │     │  Email    │\n   │ (Teams)  │        │   Provider   │     │  Service  │\n   └──────────┘        └──────────────┘     └───────────┘\n```\n\n### Container Architecture (Deployable Units)\n\n| Container | ID | Purpose | Technology |\n|-----------|-----|---------|------------|\n| Web Application | c3-web | User interface | React + TypeScript |\n| API Server | c3-api | REST + WebSocket API | Express + Socket.IO |\n| Background Workers | c3-workers | Async jobs | Bull + Redis |\n| PostgreSQL | c3-db | Primary data store | PostgreSQL 15 |\n| Redis | c3-cache | Cache + Pub/Sub | Redis 7 |\n\n### Module Architecture (Within API Server)\n\nThe modular monolith is organized into **Foundation Modules** (cross-cutting) and **Feature Modules** (domain-specific):\n\n#### Foundation Modules\n| Module | ID | Responsibility |\n|--------|-----|----------------|\n| Auth | c3-auth | Authentication, OAuth, JWT, sessions |\n| Tenancy | c3-tenancy | Multi-tenant isolation, workspace context |\n| Real-time | c3-realtime | WebSocket connections, pub/sub |\n| Database | c3-database | Connection pooling, migrations, transactions |\n| Cache | c3-cache-module | Redis client, caching strategies |\n\n#### Feature Modules\n| Module | ID | Responsibility |\n|--------|-----|----------------|\n| Users | c3-users | User profiles, preferences |\n| Workspaces | c3-workspaces | Team workspaces, membership |\n| Boards | c3-boards | Task boards, columns |\n| Tasks | c3-tasks | Task CRUD, assignments, due dates |\n| Comments | c3-comments | Task comments, @mentions |\n| Notifications | c3-notifications | In-app + email notifications |\n\n### Data Architecture\n\n#### Multi-Tenancy Strategy\n- **Shared database, shared schema** with `workspace_id` foreign key\n- Row-level security policies in PostgreSQL\n- Middleware enforces tenant context on every request\n\n#### Key Entities\n```\nWorkspace (tenant boundary)\n├── Members (users in workspace)\n├── Boards\n│   ├── Columns\n│   └── Tasks\n│       ├── Assignees\n│       ├── Labels\n│       └── Comments\n└── Invitations\n```\n\n### Real-time Architecture\n\n```\nClient A                    Server                    Client B\n   │                          │                          │\n   │──[task.update]──────────▶│                          │\n   │                          │──[validate + save]       │\n   │                          │──[Redis PUBLISH]─────────│\n   │                          │                          │\n   │                          │◀─[Redis SUBSCRIBE]───────│\n   │                          │                          │\n   │                          │──[task.updated]─────────▶│\n   │◀─[task.updated]──────────│                          │\n```\n\n- Socket.IO rooms per board for efficient broadcasting\n- Redis pub/sub for multi-instance WebSocket scaling\n- Optimistic updates on client with server reconciliation\n\n### Authentication Flow\n\n```\n┌────────┐      ┌───────────┐      ┌──────────────┐\n│ Client │──1──▶│ API Server│──2──▶│ Google OAuth │\n│        │◀─5───│           │◀─3───│              │\n└────────┘      └───────────┘      └──────────────┘\n                     │ 4\n                     ▼\n               ┌──────────┐\n               │ Database │\n               │ (user +  │\n               │ session) │\n               └──────────┘\n\n1. Redirect to /auth/google\n2. Redirect to Google consent\n3. OAuth callback with code\n4. Create/update user, issue JWT\n5. Return JWT + redirect to app\n```\n\n### API Design Principles\n\n1. **RESTful Resources**: Standard CRUD operations\n2. **Workspace Scoping**: `/api/workspaces/:workspaceId/boards/:boardId`\n3. **Consistent Response Format**: `{ data, error, meta }`\n4. **Pagination**: Cursor-based for large collections\n5. **Versioning**: URL prefix `/api/v1/`\n\n### Directory Structure\n\n```\ntaskflow/\n├── apps/\n│   ├── web/                    # React SPA\n│   │   ├── src/\n│   │   │   ├── components/     # Shared UI components\n│   │   │   ├── features/       # Feature-based organization\n│   │   │   ├── hooks/          # Custom React hooks\n│   │   │   ├── lib/            # Utilities, API client\n│   │   │   └── stores/         # State management\n│   │   └── package.json\n│   │\n│   └── api/                    # Express API server\n│       ├── src/\n│       │   ├── foundation/     # Cross-cutting modules\n│       │   │   ├── auth/\n│       │   │   ├── database/\n│       │   │   ├── cache/\n│       │   │   ├── realtime/\n│       │   │   └── tenancy/\n│       │   ├── features/       # Domain modules\n│       │   │   ├── users/\n│       │   │   ├── workspaces/\n│       │   │   ├── boards/\n│       │   │   ├── tasks/\n│       │   │   ├── comments/\n│       │   │   └── notifications/\n│       │   ├── shared/         # Shared utilities\n│       │   └── main.ts         # Entry point\n│       └── package.json\n│\n├── packages/                   # Shared packages\n│   ├── types/                  # Shared TypeScript types\n│   └── validation/             # Shared validation schemas\n│\n├── infrastructure/             # Docker, K8s configs\n├── .c3/                        # Architecture docs\n└── package.json                # Monorepo root\n```\n\n### Module Dependencies\n\n```\n                    ┌─────────────┐\n                    │   Tenancy   │\n                    └──────┬──────┘\n                           │\n        ┌──────────────────┼──────────────────┐\n        ▼                  ▼                  ▼\n   ┌─────────┐       ┌──────────┐       ┌──────────┐\n   │  Auth   │       │ Database │       │  Cache   │\n   └────┬────┘       └────┬─────┘       └────┬─────┘\n        │                 │                  │\n        └─────────────────┼──────────────────┘\n                          ▼\n                    ┌──────────┐\n                    │ Realtime │\n                    └────┬─────┘\n                         │\n    ┌────────────────────┼────────────────────┐\n    ▼          ▼         ▼         ▼          ▼\n┌───────┐ ┌────────┐ ┌──────┐ ┌────────┐ ┌──────────┐\n│ Users │ │Workspaces│ │Boards│ │ Tasks  │ │Notifications│\n└───────┘ └────────┘ └──────┘ └────────┘ └──────────┘\n```\n\nFoundation modules are imported by feature modules, never the reverse.\nFeature modules may have controlled dependencies (e.g., Tasks → Boards).\n\n## Consequences\n\n### Positive\n- **Fast initial development**: Single deployable unit\n- **Clear boundaries**: Modular structure enables future splitting\n- **Real-time native**: WebSocket architecture from day one\n- **Type safety**: TypeScript end-to-end\n- **Scalable**: Redis pub/sub enables horizontal scaling\n\n### Negative\n- **Monorepo complexity**: Need good tooling (pnpm/turborepo)\n- **Shared database bottleneck**: May need sharding at scale\n- **WebSocket state**: Sticky sessions or Redis coordination needed\n\n### Risks\n- **Module coupling**: Discipline required to maintain boundaries\n- **Real-time complexity**: Conflict resolution for concurrent edits\n\n## Implementation Phases\n\n### Phase 1: Foundation (Week 1-2)\n- [ ] Project scaffolding (monorepo setup)\n- [ ] Database schema and migrations\n- [ ] Auth module with Google OAuth\n- [ ] Tenancy middleware\n\n### Phase 2: Core Features (Week 3-4)\n- [ ] Workspaces CRUD\n- [ ] Boards and columns\n- [ ] Tasks with drag-and-drop\n\n### Phase 3: Collaboration (Week 5-6)\n- [ ] Real-time sync with WebSocket\n- [ ] Comments and @mentions\n- [ ] Notifications\n\n### Phase 4: Polish (Week 7-8)\n- [ ] Activity feeds\n- [ ] Search functionality\n- [ ] Performance optimization\n\n## References\n\n- C3 Architecture: `.c3/c3-architecture.md`\n- API Contracts: `.c3/refs/api-contracts.md`\n- Database Schema: `.c3/refs/database-schema.md`\n",
        "structuredPatch": [],
        "originalFile": null
      }
    },
    {
      "timestamp": "2026-01-12T12:43:26.624Z",
      "event": "PreToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "in_progress",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:43:26.633Z",
      "event": "PostToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "in_progress",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      },
      "result": {
        "oldTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "in_progress",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ],
        "newTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "in_progress",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:43:42.040Z",
      "event": "PreToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/c3-architecture.md",
        "content": "# TaskFlow - C3 Architecture\n\n> **C3 = Context, Containers, Components**\n> A hierarchical documentation approach for understanding systems at multiple levels of abstraction.\n\n## Document Index\n\n| Level | Document | Description |\n|-------|----------|-------------|\n| Context | [c3-context.md](./c3-context.md) | System boundary, external actors |\n| Containers | [c3-containers.md](./c3-containers.md) | Deployable units and their relationships |\n| Components | [c3-components.md](./c3-components.md) | Internal module architecture |\n| References | [refs/](./refs/) | Shared patterns, schemas, contracts |\n\n## Quick Reference\n\n### C3 ID Registry\n\n| ID | Type | Name | Location |\n|----|------|------|----------|\n| c3-0 | Context | TaskFlow System | System boundary |\n| c3-web | Container | Web Application | `apps/web/` |\n| c3-api | Container | API Server | `apps/api/` |\n| c3-workers | Container | Background Workers | `apps/api/src/workers/` |\n| c3-db | Container | PostgreSQL | Infrastructure |\n| c3-cache | Container | Redis | Infrastructure |\n| c3-auth | Component | Auth Module | `apps/api/src/foundation/auth/` |\n| c3-tenancy | Component | Tenancy Module | `apps/api/src/foundation/tenancy/` |\n| c3-realtime | Component | Real-time Module | `apps/api/src/foundation/realtime/` |\n| c3-database | Component | Database Module | `apps/api/src/foundation/database/` |\n| c3-cache-module | Component | Cache Module | `apps/api/src/foundation/cache/` |\n| c3-users | Component | Users Feature | `apps/api/src/features/users/` |\n| c3-workspaces | Component | Workspaces Feature | `apps/api/src/features/workspaces/` |\n| c3-boards | Component | Boards Feature | `apps/api/src/features/boards/` |\n| c3-tasks | Component | Tasks Feature | `apps/api/src/features/tasks/` |\n| c3-comments | Component | Comments Feature | `apps/api/src/features/comments/` |\n| c3-notifications | Component | Notifications Feature | `apps/api/src/features/notifications/` |\n\n### Architecture Decision Records\n\n| ADR | Title | Status |\n|-----|-------|--------|\n| [ADR-000](./adr-000-initial-architecture.md) | Initial Architecture | ACCEPTED |\n\n## How to Use This Documentation\n\n### Finding Things\n1. **What does the system do?** → Start with [c3-context.md](./c3-context.md)\n2. **What services run?** → See [c3-containers.md](./c3-containers.md)\n3. **How is code organized?** → See [c3-components.md](./c3-components.md)\n4. **API contracts?** → Check [refs/api-contracts.md](./refs/api-contracts.md)\n5. **Database schema?** → Check [refs/database-schema.md](./refs/database-schema.md)\n\n### Making Changes\n1. Check relevant C3 docs for context\n2. Create ADR for significant changes\n3. Update C3 docs to reflect changes\n4. Reference ADR in commit message\n\n### C3 ID Convention\n- `c3-{N}` - Context level (system boundary)\n- `c3-{name}` - Containers and components\n- `adr-{NNN}` - Architecture decisions\n- `ref-{name}` - Reference documents\n"
      }
    },
    {
      "timestamp": "2026-01-12T12:43:42.059Z",
      "event": "PostToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/c3-architecture.md",
        "content": "# TaskFlow - C3 Architecture\n\n> **C3 = Context, Containers, Components**\n> A hierarchical documentation approach for understanding systems at multiple levels of abstraction.\n\n## Document Index\n\n| Level | Document | Description |\n|-------|----------|-------------|\n| Context | [c3-context.md](./c3-context.md) | System boundary, external actors |\n| Containers | [c3-containers.md](./c3-containers.md) | Deployable units and their relationships |\n| Components | [c3-components.md](./c3-components.md) | Internal module architecture |\n| References | [refs/](./refs/) | Shared patterns, schemas, contracts |\n\n## Quick Reference\n\n### C3 ID Registry\n\n| ID | Type | Name | Location |\n|----|------|------|----------|\n| c3-0 | Context | TaskFlow System | System boundary |\n| c3-web | Container | Web Application | `apps/web/` |\n| c3-api | Container | API Server | `apps/api/` |\n| c3-workers | Container | Background Workers | `apps/api/src/workers/` |\n| c3-db | Container | PostgreSQL | Infrastructure |\n| c3-cache | Container | Redis | Infrastructure |\n| c3-auth | Component | Auth Module | `apps/api/src/foundation/auth/` |\n| c3-tenancy | Component | Tenancy Module | `apps/api/src/foundation/tenancy/` |\n| c3-realtime | Component | Real-time Module | `apps/api/src/foundation/realtime/` |\n| c3-database | Component | Database Module | `apps/api/src/foundation/database/` |\n| c3-cache-module | Component | Cache Module | `apps/api/src/foundation/cache/` |\n| c3-users | Component | Users Feature | `apps/api/src/features/users/` |\n| c3-workspaces | Component | Workspaces Feature | `apps/api/src/features/workspaces/` |\n| c3-boards | Component | Boards Feature | `apps/api/src/features/boards/` |\n| c3-tasks | Component | Tasks Feature | `apps/api/src/features/tasks/` |\n| c3-comments | Component | Comments Feature | `apps/api/src/features/comments/` |\n| c3-notifications | Component | Notifications Feature | `apps/api/src/features/notifications/` |\n\n### Architecture Decision Records\n\n| ADR | Title | Status |\n|-----|-------|--------|\n| [ADR-000](./adr-000-initial-architecture.md) | Initial Architecture | ACCEPTED |\n\n## How to Use This Documentation\n\n### Finding Things\n1. **What does the system do?** → Start with [c3-context.md](./c3-context.md)\n2. **What services run?** → See [c3-containers.md](./c3-containers.md)\n3. **How is code organized?** → See [c3-components.md](./c3-components.md)\n4. **API contracts?** → Check [refs/api-contracts.md](./refs/api-contracts.md)\n5. **Database schema?** → Check [refs/database-schema.md](./refs/database-schema.md)\n\n### Making Changes\n1. Check relevant C3 docs for context\n2. Create ADR for significant changes\n3. Update C3 docs to reflect changes\n4. Reference ADR in commit message\n\n### C3 ID Convention\n- `c3-{N}` - Context level (system boundary)\n- `c3-{name}` - Containers and components\n- `adr-{NNN}` - Architecture decisions\n- `ref-{name}` - Reference documents\n"
      },
      "result": {
        "type": "create",
        "filePath": "/tmp/tmp.ePSVRl4JKW/.c3/c3-architecture.md",
        "content": "# TaskFlow - C3 Architecture\n\n> **C3 = Context, Containers, Components**\n> A hierarchical documentation approach for understanding systems at multiple levels of abstraction.\n\n## Document Index\n\n| Level | Document | Description |\n|-------|----------|-------------|\n| Context | [c3-context.md](./c3-context.md) | System boundary, external actors |\n| Containers | [c3-containers.md](./c3-containers.md) | Deployable units and their relationships |\n| Components | [c3-components.md](./c3-components.md) | Internal module architecture |\n| References | [refs/](./refs/) | Shared patterns, schemas, contracts |\n\n## Quick Reference\n\n### C3 ID Registry\n\n| ID | Type | Name | Location |\n|----|------|------|----------|\n| c3-0 | Context | TaskFlow System | System boundary |\n| c3-web | Container | Web Application | `apps/web/` |\n| c3-api | Container | API Server | `apps/api/` |\n| c3-workers | Container | Background Workers | `apps/api/src/workers/` |\n| c3-db | Container | PostgreSQL | Infrastructure |\n| c3-cache | Container | Redis | Infrastructure |\n| c3-auth | Component | Auth Module | `apps/api/src/foundation/auth/` |\n| c3-tenancy | Component | Tenancy Module | `apps/api/src/foundation/tenancy/` |\n| c3-realtime | Component | Real-time Module | `apps/api/src/foundation/realtime/` |\n| c3-database | Component | Database Module | `apps/api/src/foundation/database/` |\n| c3-cache-module | Component | Cache Module | `apps/api/src/foundation/cache/` |\n| c3-users | Component | Users Feature | `apps/api/src/features/users/` |\n| c3-workspaces | Component | Workspaces Feature | `apps/api/src/features/workspaces/` |\n| c3-boards | Component | Boards Feature | `apps/api/src/features/boards/` |\n| c3-tasks | Component | Tasks Feature | `apps/api/src/features/tasks/` |\n| c3-comments | Component | Comments Feature | `apps/api/src/features/comments/` |\n| c3-notifications | Component | Notifications Feature | `apps/api/src/features/notifications/` |\n\n### Architecture Decision Records\n\n| ADR | Title | Status |\n|-----|-------|--------|\n| [ADR-000](./adr-000-initial-architecture.md) | Initial Architecture | ACCEPTED |\n\n## How to Use This Documentation\n\n### Finding Things\n1. **What does the system do?** → Start with [c3-context.md](./c3-context.md)\n2. **What services run?** → See [c3-containers.md](./c3-containers.md)\n3. **How is code organized?** → See [c3-components.md](./c3-components.md)\n4. **API contracts?** → Check [refs/api-contracts.md](./refs/api-contracts.md)\n5. **Database schema?** → Check [refs/database-schema.md](./refs/database-schema.md)\n\n### Making Changes\n1. Check relevant C3 docs for context\n2. Create ADR for significant changes\n3. Update C3 docs to reflect changes\n4. Reference ADR in commit message\n\n### C3 ID Convention\n- `c3-{N}` - Context level (system boundary)\n- `c3-{name}` - Containers and components\n- `adr-{NNN}` - Architecture decisions\n- `ref-{name}` - Reference documents\n",
        "structuredPatch": [],
        "originalFile": null
      }
    },
    {
      "timestamp": "2026-01-12T12:44:15.923Z",
      "event": "PreToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/c3-context.md",
        "content": "# C3 Context: TaskFlow System\n\n> **c3-0**: System boundary and external actors\n\n## System Purpose\n\nTaskFlow is a **task management SaaS platform** enabling small teams to collaborate on projects through shared task boards with real-time updates.\n\n## Context Diagram\n\n```\n                              ┌─────────────────────────────────────┐\n                              │                                     │\n   ┌──────────────┐           │         TASKFLOW SYSTEM             │\n   │              │  Uses     │            (c3-0)                   │\n   │  Team Member │──────────▶│                                     │\n   │   (Actor)    │◀──────────│  Task management with real-time     │\n   │              │  Updates  │  collaboration for team workspaces  │\n   └──────────────┘           │                                     │\n                              │                                     │\n   ┌──────────────┐           │                                     │\n   │              │  Manages  │                                     │\n   │ Workspace    │──────────▶│                                     │\n   │    Admin     │◀──────────│                                     │\n   │   (Actor)    │  Controls │                                     │\n   └──────────────┘           │                                     │\n                              └───────────┬─────────────────────────┘\n                                          │\n          ┌───────────────────────────────┼───────────────────────────┐\n          │                               │                           │\n          ▼                               ▼                           ▼\n   ┌──────────────┐              ┌──────────────┐            ┌──────────────┐\n   │   Google     │              │    Email     │            │   Browser    │\n   │    OAuth     │              │   Service    │            │   (Client)   │\n   │  (External)  │              │  (External)  │            │  (External)  │\n   └──────────────┘              └──────────────┘            └──────────────┘\n```\n\n## Actors\n\n### Primary Actors\n\n| Actor | Description | Interactions |\n|-------|-------------|--------------|\n| **Team Member** | End user who creates, manages, and collaborates on tasks | Creates tasks, updates status, comments, receives notifications |\n| **Workspace Admin** | Team leader who manages workspace settings and members | Invites members, manages permissions, configures workspace |\n\n### External Systems\n\n| System | Type | Integration |\n|--------|------|-------------|\n| **Google OAuth** | Identity Provider | OAuth 2.0 for authentication |\n| **Email Service** | Notification Delivery | SMTP/API for email notifications |\n| **Browser** | User Agent | HTTP/WebSocket for real-time SPA |\n\n## System Capabilities\n\n### Core Capabilities\n1. **User Authentication** - Google OAuth sign-in, session management\n2. **Workspace Management** - Create teams, invite members, manage access\n3. **Board Management** - Create Kanban-style boards with customizable columns\n4. **Task Management** - CRUD tasks, assign members, set due dates, add labels\n5. **Real-time Collaboration** - Live updates when team members make changes\n6. **Comments & Mentions** - Discuss tasks, @mention teammates\n7. **Notifications** - In-app and email alerts for assignments, mentions, due dates\n\n### Quality Attributes\n| Attribute | Target | Notes |\n|-----------|--------|-------|\n| Availability | 99.5% | Standard SaaS expectation |\n| Latency | <200ms | API response time p95 |\n| Real-time | <100ms | WebSocket broadcast time |\n| Scalability | 10k teams | Initial capacity target |\n\n## Tenant Model\n\nTaskFlow is a **multi-tenant SaaS** with the following isolation model:\n\n```\n┌─────────────────────────────────────────────────────┐\n│                    TASKFLOW                          │\n│  ┌─────────────────────────────────────────────────┐│\n│  │              WORKSPACE (Tenant)                  ││\n│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐         ││\n│  │  │  Board  │  │  Board  │  │  Board  │         ││\n│  │  └─────────┘  └─────────┘  └─────────┘         ││\n│  │                                                  ││\n│  │  Members: [user1, user2, user3]                 ││\n│  └─────────────────────────────────────────────────┘│\n│  ┌─────────────────────────────────────────────────┐│\n│  │              WORKSPACE (Tenant)                  ││\n│  │  ┌─────────┐  ┌─────────┐                       ││\n│  │  │  Board  │  │  Board  │                       ││\n│  │  └─────────┘  └─────────┘                       ││\n│  │                                                  ││\n│  │  Members: [user4, user5]                        ││\n│  └─────────────────────────────────────────────────┘│\n└─────────────────────────────────────────────────────┘\n```\n\n- **Isolation**: Data isolated by `workspace_id` on all tables\n- **User Membership**: Users can belong to multiple workspaces\n- **Permissions**: Role-based within each workspace (admin, member)\n\n## Security Boundary\n\n```\n                    TRUST BOUNDARY\n                         │\n    Untrusted            │           Trusted\n    ─────────────────────│─────────────────────────\n                         │\n    ┌──────────┐         │    ┌──────────────────┐\n    │  Client  │─────────┼───▶│   API Gateway    │\n    │ (Browser)│         │    │  (Auth + Tenant) │\n    └──────────┘         │    └────────┬─────────┘\n                         │             │\n                         │    ┌────────▼─────────┐\n                         │    │  Internal APIs   │\n                         │    │  (Authenticated) │\n                         │    └────────┬─────────┘\n                         │             │\n                         │    ┌────────▼─────────┐\n                         │    │    Data Layer    │\n                         │    │   (PostgreSQL)   │\n                         │    └──────────────────┘\n```\n\n### Security Controls\n1. **Authentication**: JWT tokens from Google OAuth\n2. **Authorization**: Workspace membership + role checks\n3. **Tenant Isolation**: Middleware injects workspace context\n4. **Input Validation**: Zod schemas on all inputs\n5. **Rate Limiting**: Per-user, per-workspace limits\n\n## Next Level: Containers\n\nSee [c3-containers.md](./c3-containers.md) for the deployable units within the TaskFlow system.\n"
      }
    },
    {
      "timestamp": "2026-01-12T12:44:15.939Z",
      "event": "PostToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/c3-context.md",
        "content": "# C3 Context: TaskFlow System\n\n> **c3-0**: System boundary and external actors\n\n## System Purpose\n\nTaskFlow is a **task management SaaS platform** enabling small teams to collaborate on projects through shared task boards with real-time updates.\n\n## Context Diagram\n\n```\n                              ┌─────────────────────────────────────┐\n                              │                                     │\n   ┌──────────────┐           │         TASKFLOW SYSTEM             │\n   │              │  Uses     │            (c3-0)                   │\n   │  Team Member │──────────▶│                                     │\n   │   (Actor)    │◀──────────│  Task management with real-time     │\n   │              │  Updates  │  collaboration for team workspaces  │\n   └──────────────┘           │                                     │\n                              │                                     │\n   ┌──────────────┐           │                                     │\n   │              │  Manages  │                                     │\n   │ Workspace    │──────────▶│                                     │\n   │    Admin     │◀──────────│                                     │\n   │   (Actor)    │  Controls │                                     │\n   └──────────────┘           │                                     │\n                              └───────────┬─────────────────────────┘\n                                          │\n          ┌───────────────────────────────┼───────────────────────────┐\n          │                               │                           │\n          ▼                               ▼                           ▼\n   ┌──────────────┐              ┌──────────────┐            ┌──────────────┐\n   │   Google     │              │    Email     │            │   Browser    │\n   │    OAuth     │              │   Service    │            │   (Client)   │\n   │  (External)  │              │  (External)  │            │  (External)  │\n   └──────────────┘              └──────────────┘            └──────────────┘\n```\n\n## Actors\n\n### Primary Actors\n\n| Actor | Description | Interactions |\n|-------|-------------|--------------|\n| **Team Member** | End user who creates, manages, and collaborates on tasks | Creates tasks, updates status, comments, receives notifications |\n| **Workspace Admin** | Team leader who manages workspace settings and members | Invites members, manages permissions, configures workspace |\n\n### External Systems\n\n| System | Type | Integration |\n|--------|------|-------------|\n| **Google OAuth** | Identity Provider | OAuth 2.0 for authentication |\n| **Email Service** | Notification Delivery | SMTP/API for email notifications |\n| **Browser** | User Agent | HTTP/WebSocket for real-time SPA |\n\n## System Capabilities\n\n### Core Capabilities\n1. **User Authentication** - Google OAuth sign-in, session management\n2. **Workspace Management** - Create teams, invite members, manage access\n3. **Board Management** - Create Kanban-style boards with customizable columns\n4. **Task Management** - CRUD tasks, assign members, set due dates, add labels\n5. **Real-time Collaboration** - Live updates when team members make changes\n6. **Comments & Mentions** - Discuss tasks, @mention teammates\n7. **Notifications** - In-app and email alerts for assignments, mentions, due dates\n\n### Quality Attributes\n| Attribute | Target | Notes |\n|-----------|--------|-------|\n| Availability | 99.5% | Standard SaaS expectation |\n| Latency | <200ms | API response time p95 |\n| Real-time | <100ms | WebSocket broadcast time |\n| Scalability | 10k teams | Initial capacity target |\n\n## Tenant Model\n\nTaskFlow is a **multi-tenant SaaS** with the following isolation model:\n\n```\n┌─────────────────────────────────────────────────────┐\n│                    TASKFLOW                          │\n│  ┌─────────────────────────────────────────────────┐│\n│  │              WORKSPACE (Tenant)                  ││\n│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐         ││\n│  │  │  Board  │  │  Board  │  │  Board  │         ││\n│  │  └─────────┘  └─────────┘  └─────────┘         ││\n│  │                                                  ││\n│  │  Members: [user1, user2, user3]                 ││\n│  └─────────────────────────────────────────────────┘│\n│  ┌─────────────────────────────────────────────────┐│\n│  │              WORKSPACE (Tenant)                  ││\n│  │  ┌─────────┐  ┌─────────┐                       ││\n│  │  │  Board  │  │  Board  │                       ││\n│  │  └─────────┘  └─────────┘                       ││\n│  │                                                  ││\n│  │  Members: [user4, user5]                        ││\n│  └─────────────────────────────────────────────────┘│\n└─────────────────────────────────────────────────────┘\n```\n\n- **Isolation**: Data isolated by `workspace_id` on all tables\n- **User Membership**: Users can belong to multiple workspaces\n- **Permissions**: Role-based within each workspace (admin, member)\n\n## Security Boundary\n\n```\n                    TRUST BOUNDARY\n                         │\n    Untrusted            │           Trusted\n    ─────────────────────│─────────────────────────\n                         │\n    ┌──────────┐         │    ┌──────────────────┐\n    │  Client  │─────────┼───▶│   API Gateway    │\n    │ (Browser)│         │    │  (Auth + Tenant) │\n    └──────────┘         │    └────────┬─────────┘\n                         │             │\n                         │    ┌────────▼─────────┐\n                         │    │  Internal APIs   │\n                         │    │  (Authenticated) │\n                         │    └────────┬─────────┘\n                         │             │\n                         │    ┌────────▼─────────┐\n                         │    │    Data Layer    │\n                         │    │   (PostgreSQL)   │\n                         │    └──────────────────┘\n```\n\n### Security Controls\n1. **Authentication**: JWT tokens from Google OAuth\n2. **Authorization**: Workspace membership + role checks\n3. **Tenant Isolation**: Middleware injects workspace context\n4. **Input Validation**: Zod schemas on all inputs\n5. **Rate Limiting**: Per-user, per-workspace limits\n\n## Next Level: Containers\n\nSee [c3-containers.md](./c3-containers.md) for the deployable units within the TaskFlow system.\n"
      },
      "result": {
        "type": "create",
        "filePath": "/tmp/tmp.ePSVRl4JKW/.c3/c3-context.md",
        "content": "# C3 Context: TaskFlow System\n\n> **c3-0**: System boundary and external actors\n\n## System Purpose\n\nTaskFlow is a **task management SaaS platform** enabling small teams to collaborate on projects through shared task boards with real-time updates.\n\n## Context Diagram\n\n```\n                              ┌─────────────────────────────────────┐\n                              │                                     │\n   ┌──────────────┐           │         TASKFLOW SYSTEM             │\n   │              │  Uses     │            (c3-0)                   │\n   │  Team Member │──────────▶│                                     │\n   │   (Actor)    │◀──────────│  Task management with real-time     │\n   │              │  Updates  │  collaboration for team workspaces  │\n   └──────────────┘           │                                     │\n                              │                                     │\n   ┌──────────────┐           │                                     │\n   │              │  Manages  │                                     │\n   │ Workspace    │──────────▶│                                     │\n   │    Admin     │◀──────────│                                     │\n   │   (Actor)    │  Controls │                                     │\n   └──────────────┘           │                                     │\n                              └───────────┬─────────────────────────┘\n                                          │\n          ┌───────────────────────────────┼───────────────────────────┐\n          │                               │                           │\n          ▼                               ▼                           ▼\n   ┌──────────────┐              ┌──────────────┐            ┌──────────────┐\n   │   Google     │              │    Email     │            │   Browser    │\n   │    OAuth     │              │   Service    │            │   (Client)   │\n   │  (External)  │              │  (External)  │            │  (External)  │\n   └──────────────┘              └──────────────┘            └──────────────┘\n```\n\n## Actors\n\n### Primary Actors\n\n| Actor | Description | Interactions |\n|-------|-------------|--------------|\n| **Team Member** | End user who creates, manages, and collaborates on tasks | Creates tasks, updates status, comments, receives notifications |\n| **Workspace Admin** | Team leader who manages workspace settings and members | Invites members, manages permissions, configures workspace |\n\n### External Systems\n\n| System | Type | Integration |\n|--------|------|-------------|\n| **Google OAuth** | Identity Provider | OAuth 2.0 for authentication |\n| **Email Service** | Notification Delivery | SMTP/API for email notifications |\n| **Browser** | User Agent | HTTP/WebSocket for real-time SPA |\n\n## System Capabilities\n\n### Core Capabilities\n1. **User Authentication** - Google OAuth sign-in, session management\n2. **Workspace Management** - Create teams, invite members, manage access\n3. **Board Management** - Create Kanban-style boards with customizable columns\n4. **Task Management** - CRUD tasks, assign members, set due dates, add labels\n5. **Real-time Collaboration** - Live updates when team members make changes\n6. **Comments & Mentions** - Discuss tasks, @mention teammates\n7. **Notifications** - In-app and email alerts for assignments, mentions, due dates\n\n### Quality Attributes\n| Attribute | Target | Notes |\n|-----------|--------|-------|\n| Availability | 99.5% | Standard SaaS expectation |\n| Latency | <200ms | API response time p95 |\n| Real-time | <100ms | WebSocket broadcast time |\n| Scalability | 10k teams | Initial capacity target |\n\n## Tenant Model\n\nTaskFlow is a **multi-tenant SaaS** with the following isolation model:\n\n```\n┌─────────────────────────────────────────────────────┐\n│                    TASKFLOW                          │\n│  ┌─────────────────────────────────────────────────┐│\n│  │              WORKSPACE (Tenant)                  ││\n│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐         ││\n│  │  │  Board  │  │  Board  │  │  Board  │         ││\n│  │  └─────────┘  └─────────┘  └─────────┘         ││\n│  │                                                  ││\n│  │  Members: [user1, user2, user3]                 ││\n│  └─────────────────────────────────────────────────┘│\n│  ┌─────────────────────────────────────────────────┐│\n│  │              WORKSPACE (Tenant)                  ││\n│  │  ┌─────────┐  ┌─────────┐                       ││\n│  │  │  Board  │  │  Board  │                       ││\n│  │  └─────────┘  └─────────┘                       ││\n│  │                                                  ││\n│  │  Members: [user4, user5]                        ││\n│  └─────────────────────────────────────────────────┘│\n└─────────────────────────────────────────────────────┘\n```\n\n- **Isolation**: Data isolated by `workspace_id` on all tables\n- **User Membership**: Users can belong to multiple workspaces\n- **Permissions**: Role-based within each workspace (admin, member)\n\n## Security Boundary\n\n```\n                    TRUST BOUNDARY\n                         │\n    Untrusted            │           Trusted\n    ─────────────────────│─────────────────────────\n                         │\n    ┌──────────┐         │    ┌──────────────────┐\n    │  Client  │─────────┼───▶│   API Gateway    │\n    │ (Browser)│         │    │  (Auth + Tenant) │\n    └──────────┘         │    └────────┬─────────┘\n                         │             │\n                         │    ┌────────▼─────────┐\n                         │    │  Internal APIs   │\n                         │    │  (Authenticated) │\n                         │    └────────┬─────────┘\n                         │             │\n                         │    ┌────────▼─────────┐\n                         │    │    Data Layer    │\n                         │    │   (PostgreSQL)   │\n                         │    └──────────────────┘\n```\n\n### Security Controls\n1. **Authentication**: JWT tokens from Google OAuth\n2. **Authorization**: Workspace membership + role checks\n3. **Tenant Isolation**: Middleware injects workspace context\n4. **Input Validation**: Zod schemas on all inputs\n5. **Rate Limiting**: Per-user, per-workspace limits\n\n## Next Level: Containers\n\nSee [c3-containers.md](./c3-containers.md) for the deployable units within the TaskFlow system.\n",
        "structuredPatch": [],
        "originalFile": null
      }
    },
    {
      "timestamp": "2026-01-12T12:44:21.149Z",
      "event": "PreToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "in_progress",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:44:21.156Z",
      "event": "PostToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "in_progress",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      },
      "result": {
        "oldTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "in_progress",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "pending",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ],
        "newTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "in_progress",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:45:14.245Z",
      "event": "PreToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/c3-containers.md",
        "content": "# C3 Containers: TaskFlow Deployable Units\n\n> Containers are the separately deployable/runnable units that make up the system.\n\n## Container Diagram\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                              TASKFLOW SYSTEM                                 │\n│                                                                              │\n│  ┌─────────────────────────────────────────────────────────────────────────┐│\n│  │                         PRESENTATION TIER                                ││\n│  │                                                                          ││\n│  │  ┌────────────────────────────────────────────────────────────────────┐ ││\n│  │  │                      WEB APPLICATION (c3-web)                      │ ││\n│  │  │                                                                    │ ││\n│  │  │  React SPA with TypeScript                                         │ ││\n│  │  │  - Responsive UI for task management                               │ ││\n│  │  │  - Real-time updates via WebSocket                                 │ ││\n│  │  │  - Optimistic UI updates                                           │ ││\n│  │  │                                                                    │ ││\n│  │  │  Location: apps/web/                                               │ ││\n│  │  └────────────────────────────────────────────────────────────────────┘ ││\n│  └─────────────────────────────────────────────────────────────────────────┘│\n│                    │ HTTP/REST              │ WebSocket                      │\n│                    ▼                        ▼                                │\n│  ┌─────────────────────────────────────────────────────────────────────────┐│\n│  │                          APPLICATION TIER                                ││\n│  │                                                                          ││\n│  │  ┌──────────────────────────────────┐  ┌─────────────────────────────┐  ││\n│  │  │      API SERVER (c3-api)         │  │  BACKGROUND WORKERS         │  ││\n│  │  │                                  │  │      (c3-workers)           │  ││\n│  │  │  Express.js + Socket.IO          │  │                             │  ││\n│  │  │  - REST API endpoints            │  │  Bull queue processor       │  ││\n│  │  │  - WebSocket real-time           │  │  - Email notifications      │  ││\n│  │  │  - Authentication                │  │  - Scheduled reminders      │  ││\n│  │  │  - Request validation            │  │  - Cleanup jobs             │  ││\n│  │  │                                  │  │                             │  ││\n│  │  │  Location: apps/api/             │  │  Location: apps/api/workers/│  ││\n│  │  └──────────────────────────────────┘  └─────────────────────────────┘  ││\n│  │              │                  │                │                       ││\n│  └──────────────┼──────────────────┼────────────────┼───────────────────────┘│\n│                 │                  │                │                        │\n│                 ▼                  ▼                ▼                        │\n│  ┌─────────────────────────────────────────────────────────────────────────┐│\n│  │                            DATA TIER                                     ││\n│  │                                                                          ││\n│  │  ┌────────────────────────────┐    ┌────────────────────────────────┐   ││\n│  │  │    POSTGRESQL (c3-db)      │    │       REDIS (c3-cache)         │   ││\n│  │  │                            │    │                                │   ││\n│  │  │  Primary data store        │    │  - Session cache               │   ││\n│  │  │  - Users, workspaces       │    │  - Query cache                 │   ││\n│  │  │  - Boards, tasks           │    │  - Real-time pub/sub           │   ││\n│  │  │  - Comments, activities    │    │  - Job queue (Bull)            │   ││\n│  │  │                            │    │                                │   ││\n│  │  │  Port: 5432                │    │  Port: 6379                    │   ││\n│  │  └────────────────────────────┘    └────────────────────────────────┘   ││\n│  │                                                                          ││\n│  └─────────────────────────────────────────────────────────────────────────┘│\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n## Container Details\n\n### c3-web: Web Application\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-web |\n| **Type** | Single Page Application |\n| **Technology** | React 18, TypeScript, Vite |\n| **Location** | `apps/web/` |\n| **Port** | 3000 (dev), static files (prod) |\n\n#### Responsibilities\n- Render responsive task management UI\n- Handle user interactions and form submissions\n- Maintain client-side state (React Query + Zustand)\n- Connect to WebSocket for real-time updates\n- Implement optimistic updates for smooth UX\n\n#### Key Dependencies\n- **c3-api**: REST API for data operations\n- **c3-api**: WebSocket for real-time sync\n\n#### Technology Choices\n| Choice | Rationale |\n|--------|-----------|\n| React 18 | Modern component model, concurrent features |\n| TypeScript | Type safety, better DX |\n| Vite | Fast HMR, modern bundling |\n| React Query | Server state management, caching |\n| Zustand | Lightweight client state |\n| Socket.IO Client | Reliable WebSocket with fallbacks |\n\n---\n\n### c3-api: API Server\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-api |\n| **Type** | Application Server |\n| **Technology** | Node.js, Express, Socket.IO, TypeScript |\n| **Location** | `apps/api/` |\n| **Port** | 4000 |\n\n#### Responsibilities\n- Expose REST API for CRUD operations\n- Handle WebSocket connections for real-time\n- Authenticate users via Google OAuth\n- Enforce tenant isolation\n- Validate all inputs\n- Orchestrate business logic\n\n#### Key Dependencies\n- **c3-db**: PostgreSQL for persistence\n- **c3-cache**: Redis for caching and pub/sub\n- **Google OAuth**: External identity provider\n\n#### API Routes Overview\n```\n/api/v1\n├── /auth\n│   ├── GET  /google          # Initiate OAuth\n│   ├── GET  /google/callback # OAuth callback\n│   ├── POST /refresh         # Refresh JWT\n│   └── POST /logout          # End session\n│\n├── /users\n│   ├── GET  /me              # Current user\n│   └── PATCH /me             # Update profile\n│\n├── /workspaces\n│   ├── GET    /              # List user's workspaces\n│   ├── POST   /              # Create workspace\n│   ├── GET    /:id           # Get workspace\n│   ├── PATCH  /:id           # Update workspace\n│   ├── DELETE /:id           # Delete workspace\n│   └── /members              # Member management\n│\n├── /workspaces/:workspaceId\n│   ├── /boards               # Board CRUD\n│   ├── /boards/:boardId\n│   │   ├── /columns          # Column CRUD\n│   │   └── /tasks            # Task CRUD\n│   └── /invitations          # Invitation management\n│\n└── /tasks/:taskId\n    ├── /comments             # Comment CRUD\n    ├── /assignees            # Assignment management\n    └── /labels               # Label management\n```\n\n#### WebSocket Events\n```\n# Client → Server\ntask.create     { boardId, task }\ntask.update     { taskId, changes }\ntask.move       { taskId, columnId, position }\ntask.delete     { taskId }\ncomment.create  { taskId, content }\n\n# Server → Client\ntask.created    { task }\ntask.updated    { task }\ntask.moved      { taskId, columnId, position }\ntask.deleted    { taskId }\ncomment.created { comment }\nuser.joined     { userId, boardId }\nuser.left       { userId, boardId }\n```\n\n---\n\n### c3-workers: Background Workers\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-workers |\n| **Type** | Background Processor |\n| **Technology** | Bull, Node.js, TypeScript |\n| **Location** | `apps/api/src/workers/` |\n| **Scaling** | Horizontal (multiple instances) |\n\n#### Responsibilities\n- Process async job queues\n- Send email notifications\n- Handle scheduled tasks (due date reminders)\n- Perform cleanup operations\n\n#### Job Queues\n| Queue | Purpose | Priority |\n|-------|---------|----------|\n| `notifications:email` | Email delivery | Normal |\n| `notifications:push` | Push notifications | Normal |\n| `reminders:due-date` | Due date alerts | High |\n| `cleanup:sessions` | Expired session cleanup | Low |\n| `analytics:events` | Event processing | Low |\n\n---\n\n### c3-db: PostgreSQL Database\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-db |\n| **Type** | Relational Database |\n| **Technology** | PostgreSQL 15 |\n| **Port** | 5432 |\n\n#### Responsibilities\n- Store all application data\n- Enforce referential integrity\n- Provide ACID transactions\n- Execute complex queries\n\n#### Schema Overview\nSee [refs/database-schema.md](./refs/database-schema.md) for complete schema.\n\n```\nusers\nworkspaces\nworkspace_members\nboards\ncolumns\ntasks\ntask_assignees\ntask_labels\nlabels\ncomments\nactivities\ninvitations\n```\n\n---\n\n### c3-cache: Redis\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-cache |\n| **Type** | Cache + Message Broker |\n| **Technology** | Redis 7 |\n| **Port** | 6379 |\n\n#### Responsibilities\n- Cache frequently accessed data\n- Store user sessions\n- Pub/sub for real-time broadcasting\n- Job queue storage (Bull)\n- Rate limiting counters\n\n#### Key Patterns\n| Pattern | Usage |\n|---------|-------|\n| `session:{userId}` | User session data |\n| `cache:workspace:{id}` | Workspace details |\n| `cache:board:{id}` | Board with columns |\n| `ratelimit:{ip}:{endpoint}` | Rate limit counters |\n| `presence:board:{id}` | Active users on board |\n\n#### Pub/Sub Channels\n| Channel | Purpose |\n|---------|---------|\n| `board:{boardId}` | Board-level events |\n| `workspace:{workspaceId}` | Workspace-level events |\n| `user:{userId}` | User-specific notifications |\n\n## Container Communication\n\n```\n┌─────────────┐          ┌─────────────┐          ┌─────────────┐\n│   c3-web    │─────────▶│   c3-api    │─────────▶│   c3-db     │\n│             │   REST   │             │   SQL    │             │\n│             │◀─────────│             │◀─────────│             │\n│             │          │             │          │             │\n│             │─────────▶│             │─────────▶│  c3-cache   │\n│             │    WS    │             │  Redis   │             │\n│             │◀─────────│             │◀─────────│             │\n└─────────────┘          └──────┬──────┘          └─────────────┘\n                                │                        ▲\n                                │ Redis                  │\n                                ▼                        │\n                         ┌─────────────┐                │\n                         │ c3-workers  │────────────────┘\n                         │             │     Redis\n                         └─────────────┘\n```\n\n### Communication Protocols\n\n| From | To | Protocol | Purpose |\n|------|-----|----------|---------|\n| c3-web | c3-api | HTTPS | REST API calls |\n| c3-web | c3-api | WSS | Real-time events |\n| c3-api | c3-db | TCP/PostgreSQL | Data persistence |\n| c3-api | c3-cache | TCP/Redis | Caching, pub/sub |\n| c3-workers | c3-db | TCP/PostgreSQL | Job data access |\n| c3-workers | c3-cache | TCP/Redis | Job queue, notifications |\n| c3-api | c3-workers | Redis Queue | Async job dispatch |\n\n## Deployment Configuration\n\n### Development\n```yaml\n# docker-compose.yml\nservices:\n  web:\n    build: ./apps/web\n    ports: [\"3000:3000\"]\n\n  api:\n    build: ./apps/api\n    ports: [\"4000:4000\"]\n    depends_on: [db, redis]\n\n  db:\n    image: postgres:15\n    ports: [\"5432:5432\"]\n\n  redis:\n    image: redis:7\n    ports: [\"6379:6379\"]\n```\n\n### Production Considerations\n- **c3-web**: CDN-hosted static files\n- **c3-api**: Horizontally scaled behind load balancer\n- **c3-workers**: Scaled based on queue depth\n- **c3-db**: Managed PostgreSQL (RDS, Cloud SQL)\n- **c3-cache**: Managed Redis (ElastiCache, Memorystore)\n\n## Next Level: Components\n\nSee [c3-components.md](./c3-components.md) for the internal module architecture within each container.\n"
      }
    },
    {
      "timestamp": "2026-01-12T12:45:14.265Z",
      "event": "PostToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/c3-containers.md",
        "content": "# C3 Containers: TaskFlow Deployable Units\n\n> Containers are the separately deployable/runnable units that make up the system.\n\n## Container Diagram\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                              TASKFLOW SYSTEM                                 │\n│                                                                              │\n│  ┌─────────────────────────────────────────────────────────────────────────┐│\n│  │                         PRESENTATION TIER                                ││\n│  │                                                                          ││\n│  │  ┌────────────────────────────────────────────────────────────────────┐ ││\n│  │  │                      WEB APPLICATION (c3-web)                      │ ││\n│  │  │                                                                    │ ││\n│  │  │  React SPA with TypeScript                                         │ ││\n│  │  │  - Responsive UI for task management                               │ ││\n│  │  │  - Real-time updates via WebSocket                                 │ ││\n│  │  │  - Optimistic UI updates                                           │ ││\n│  │  │                                                                    │ ││\n│  │  │  Location: apps/web/                                               │ ││\n│  │  └────────────────────────────────────────────────────────────────────┘ ││\n│  └─────────────────────────────────────────────────────────────────────────┘│\n│                    │ HTTP/REST              │ WebSocket                      │\n│                    ▼                        ▼                                │\n│  ┌─────────────────────────────────────────────────────────────────────────┐│\n│  │                          APPLICATION TIER                                ││\n│  │                                                                          ││\n│  │  ┌──────────────────────────────────┐  ┌─────────────────────────────┐  ││\n│  │  │      API SERVER (c3-api)         │  │  BACKGROUND WORKERS         │  ││\n│  │  │                                  │  │      (c3-workers)           │  ││\n│  │  │  Express.js + Socket.IO          │  │                             │  ││\n│  │  │  - REST API endpoints            │  │  Bull queue processor       │  ││\n│  │  │  - WebSocket real-time           │  │  - Email notifications      │  ││\n│  │  │  - Authentication                │  │  - Scheduled reminders      │  ││\n│  │  │  - Request validation            │  │  - Cleanup jobs             │  ││\n│  │  │                                  │  │                             │  ││\n│  │  │  Location: apps/api/             │  │  Location: apps/api/workers/│  ││\n│  │  └──────────────────────────────────┘  └─────────────────────────────┘  ││\n│  │              │                  │                │                       ││\n│  └──────────────┼──────────────────┼────────────────┼───────────────────────┘│\n│                 │                  │                │                        │\n│                 ▼                  ▼                ▼                        │\n│  ┌─────────────────────────────────────────────────────────────────────────┐│\n│  │                            DATA TIER                                     ││\n│  │                                                                          ││\n│  │  ┌────────────────────────────┐    ┌────────────────────────────────┐   ││\n│  │  │    POSTGRESQL (c3-db)      │    │       REDIS (c3-cache)         │   ││\n│  │  │                            │    │                                │   ││\n│  │  │  Primary data store        │    │  - Session cache               │   ││\n│  │  │  - Users, workspaces       │    │  - Query cache                 │   ││\n│  │  │  - Boards, tasks           │    │  - Real-time pub/sub           │   ││\n│  │  │  - Comments, activities    │    │  - Job queue (Bull)            │   ││\n│  │  │                            │    │                                │   ││\n│  │  │  Port: 5432                │    │  Port: 6379                    │   ││\n│  │  └────────────────────────────┘    └────────────────────────────────┘   ││\n│  │                                                                          ││\n│  └─────────────────────────────────────────────────────────────────────────┘│\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n## Container Details\n\n### c3-web: Web Application\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-web |\n| **Type** | Single Page Application |\n| **Technology** | React 18, TypeScript, Vite |\n| **Location** | `apps/web/` |\n| **Port** | 3000 (dev), static files (prod) |\n\n#### Responsibilities\n- Render responsive task management UI\n- Handle user interactions and form submissions\n- Maintain client-side state (React Query + Zustand)\n- Connect to WebSocket for real-time updates\n- Implement optimistic updates for smooth UX\n\n#### Key Dependencies\n- **c3-api**: REST API for data operations\n- **c3-api**: WebSocket for real-time sync\n\n#### Technology Choices\n| Choice | Rationale |\n|--------|-----------|\n| React 18 | Modern component model, concurrent features |\n| TypeScript | Type safety, better DX |\n| Vite | Fast HMR, modern bundling |\n| React Query | Server state management, caching |\n| Zustand | Lightweight client state |\n| Socket.IO Client | Reliable WebSocket with fallbacks |\n\n---\n\n### c3-api: API Server\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-api |\n| **Type** | Application Server |\n| **Technology** | Node.js, Express, Socket.IO, TypeScript |\n| **Location** | `apps/api/` |\n| **Port** | 4000 |\n\n#### Responsibilities\n- Expose REST API for CRUD operations\n- Handle WebSocket connections for real-time\n- Authenticate users via Google OAuth\n- Enforce tenant isolation\n- Validate all inputs\n- Orchestrate business logic\n\n#### Key Dependencies\n- **c3-db**: PostgreSQL for persistence\n- **c3-cache**: Redis for caching and pub/sub\n- **Google OAuth**: External identity provider\n\n#### API Routes Overview\n```\n/api/v1\n├── /auth\n│   ├── GET  /google          # Initiate OAuth\n│   ├── GET  /google/callback # OAuth callback\n│   ├── POST /refresh         # Refresh JWT\n│   └── POST /logout          # End session\n│\n├── /users\n│   ├── GET  /me              # Current user\n│   └── PATCH /me             # Update profile\n│\n├── /workspaces\n│   ├── GET    /              # List user's workspaces\n│   ├── POST   /              # Create workspace\n│   ├── GET    /:id           # Get workspace\n│   ├── PATCH  /:id           # Update workspace\n│   ├── DELETE /:id           # Delete workspace\n│   └── /members              # Member management\n│\n├── /workspaces/:workspaceId\n│   ├── /boards               # Board CRUD\n│   ├── /boards/:boardId\n│   │   ├── /columns          # Column CRUD\n│   │   └── /tasks            # Task CRUD\n│   └── /invitations          # Invitation management\n│\n└── /tasks/:taskId\n    ├── /comments             # Comment CRUD\n    ├── /assignees            # Assignment management\n    └── /labels               # Label management\n```\n\n#### WebSocket Events\n```\n# Client → Server\ntask.create     { boardId, task }\ntask.update     { taskId, changes }\ntask.move       { taskId, columnId, position }\ntask.delete     { taskId }\ncomment.create  { taskId, content }\n\n# Server → Client\ntask.created    { task }\ntask.updated    { task }\ntask.moved      { taskId, columnId, position }\ntask.deleted    { taskId }\ncomment.created { comment }\nuser.joined     { userId, boardId }\nuser.left       { userId, boardId }\n```\n\n---\n\n### c3-workers: Background Workers\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-workers |\n| **Type** | Background Processor |\n| **Technology** | Bull, Node.js, TypeScript |\n| **Location** | `apps/api/src/workers/` |\n| **Scaling** | Horizontal (multiple instances) |\n\n#### Responsibilities\n- Process async job queues\n- Send email notifications\n- Handle scheduled tasks (due date reminders)\n- Perform cleanup operations\n\n#### Job Queues\n| Queue | Purpose | Priority |\n|-------|---------|----------|\n| `notifications:email` | Email delivery | Normal |\n| `notifications:push` | Push notifications | Normal |\n| `reminders:due-date` | Due date alerts | High |\n| `cleanup:sessions` | Expired session cleanup | Low |\n| `analytics:events` | Event processing | Low |\n\n---\n\n### c3-db: PostgreSQL Database\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-db |\n| **Type** | Relational Database |\n| **Technology** | PostgreSQL 15 |\n| **Port** | 5432 |\n\n#### Responsibilities\n- Store all application data\n- Enforce referential integrity\n- Provide ACID transactions\n- Execute complex queries\n\n#### Schema Overview\nSee [refs/database-schema.md](./refs/database-schema.md) for complete schema.\n\n```\nusers\nworkspaces\nworkspace_members\nboards\ncolumns\ntasks\ntask_assignees\ntask_labels\nlabels\ncomments\nactivities\ninvitations\n```\n\n---\n\n### c3-cache: Redis\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-cache |\n| **Type** | Cache + Message Broker |\n| **Technology** | Redis 7 |\n| **Port** | 6379 |\n\n#### Responsibilities\n- Cache frequently accessed data\n- Store user sessions\n- Pub/sub for real-time broadcasting\n- Job queue storage (Bull)\n- Rate limiting counters\n\n#### Key Patterns\n| Pattern | Usage |\n|---------|-------|\n| `session:{userId}` | User session data |\n| `cache:workspace:{id}` | Workspace details |\n| `cache:board:{id}` | Board with columns |\n| `ratelimit:{ip}:{endpoint}` | Rate limit counters |\n| `presence:board:{id}` | Active users on board |\n\n#### Pub/Sub Channels\n| Channel | Purpose |\n|---------|---------|\n| `board:{boardId}` | Board-level events |\n| `workspace:{workspaceId}` | Workspace-level events |\n| `user:{userId}` | User-specific notifications |\n\n## Container Communication\n\n```\n┌─────────────┐          ┌─────────────┐          ┌─────────────┐\n│   c3-web    │─────────▶│   c3-api    │─────────▶│   c3-db     │\n│             │   REST   │             │   SQL    │             │\n│             │◀─────────│             │◀─────────│             │\n│             │          │             │          │             │\n│             │─────────▶│             │─────────▶│  c3-cache   │\n│             │    WS    │             │  Redis   │             │\n│             │◀─────────│             │◀─────────│             │\n└─────────────┘          └──────┬──────┘          └─────────────┘\n                                │                        ▲\n                                │ Redis                  │\n                                ▼                        │\n                         ┌─────────────┐                │\n                         │ c3-workers  │────────────────┘\n                         │             │     Redis\n                         └─────────────┘\n```\n\n### Communication Protocols\n\n| From | To | Protocol | Purpose |\n|------|-----|----------|---------|\n| c3-web | c3-api | HTTPS | REST API calls |\n| c3-web | c3-api | WSS | Real-time events |\n| c3-api | c3-db | TCP/PostgreSQL | Data persistence |\n| c3-api | c3-cache | TCP/Redis | Caching, pub/sub |\n| c3-workers | c3-db | TCP/PostgreSQL | Job data access |\n| c3-workers | c3-cache | TCP/Redis | Job queue, notifications |\n| c3-api | c3-workers | Redis Queue | Async job dispatch |\n\n## Deployment Configuration\n\n### Development\n```yaml\n# docker-compose.yml\nservices:\n  web:\n    build: ./apps/web\n    ports: [\"3000:3000\"]\n\n  api:\n    build: ./apps/api\n    ports: [\"4000:4000\"]\n    depends_on: [db, redis]\n\n  db:\n    image: postgres:15\n    ports: [\"5432:5432\"]\n\n  redis:\n    image: redis:7\n    ports: [\"6379:6379\"]\n```\n\n### Production Considerations\n- **c3-web**: CDN-hosted static files\n- **c3-api**: Horizontally scaled behind load balancer\n- **c3-workers**: Scaled based on queue depth\n- **c3-db**: Managed PostgreSQL (RDS, Cloud SQL)\n- **c3-cache**: Managed Redis (ElastiCache, Memorystore)\n\n## Next Level: Components\n\nSee [c3-components.md](./c3-components.md) for the internal module architecture within each container.\n"
      },
      "result": {
        "type": "create",
        "filePath": "/tmp/tmp.ePSVRl4JKW/.c3/c3-containers.md",
        "content": "# C3 Containers: TaskFlow Deployable Units\n\n> Containers are the separately deployable/runnable units that make up the system.\n\n## Container Diagram\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                              TASKFLOW SYSTEM                                 │\n│                                                                              │\n│  ┌─────────────────────────────────────────────────────────────────────────┐│\n│  │                         PRESENTATION TIER                                ││\n│  │                                                                          ││\n│  │  ┌────────────────────────────────────────────────────────────────────┐ ││\n│  │  │                      WEB APPLICATION (c3-web)                      │ ││\n│  │  │                                                                    │ ││\n│  │  │  React SPA with TypeScript                                         │ ││\n│  │  │  - Responsive UI for task management                               │ ││\n│  │  │  - Real-time updates via WebSocket                                 │ ││\n│  │  │  - Optimistic UI updates                                           │ ││\n│  │  │                                                                    │ ││\n│  │  │  Location: apps/web/                                               │ ││\n│  │  └────────────────────────────────────────────────────────────────────┘ ││\n│  └─────────────────────────────────────────────────────────────────────────┘│\n│                    │ HTTP/REST              │ WebSocket                      │\n│                    ▼                        ▼                                │\n│  ┌─────────────────────────────────────────────────────────────────────────┐│\n│  │                          APPLICATION TIER                                ││\n│  │                                                                          ││\n│  │  ┌──────────────────────────────────┐  ┌─────────────────────────────┐  ││\n│  │  │      API SERVER (c3-api)         │  │  BACKGROUND WORKERS         │  ││\n│  │  │                                  │  │      (c3-workers)           │  ││\n│  │  │  Express.js + Socket.IO          │  │                             │  ││\n│  │  │  - REST API endpoints            │  │  Bull queue processor       │  ││\n│  │  │  - WebSocket real-time           │  │  - Email notifications      │  ││\n│  │  │  - Authentication                │  │  - Scheduled reminders      │  ││\n│  │  │  - Request validation            │  │  - Cleanup jobs             │  ││\n│  │  │                                  │  │                             │  ││\n│  │  │  Location: apps/api/             │  │  Location: apps/api/workers/│  ││\n│  │  └──────────────────────────────────┘  └─────────────────────────────┘  ││\n│  │              │                  │                │                       ││\n│  └──────────────┼──────────────────┼────────────────┼───────────────────────┘│\n│                 │                  │                │                        │\n│                 ▼                  ▼                ▼                        │\n│  ┌─────────────────────────────────────────────────────────────────────────┐│\n│  │                            DATA TIER                                     ││\n│  │                                                                          ││\n│  │  ┌────────────────────────────┐    ┌────────────────────────────────┐   ││\n│  │  │    POSTGRESQL (c3-db)      │    │       REDIS (c3-cache)         │   ││\n│  │  │                            │    │                                │   ││\n│  │  │  Primary data store        │    │  - Session cache               │   ││\n│  │  │  - Users, workspaces       │    │  - Query cache                 │   ││\n│  │  │  - Boards, tasks           │    │  - Real-time pub/sub           │   ││\n│  │  │  - Comments, activities    │    │  - Job queue (Bull)            │   ││\n│  │  │                            │    │                                │   ││\n│  │  │  Port: 5432                │    │  Port: 6379                    │   ││\n│  │  └────────────────────────────┘    └────────────────────────────────┘   ││\n│  │                                                                          ││\n│  └─────────────────────────────────────────────────────────────────────────┘│\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n## Container Details\n\n### c3-web: Web Application\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-web |\n| **Type** | Single Page Application |\n| **Technology** | React 18, TypeScript, Vite |\n| **Location** | `apps/web/` |\n| **Port** | 3000 (dev), static files (prod) |\n\n#### Responsibilities\n- Render responsive task management UI\n- Handle user interactions and form submissions\n- Maintain client-side state (React Query + Zustand)\n- Connect to WebSocket for real-time updates\n- Implement optimistic updates for smooth UX\n\n#### Key Dependencies\n- **c3-api**: REST API for data operations\n- **c3-api**: WebSocket for real-time sync\n\n#### Technology Choices\n| Choice | Rationale |\n|--------|-----------|\n| React 18 | Modern component model, concurrent features |\n| TypeScript | Type safety, better DX |\n| Vite | Fast HMR, modern bundling |\n| React Query | Server state management, caching |\n| Zustand | Lightweight client state |\n| Socket.IO Client | Reliable WebSocket with fallbacks |\n\n---\n\n### c3-api: API Server\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-api |\n| **Type** | Application Server |\n| **Technology** | Node.js, Express, Socket.IO, TypeScript |\n| **Location** | `apps/api/` |\n| **Port** | 4000 |\n\n#### Responsibilities\n- Expose REST API for CRUD operations\n- Handle WebSocket connections for real-time\n- Authenticate users via Google OAuth\n- Enforce tenant isolation\n- Validate all inputs\n- Orchestrate business logic\n\n#### Key Dependencies\n- **c3-db**: PostgreSQL for persistence\n- **c3-cache**: Redis for caching and pub/sub\n- **Google OAuth**: External identity provider\n\n#### API Routes Overview\n```\n/api/v1\n├── /auth\n│   ├── GET  /google          # Initiate OAuth\n│   ├── GET  /google/callback # OAuth callback\n│   ├── POST /refresh         # Refresh JWT\n│   └── POST /logout          # End session\n│\n├── /users\n│   ├── GET  /me              # Current user\n│   └── PATCH /me             # Update profile\n│\n├── /workspaces\n│   ├── GET    /              # List user's workspaces\n│   ├── POST   /              # Create workspace\n│   ├── GET    /:id           # Get workspace\n│   ├── PATCH  /:id           # Update workspace\n│   ├── DELETE /:id           # Delete workspace\n│   └── /members              # Member management\n│\n├── /workspaces/:workspaceId\n│   ├── /boards               # Board CRUD\n│   ├── /boards/:boardId\n│   │   ├── /columns          # Column CRUD\n│   │   └── /tasks            # Task CRUD\n│   └── /invitations          # Invitation management\n│\n└── /tasks/:taskId\n    ├── /comments             # Comment CRUD\n    ├── /assignees            # Assignment management\n    └── /labels               # Label management\n```\n\n#### WebSocket Events\n```\n# Client → Server\ntask.create     { boardId, task }\ntask.update     { taskId, changes }\ntask.move       { taskId, columnId, position }\ntask.delete     { taskId }\ncomment.create  { taskId, content }\n\n# Server → Client\ntask.created    { task }\ntask.updated    { task }\ntask.moved      { taskId, columnId, position }\ntask.deleted    { taskId }\ncomment.created { comment }\nuser.joined     { userId, boardId }\nuser.left       { userId, boardId }\n```\n\n---\n\n### c3-workers: Background Workers\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-workers |\n| **Type** | Background Processor |\n| **Technology** | Bull, Node.js, TypeScript |\n| **Location** | `apps/api/src/workers/` |\n| **Scaling** | Horizontal (multiple instances) |\n\n#### Responsibilities\n- Process async job queues\n- Send email notifications\n- Handle scheduled tasks (due date reminders)\n- Perform cleanup operations\n\n#### Job Queues\n| Queue | Purpose | Priority |\n|-------|---------|----------|\n| `notifications:email` | Email delivery | Normal |\n| `notifications:push` | Push notifications | Normal |\n| `reminders:due-date` | Due date alerts | High |\n| `cleanup:sessions` | Expired session cleanup | Low |\n| `analytics:events` | Event processing | Low |\n\n---\n\n### c3-db: PostgreSQL Database\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-db |\n| **Type** | Relational Database |\n| **Technology** | PostgreSQL 15 |\n| **Port** | 5432 |\n\n#### Responsibilities\n- Store all application data\n- Enforce referential integrity\n- Provide ACID transactions\n- Execute complex queries\n\n#### Schema Overview\nSee [refs/database-schema.md](./refs/database-schema.md) for complete schema.\n\n```\nusers\nworkspaces\nworkspace_members\nboards\ncolumns\ntasks\ntask_assignees\ntask_labels\nlabels\ncomments\nactivities\ninvitations\n```\n\n---\n\n### c3-cache: Redis\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-cache |\n| **Type** | Cache + Message Broker |\n| **Technology** | Redis 7 |\n| **Port** | 6379 |\n\n#### Responsibilities\n- Cache frequently accessed data\n- Store user sessions\n- Pub/sub for real-time broadcasting\n- Job queue storage (Bull)\n- Rate limiting counters\n\n#### Key Patterns\n| Pattern | Usage |\n|---------|-------|\n| `session:{userId}` | User session data |\n| `cache:workspace:{id}` | Workspace details |\n| `cache:board:{id}` | Board with columns |\n| `ratelimit:{ip}:{endpoint}` | Rate limit counters |\n| `presence:board:{id}` | Active users on board |\n\n#### Pub/Sub Channels\n| Channel | Purpose |\n|---------|---------|\n| `board:{boardId}` | Board-level events |\n| `workspace:{workspaceId}` | Workspace-level events |\n| `user:{userId}` | User-specific notifications |\n\n## Container Communication\n\n```\n┌─────────────┐          ┌─────────────┐          ┌─────────────┐\n│   c3-web    │─────────▶│   c3-api    │─────────▶│   c3-db     │\n│             │   REST   │             │   SQL    │             │\n│             │◀─────────│             │◀─────────│             │\n│             │          │             │          │             │\n│             │─────────▶│             │─────────▶│  c3-cache   │\n│             │    WS    │             │  Redis   │             │\n│             │◀─────────│             │◀─────────│             │\n└─────────────┘          └──────┬──────┘          └─────────────┘\n                                │                        ▲\n                                │ Redis                  │\n                                ▼                        │\n                         ┌─────────────┐                │\n                         │ c3-workers  │────────────────┘\n                         │             │     Redis\n                         └─────────────┘\n```\n\n### Communication Protocols\n\n| From | To | Protocol | Purpose |\n|------|-----|----------|---------|\n| c3-web | c3-api | HTTPS | REST API calls |\n| c3-web | c3-api | WSS | Real-time events |\n| c3-api | c3-db | TCP/PostgreSQL | Data persistence |\n| c3-api | c3-cache | TCP/Redis | Caching, pub/sub |\n| c3-workers | c3-db | TCP/PostgreSQL | Job data access |\n| c3-workers | c3-cache | TCP/Redis | Job queue, notifications |\n| c3-api | c3-workers | Redis Queue | Async job dispatch |\n\n## Deployment Configuration\n\n### Development\n```yaml\n# docker-compose.yml\nservices:\n  web:\n    build: ./apps/web\n    ports: [\"3000:3000\"]\n\n  api:\n    build: ./apps/api\n    ports: [\"4000:4000\"]\n    depends_on: [db, redis]\n\n  db:\n    image: postgres:15\n    ports: [\"5432:5432\"]\n\n  redis:\n    image: redis:7\n    ports: [\"6379:6379\"]\n```\n\n### Production Considerations\n- **c3-web**: CDN-hosted static files\n- **c3-api**: Horizontally scaled behind load balancer\n- **c3-workers**: Scaled based on queue depth\n- **c3-db**: Managed PostgreSQL (RDS, Cloud SQL)\n- **c3-cache**: Managed Redis (ElastiCache, Memorystore)\n\n## Next Level: Components\n\nSee [c3-components.md](./c3-components.md) for the internal module architecture within each container.\n",
        "structuredPatch": [],
        "originalFile": null
      }
    },
    {
      "timestamp": "2026-01-12T12:45:19.459Z",
      "event": "PreToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "in_progress",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:45:19.466Z",
      "event": "PostToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "in_progress",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      },
      "result": {
        "oldTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "in_progress",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "pending",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ],
        "newTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "in_progress",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:46:46.734Z",
      "event": "PreToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/c3-components.md",
        "content": "# C3 Components: TaskFlow Internal Architecture\n\n> Components are the major structural building blocks within each container.\n\n## Component Overview\n\nThe API server follows a **modular monolith** pattern with two categories:\n- **Foundation Modules**: Cross-cutting concerns (auth, caching, real-time)\n- **Feature Modules**: Domain-specific business logic\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                          API SERVER (c3-api)                                 │\n│                                                                              │\n│  ┌────────────────────────────────────────────────────────────────────────┐ │\n│  │                      FOUNDATION LAYER                                   │ │\n│  │                                                                         │ │\n│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │\n│  │  │   Auth   │  │ Tenancy  │  │ Database │  │  Cache   │  │ Realtime │ │ │\n│  │  │ (c3-auth)│  │(c3-tenan)│  │(c3-datab)│  │(c3-cache)│  │(c3-realt)│ │ │\n│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │\n│  │                                                                         │ │\n│  └────────────────────────────────────────────────────────────────────────┘ │\n│                                    │                                         │\n│                                    ▼                                         │\n│  ┌────────────────────────────────────────────────────────────────────────┐ │\n│  │                        FEATURE LAYER                                    │ │\n│  │                                                                         │ │\n│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │\n│  │  │  Users   │  │Workspaces│  │  Boards  │  │  Tasks   │  │ Comments │ │ │\n│  │  │(c3-users)│  │(c3-works)│  │(c3-board)│  │(c3-tasks)│  │(c3-comme)│ │ │\n│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │\n│  │                                                                         │ │\n│  │               ┌──────────────┐                                          │ │\n│  │               │ Notifications│                                          │ │\n│  │               │  (c3-notif)  │                                          │ │\n│  │               └──────────────┘                                          │ │\n│  │                                                                         │ │\n│  └────────────────────────────────────────────────────────────────────────┘ │\n│                                                                              │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Foundation Modules\n\n### c3-auth: Authentication Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-auth |\n| **Location** | `apps/api/src/foundation/auth/` |\n| **Dependencies** | c3-database, c3-cache |\n\n#### Purpose\nHandle user authentication, session management, and JWT token lifecycle.\n\n#### Responsibilities\n- Google OAuth integration\n- JWT token generation and validation\n- Session storage and refresh\n- Auth middleware for protected routes\n\n#### Directory Structure\n```\nauth/\n├── index.ts              # Module exports\n├── auth.controller.ts    # Route handlers\n├── auth.service.ts       # Business logic\n├── auth.middleware.ts    # Express middleware\n├── strategies/\n│   └── google.strategy.ts\n├── tokens/\n│   ├── jwt.service.ts\n│   └── refresh.service.ts\n└── types.ts              # Auth-specific types\n```\n\n#### Key Interfaces\n```typescript\n// User context attached to request\ninterface AuthContext {\n  userId: string;\n  email: string;\n  sessionId: string;\n}\n\n// JWT payload\ninterface TokenPayload {\n  sub: string;        // userId\n  email: string;\n  iat: number;\n  exp: number;\n}\n```\n\n#### Middleware Chain\n```\nRequest\n   │\n   ▼\n┌──────────────────┐\n│ extractToken()   │  Extract JWT from Authorization header\n└────────┬─────────┘\n         │\n         ▼\n┌──────────────────┐\n│ validateToken()  │  Verify JWT signature and expiry\n└────────┬─────────┘\n         │\n         ▼\n┌──────────────────┐\n│ loadUser()       │  Fetch user from cache/database\n└────────┬─────────┘\n         │\n         ▼\n┌──────────────────┐\n│ attachContext()  │  Add user to request context\n└────────┬─────────┘\n         │\n         ▼\n   Protected Route\n```\n\n---\n\n### c3-tenancy: Multi-Tenancy Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-tenancy |\n| **Location** | `apps/api/src/foundation/tenancy/` |\n| **Dependencies** | c3-auth, c3-database |\n\n#### Purpose\nEnforce workspace-level data isolation and access control.\n\n#### Responsibilities\n- Extract workspace context from URL\n- Verify user membership in workspace\n- Inject tenant context for queries\n- Enforce role-based permissions\n\n#### Directory Structure\n```\ntenancy/\n├── index.ts\n├── tenancy.middleware.ts   # Workspace extraction\n├── tenancy.service.ts      # Membership checks\n├── tenancy.context.ts      # AsyncLocalStorage context\n├── permissions.ts          # Role definitions\n└── types.ts\n```\n\n#### Key Interfaces\n```typescript\n// Workspace context (extends AuthContext)\ninterface TenantContext extends AuthContext {\n  workspaceId: string;\n  workspaceRole: 'admin' | 'member';\n}\n\n// Permission checks\ntype Permission =\n  | 'workspace:read'\n  | 'workspace:write'\n  | 'workspace:admin'\n  | 'board:read'\n  | 'board:write'\n  | 'task:read'\n  | 'task:write';\n```\n\n#### Middleware Chain\n```\nRequest (with auth)\n   │\n   ▼\n┌────────────────────────┐\n│ extractWorkspaceId()   │  From URL params or header\n└──────────┬─────────────┘\n           │\n           ▼\n┌────────────────────────┐\n│ verifyMembership()     │  Check user is workspace member\n└──────────┬─────────────┘\n           │\n           ▼\n┌────────────────────────┐\n│ loadWorkspaceRole()    │  Get user's role in workspace\n└──────────┬─────────────┘\n           │\n           ▼\n┌────────────────────────┐\n│ setTenantContext()     │  Store in AsyncLocalStorage\n└──────────┬─────────────┘\n           │\n           ▼\n   Workspace-scoped Route\n```\n\n---\n\n### c3-database: Database Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-database |\n| **Location** | `apps/api/src/foundation/database/` |\n| **Dependencies** | None (foundation) |\n\n#### Purpose\nManage PostgreSQL connections, migrations, and query building.\n\n#### Responsibilities\n- Connection pool management\n- Migration execution\n- Query builder configuration\n- Transaction handling\n\n#### Directory Structure\n```\ndatabase/\n├── index.ts\n├── connection.ts         # Pool configuration\n├── migrations/           # SQL migrations\n│   ├── 001_initial.sql\n│   ├── 002_workspaces.sql\n│   └── ...\n├── repositories/         # Base repository pattern\n│   └── base.repository.ts\n├── query-builder.ts      # Tenant-aware queries\n└── types.ts\n```\n\n#### Key Patterns\n```typescript\n// Tenant-aware repository base\nabstract class TenantRepository<T> {\n  // Automatically applies workspace_id filter\n  async findAll(): Promise<T[]>;\n  async findById(id: string): Promise<T | null>;\n  async create(data: Partial<T>): Promise<T>;\n  async update(id: string, data: Partial<T>): Promise<T>;\n  async delete(id: string): Promise<void>;\n}\n\n// Transaction support\nasync function withTransaction<T>(\n  fn: (tx: Transaction) => Promise<T>\n): Promise<T>;\n```\n\n---\n\n### c3-cache-module: Cache Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-cache-module |\n| **Location** | `apps/api/src/foundation/cache/` |\n| **Dependencies** | None (foundation) |\n\n#### Purpose\nRedis client abstraction for caching, pub/sub, and rate limiting.\n\n#### Responsibilities\n- Redis connection management\n- Cache get/set/invalidate\n- Pub/sub wrapper\n- Rate limiter implementation\n\n#### Directory Structure\n```\ncache/\n├── index.ts\n├── redis.client.ts       # Connection setup\n├── cache.service.ts      # Caching operations\n├── pubsub.service.ts     # Pub/sub wrapper\n├── rate-limiter.ts       # Rate limiting\n└── types.ts\n```\n\n#### Key Interfaces\n```typescript\ninterface CacheService {\n  get<T>(key: string): Promise<T | null>;\n  set<T>(key: string, value: T, ttlSeconds?: number): Promise<void>;\n  del(key: string): Promise<void>;\n  invalidatePattern(pattern: string): Promise<void>;\n}\n\ninterface PubSubService {\n  publish(channel: string, message: unknown): Promise<void>;\n  subscribe(channel: string, handler: (message: unknown) => void): void;\n  unsubscribe(channel: string): void;\n}\n```\n\n---\n\n### c3-realtime: Real-time Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-realtime |\n| **Location** | `apps/api/src/foundation/realtime/` |\n| **Dependencies** | c3-auth, c3-tenancy, c3-cache-module |\n\n#### Purpose\nWebSocket server for real-time collaboration features.\n\n#### Responsibilities\n- Socket.IO server setup\n- Connection authentication\n- Room management (per board)\n- Event broadcasting via Redis pub/sub\n- Presence tracking\n\n#### Directory Structure\n```\nrealtime/\n├── index.ts\n├── socket.server.ts      # Socket.IO setup\n├── socket.middleware.ts  # Auth for WebSocket\n├── rooms.service.ts      # Room management\n├── presence.service.ts   # Active user tracking\n├── events/\n│   ├── task.events.ts\n│   ├── board.events.ts\n│   └── comment.events.ts\n└── types.ts\n```\n\n#### WebSocket Architecture\n```\nClient A (Board 1)     Client B (Board 1)     Client C (Board 2)\n       │                      │                      │\n       └──────────┬───────────┘                      │\n                  │                                  │\n            ┌─────▼─────┐                     ┌──────▼────┐\n            │  Room:    │                     │  Room:    │\n            │  board-1  │                     │  board-2  │\n            └─────┬─────┘                     └───────────┘\n                  │\n                  ▼\n         ┌───────────────┐\n         │ Redis Pub/Sub │\n         │  (scaling)    │\n         └───────────────┘\n```\n\n---\n\n## Feature Modules\n\n### c3-users: Users Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-users |\n| **Location** | `apps/api/src/features/users/` |\n| **Dependencies** | c3-auth, c3-database, c3-cache-module |\n\n#### Purpose\nUser profile management and preferences.\n\n#### Responsibilities\n- User profile CRUD\n- User preferences (notifications, theme)\n- User search for @mentions\n\n#### Directory Structure\n```\nusers/\n├── index.ts\n├── users.controller.ts\n├── users.service.ts\n├── users.repository.ts\n├── users.schema.ts       # Zod validation\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/users/me` | Get current user profile |\n| PATCH | `/users/me` | Update profile |\n| GET | `/users/search` | Search users for mentions |\n\n---\n\n### c3-workspaces: Workspaces Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-workspaces |\n| **Location** | `apps/api/src/features/workspaces/` |\n| **Dependencies** | c3-tenancy, c3-database, c3-notifications |\n\n#### Purpose\nTeam workspace management.\n\n#### Responsibilities\n- Workspace CRUD\n- Member management\n- Invitation system\n- Role management\n\n#### Directory Structure\n```\nworkspaces/\n├── index.ts\n├── workspaces.controller.ts\n├── workspaces.service.ts\n├── workspaces.repository.ts\n├── members/\n│   ├── members.controller.ts\n│   ├── members.service.ts\n│   └── members.repository.ts\n├── invitations/\n│   ├── invitations.controller.ts\n│   ├── invitations.service.ts\n│   └── invitations.repository.ts\n├── workspaces.schema.ts\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/workspaces` | List user's workspaces |\n| POST | `/workspaces` | Create workspace |\n| GET | `/workspaces/:id` | Get workspace details |\n| PATCH | `/workspaces/:id` | Update workspace |\n| DELETE | `/workspaces/:id` | Delete workspace |\n| GET | `/workspaces/:id/members` | List members |\n| POST | `/workspaces/:id/members` | Add member |\n| DELETE | `/workspaces/:id/members/:userId` | Remove member |\n| POST | `/workspaces/:id/invitations` | Send invitation |\n\n---\n\n### c3-boards: Boards Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-boards |\n| **Location** | `apps/api/src/features/boards/` |\n| **Dependencies** | c3-tenancy, c3-database, c3-realtime |\n\n#### Purpose\nKanban board and column management.\n\n#### Responsibilities\n- Board CRUD within workspace\n- Column management (order, names)\n- Board-level permissions\n\n#### Directory Structure\n```\nboards/\n├── index.ts\n├── boards.controller.ts\n├── boards.service.ts\n├── boards.repository.ts\n├── columns/\n│   ├── columns.controller.ts\n│   ├── columns.service.ts\n│   └── columns.repository.ts\n├── boards.schema.ts\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/workspaces/:wid/boards` | List boards |\n| POST | `/workspaces/:wid/boards` | Create board |\n| GET | `/workspaces/:wid/boards/:id` | Get board with columns |\n| PATCH | `/workspaces/:wid/boards/:id` | Update board |\n| DELETE | `/workspaces/:wid/boards/:id` | Delete board |\n| POST | `/workspaces/:wid/boards/:id/columns` | Add column |\n| PATCH | `/workspaces/:wid/boards/:bid/columns/:id` | Update column |\n| DELETE | `/workspaces/:wid/boards/:bid/columns/:id` | Delete column |\n\n---\n\n### c3-tasks: Tasks Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-tasks |\n| **Location** | `apps/api/src/features/tasks/` |\n| **Dependencies** | c3-boards, c3-tenancy, c3-realtime, c3-notifications |\n\n#### Purpose\nCore task management functionality.\n\n#### Responsibilities\n- Task CRUD\n- Task movement between columns\n- Assignee management\n- Label management\n- Due date handling\n\n#### Directory Structure\n```\ntasks/\n├── index.ts\n├── tasks.controller.ts\n├── tasks.service.ts\n├── tasks.repository.ts\n├── assignees/\n│   ├── assignees.controller.ts\n│   └── assignees.service.ts\n├── labels/\n│   ├── labels.controller.ts\n│   ├── labels.service.ts\n│   └── labels.repository.ts\n├── tasks.schema.ts\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/workspaces/:wid/boards/:bid/tasks` | List tasks |\n| POST | `/workspaces/:wid/boards/:bid/tasks` | Create task |\n| GET | `/tasks/:id` | Get task details |\n| PATCH | `/tasks/:id` | Update task |\n| DELETE | `/tasks/:id` | Delete task |\n| POST | `/tasks/:id/move` | Move to column |\n| POST | `/tasks/:id/assignees` | Add assignee |\n| DELETE | `/tasks/:id/assignees/:userId` | Remove assignee |\n\n#### Task State Machine\n```\n┌──────────┐   move   ┌─────────────┐   move   ┌──────────┐\n│   TODO   │────────▶│ IN PROGRESS  │────────▶│   DONE   │\n└──────────┘         └─────────────┘          └──────────┘\n     ▲                      │                       │\n     └──────────────────────┴───────────────────────┘\n                        move\n```\n\n---\n\n### c3-comments: Comments Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-comments |\n| **Location** | `apps/api/src/features/comments/` |\n| **Dependencies** | c3-tasks, c3-tenancy, c3-realtime, c3-notifications |\n\n#### Purpose\nTask discussion and @mentions.\n\n#### Responsibilities\n- Comment CRUD on tasks\n- @mention parsing and notification\n- Real-time comment sync\n\n#### Directory Structure\n```\ncomments/\n├── index.ts\n├── comments.controller.ts\n├── comments.service.ts\n├── comments.repository.ts\n├── mentions.parser.ts     # Extract @mentions\n├── comments.schema.ts\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/tasks/:id/comments` | List comments |\n| POST | `/tasks/:id/comments` | Add comment |\n| PATCH | `/comments/:id` | Edit comment |\n| DELETE | `/comments/:id` | Delete comment |\n\n---\n\n### c3-notifications: Notifications Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-notifications |\n| **Location** | `apps/api/src/features/notifications/` |\n| **Dependencies** | c3-database, c3-cache-module, c3-realtime |\n\n#### Purpose\nIn-app and email notification delivery.\n\n#### Responsibilities\n- Create notification records\n- Queue email notifications\n- Real-time notification push\n- Notification preferences\n\n#### Directory Structure\n```\nnotifications/\n├── index.ts\n├── notifications.controller.ts\n├── notifications.service.ts\n├── notifications.repository.ts\n├── channels/\n│   ├── email.channel.ts\n│   ├── inapp.channel.ts\n│   └── push.channel.ts     # Future mobile\n├── templates/\n│   ├── task-assigned.ts\n│   ├── mention.ts\n│   └── due-reminder.ts\n├── notifications.schema.ts\n└── types.ts\n```\n\n#### Notification Types\n| Type | Trigger | Channels |\n|------|---------|----------|\n| `task.assigned` | User assigned to task | In-app, Email |\n| `task.due_soon` | Task due in 24h | In-app, Email |\n| `comment.mention` | @mentioned in comment | In-app, Email |\n| `workspace.invited` | Invited to workspace | Email |\n| `task.completed` | Assigned task completed | In-app |\n\n---\n\n## Web Application Components\n\nThe frontend (c3-web) follows a feature-based organization:\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                        WEB APPLICATION (c3-web)                              │\n│                                                                              │\n│  ┌────────────────────────────────────────────────────────────────────────┐ │\n│  │                          SHARED LAYER                                   │ │\n│  │                                                                         │ │\n│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │\n│  │  │   UI     │  │  Hooks   │  │   API    │  │  Store   │  │ Realtime │ │ │\n│  │  │Components│  │ (custom) │  │  Client  │  │ (Zustand)│  │(Socket)  │ │ │\n│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │\n│  │                                                                         │ │\n│  └────────────────────────────────────────────────────────────────────────┘ │\n│                                    │                                         │\n│                                    ▼                                         │\n│  ┌────────────────────────────────────────────────────────────────────────┐ │\n│  │                          FEATURE LAYER                                  │ │\n│  │                                                                         │ │\n│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │\n│  │  │   Auth   │  │Workspace │  │  Board   │  │  Task    │  │  Notif   │ │ │\n│  │  │ Feature  │  │ Feature  │  │ Feature  │  │ Feature  │  │ Feature  │ │ │\n│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │\n│  │                                                                         │ │\n│  └────────────────────────────────────────────────────────────────────────┘ │\n│                                                                              │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n### Frontend Feature Structure\n```\nfeatures/\n├── auth/\n│   ├── components/\n│   │   └── LoginButton.tsx\n│   ├── hooks/\n│   │   └── useAuth.ts\n│   └── index.ts\n│\n├── workspace/\n│   ├── components/\n│   │   ├── WorkspaceList.tsx\n│   │   ├── WorkspaceSettings.tsx\n│   │   └── MemberList.tsx\n│   ├── hooks/\n│   │   └── useWorkspace.ts\n│   └── index.ts\n│\n├── board/\n│   ├── components/\n│   │   ├── Board.tsx\n│   │   ├── Column.tsx\n│   │   └── BoardHeader.tsx\n│   ├── hooks/\n│   │   ├── useBoard.ts\n│   │   └── useBoardRealtime.ts\n│   └── index.ts\n│\n├── task/\n│   ├── components/\n│   │   ├── TaskCard.tsx\n│   │   ├── TaskModal.tsx\n│   │   └── TaskForm.tsx\n│   ├── hooks/\n│   │   └── useTask.ts\n│   └── index.ts\n│\n└── notifications/\n    ├── components/\n    │   ├── NotificationBell.tsx\n    │   └── NotificationList.tsx\n    ├── hooks/\n    │   └── useNotifications.ts\n    └── index.ts\n```\n\n---\n\n## Module Dependency Rules\n\n### Allowed Dependencies\n```\nFeature Modules → Foundation Modules ✓\nFeature Modules → Other Feature Modules (controlled) ✓\nFoundation Modules → Other Foundation Modules ✓\n```\n\n### Forbidden Dependencies\n```\nFoundation Modules → Feature Modules ✗\nCircular dependencies ✗\nDirect database access from controllers ✗\n```\n\n### Dependency Graph\n```\n                     ┌─────────────────────────────────────┐\n                     │           Foundation                │\n                     │                                     │\n                     │  Auth ◄──┬── Tenancy ──► Database  │\n                     │          │                         │\n                     │          └──► Cache ◄── Realtime   │\n                     └──────────────────┬─────────────────┘\n                                        │\n        ┌───────────────────────────────┼───────────────────────────────┐\n        │                               │                               │\n        ▼                               ▼                               ▼\n   ┌─────────┐                    ┌──────────┐                    ┌─────────┐\n   │  Users  │                    │Workspaces│◄───────────────────│ Notif.  │\n   └─────────┘                    └────┬─────┘                    └────▲────┘\n                                       │                               │\n                                       ▼                               │\n                                 ┌──────────┐                          │\n                                 │  Boards  │                          │\n                                 └────┬─────┘                          │\n                                      │                                │\n                                      ▼                                │\n                                ┌──────────┐                           │\n                                │  Tasks   │───────────────────────────┘\n                                └────┬─────┘\n                                     │\n                                     ▼\n                               ┌──────────┐\n                               │ Comments │\n                               └──────────┘\n```\n\n## Next: References\n\nSee [refs/](./refs/) for:\n- [API Contracts](./refs/api-contracts.md)\n- [Database Schema](./refs/database-schema.md)\n- [Error Codes](./refs/error-codes.md)\n"
      }
    },
    {
      "timestamp": "2026-01-12T12:46:46.759Z",
      "event": "PostToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/c3-components.md",
        "content": "# C3 Components: TaskFlow Internal Architecture\n\n> Components are the major structural building blocks within each container.\n\n## Component Overview\n\nThe API server follows a **modular monolith** pattern with two categories:\n- **Foundation Modules**: Cross-cutting concerns (auth, caching, real-time)\n- **Feature Modules**: Domain-specific business logic\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                          API SERVER (c3-api)                                 │\n│                                                                              │\n│  ┌────────────────────────────────────────────────────────────────────────┐ │\n│  │                      FOUNDATION LAYER                                   │ │\n│  │                                                                         │ │\n│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │\n│  │  │   Auth   │  │ Tenancy  │  │ Database │  │  Cache   │  │ Realtime │ │ │\n│  │  │ (c3-auth)│  │(c3-tenan)│  │(c3-datab)│  │(c3-cache)│  │(c3-realt)│ │ │\n│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │\n│  │                                                                         │ │\n│  └────────────────────────────────────────────────────────────────────────┘ │\n│                                    │                                         │\n│                                    ▼                                         │\n│  ┌────────────────────────────────────────────────────────────────────────┐ │\n│  │                        FEATURE LAYER                                    │ │\n│  │                                                                         │ │\n│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │\n│  │  │  Users   │  │Workspaces│  │  Boards  │  │  Tasks   │  │ Comments │ │ │\n│  │  │(c3-users)│  │(c3-works)│  │(c3-board)│  │(c3-tasks)│  │(c3-comme)│ │ │\n│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │\n│  │                                                                         │ │\n│  │               ┌──────────────┐                                          │ │\n│  │               │ Notifications│                                          │ │\n│  │               │  (c3-notif)  │                                          │ │\n│  │               └──────────────┘                                          │ │\n│  │                                                                         │ │\n│  └────────────────────────────────────────────────────────────────────────┘ │\n│                                                                              │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Foundation Modules\n\n### c3-auth: Authentication Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-auth |\n| **Location** | `apps/api/src/foundation/auth/` |\n| **Dependencies** | c3-database, c3-cache |\n\n#### Purpose\nHandle user authentication, session management, and JWT token lifecycle.\n\n#### Responsibilities\n- Google OAuth integration\n- JWT token generation and validation\n- Session storage and refresh\n- Auth middleware for protected routes\n\n#### Directory Structure\n```\nauth/\n├── index.ts              # Module exports\n├── auth.controller.ts    # Route handlers\n├── auth.service.ts       # Business logic\n├── auth.middleware.ts    # Express middleware\n├── strategies/\n│   └── google.strategy.ts\n├── tokens/\n│   ├── jwt.service.ts\n│   └── refresh.service.ts\n└── types.ts              # Auth-specific types\n```\n\n#### Key Interfaces\n```typescript\n// User context attached to request\ninterface AuthContext {\n  userId: string;\n  email: string;\n  sessionId: string;\n}\n\n// JWT payload\ninterface TokenPayload {\n  sub: string;        // userId\n  email: string;\n  iat: number;\n  exp: number;\n}\n```\n\n#### Middleware Chain\n```\nRequest\n   │\n   ▼\n┌──────────────────┐\n│ extractToken()   │  Extract JWT from Authorization header\n└────────┬─────────┘\n         │\n         ▼\n┌──────────────────┐\n│ validateToken()  │  Verify JWT signature and expiry\n└────────┬─────────┘\n         │\n         ▼\n┌──────────────────┐\n│ loadUser()       │  Fetch user from cache/database\n└────────┬─────────┘\n         │\n         ▼\n┌──────────────────┐\n│ attachContext()  │  Add user to request context\n└────────┬─────────┘\n         │\n         ▼\n   Protected Route\n```\n\n---\n\n### c3-tenancy: Multi-Tenancy Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-tenancy |\n| **Location** | `apps/api/src/foundation/tenancy/` |\n| **Dependencies** | c3-auth, c3-database |\n\n#### Purpose\nEnforce workspace-level data isolation and access control.\n\n#### Responsibilities\n- Extract workspace context from URL\n- Verify user membership in workspace\n- Inject tenant context for queries\n- Enforce role-based permissions\n\n#### Directory Structure\n```\ntenancy/\n├── index.ts\n├── tenancy.middleware.ts   # Workspace extraction\n├── tenancy.service.ts      # Membership checks\n├── tenancy.context.ts      # AsyncLocalStorage context\n├── permissions.ts          # Role definitions\n└── types.ts\n```\n\n#### Key Interfaces\n```typescript\n// Workspace context (extends AuthContext)\ninterface TenantContext extends AuthContext {\n  workspaceId: string;\n  workspaceRole: 'admin' | 'member';\n}\n\n// Permission checks\ntype Permission =\n  | 'workspace:read'\n  | 'workspace:write'\n  | 'workspace:admin'\n  | 'board:read'\n  | 'board:write'\n  | 'task:read'\n  | 'task:write';\n```\n\n#### Middleware Chain\n```\nRequest (with auth)\n   │\n   ▼\n┌────────────────────────┐\n│ extractWorkspaceId()   │  From URL params or header\n└──────────┬─────────────┘\n           │\n           ▼\n┌────────────────────────┐\n│ verifyMembership()     │  Check user is workspace member\n└──────────┬─────────────┘\n           │\n           ▼\n┌────────────────────────┐\n│ loadWorkspaceRole()    │  Get user's role in workspace\n└──────────┬─────────────┘\n           │\n           ▼\n┌────────────────────────┐\n│ setTenantContext()     │  Store in AsyncLocalStorage\n└──────────┬─────────────┘\n           │\n           ▼\n   Workspace-scoped Route\n```\n\n---\n\n### c3-database: Database Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-database |\n| **Location** | `apps/api/src/foundation/database/` |\n| **Dependencies** | None (foundation) |\n\n#### Purpose\nManage PostgreSQL connections, migrations, and query building.\n\n#### Responsibilities\n- Connection pool management\n- Migration execution\n- Query builder configuration\n- Transaction handling\n\n#### Directory Structure\n```\ndatabase/\n├── index.ts\n├── connection.ts         # Pool configuration\n├── migrations/           # SQL migrations\n│   ├── 001_initial.sql\n│   ├── 002_workspaces.sql\n│   └── ...\n├── repositories/         # Base repository pattern\n│   └── base.repository.ts\n├── query-builder.ts      # Tenant-aware queries\n└── types.ts\n```\n\n#### Key Patterns\n```typescript\n// Tenant-aware repository base\nabstract class TenantRepository<T> {\n  // Automatically applies workspace_id filter\n  async findAll(): Promise<T[]>;\n  async findById(id: string): Promise<T | null>;\n  async create(data: Partial<T>): Promise<T>;\n  async update(id: string, data: Partial<T>): Promise<T>;\n  async delete(id: string): Promise<void>;\n}\n\n// Transaction support\nasync function withTransaction<T>(\n  fn: (tx: Transaction) => Promise<T>\n): Promise<T>;\n```\n\n---\n\n### c3-cache-module: Cache Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-cache-module |\n| **Location** | `apps/api/src/foundation/cache/` |\n| **Dependencies** | None (foundation) |\n\n#### Purpose\nRedis client abstraction for caching, pub/sub, and rate limiting.\n\n#### Responsibilities\n- Redis connection management\n- Cache get/set/invalidate\n- Pub/sub wrapper\n- Rate limiter implementation\n\n#### Directory Structure\n```\ncache/\n├── index.ts\n├── redis.client.ts       # Connection setup\n├── cache.service.ts      # Caching operations\n├── pubsub.service.ts     # Pub/sub wrapper\n├── rate-limiter.ts       # Rate limiting\n└── types.ts\n```\n\n#### Key Interfaces\n```typescript\ninterface CacheService {\n  get<T>(key: string): Promise<T | null>;\n  set<T>(key: string, value: T, ttlSeconds?: number): Promise<void>;\n  del(key: string): Promise<void>;\n  invalidatePattern(pattern: string): Promise<void>;\n}\n\ninterface PubSubService {\n  publish(channel: string, message: unknown): Promise<void>;\n  subscribe(channel: string, handler: (message: unknown) => void): void;\n  unsubscribe(channel: string): void;\n}\n```\n\n---\n\n### c3-realtime: Real-time Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-realtime |\n| **Location** | `apps/api/src/foundation/realtime/` |\n| **Dependencies** | c3-auth, c3-tenancy, c3-cache-module |\n\n#### Purpose\nWebSocket server for real-time collaboration features.\n\n#### Responsibilities\n- Socket.IO server setup\n- Connection authentication\n- Room management (per board)\n- Event broadcasting via Redis pub/sub\n- Presence tracking\n\n#### Directory Structure\n```\nrealtime/\n├── index.ts\n├── socket.server.ts      # Socket.IO setup\n├── socket.middleware.ts  # Auth for WebSocket\n├── rooms.service.ts      # Room management\n├── presence.service.ts   # Active user tracking\n├── events/\n│   ├── task.events.ts\n│   ├── board.events.ts\n│   └── comment.events.ts\n└── types.ts\n```\n\n#### WebSocket Architecture\n```\nClient A (Board 1)     Client B (Board 1)     Client C (Board 2)\n       │                      │                      │\n       └──────────┬───────────┘                      │\n                  │                                  │\n            ┌─────▼─────┐                     ┌──────▼────┐\n            │  Room:    │                     │  Room:    │\n            │  board-1  │                     │  board-2  │\n            └─────┬─────┘                     └───────────┘\n                  │\n                  ▼\n         ┌───────────────┐\n         │ Redis Pub/Sub │\n         │  (scaling)    │\n         └───────────────┘\n```\n\n---\n\n## Feature Modules\n\n### c3-users: Users Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-users |\n| **Location** | `apps/api/src/features/users/` |\n| **Dependencies** | c3-auth, c3-database, c3-cache-module |\n\n#### Purpose\nUser profile management and preferences.\n\n#### Responsibilities\n- User profile CRUD\n- User preferences (notifications, theme)\n- User search for @mentions\n\n#### Directory Structure\n```\nusers/\n├── index.ts\n├── users.controller.ts\n├── users.service.ts\n├── users.repository.ts\n├── users.schema.ts       # Zod validation\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/users/me` | Get current user profile |\n| PATCH | `/users/me` | Update profile |\n| GET | `/users/search` | Search users for mentions |\n\n---\n\n### c3-workspaces: Workspaces Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-workspaces |\n| **Location** | `apps/api/src/features/workspaces/` |\n| **Dependencies** | c3-tenancy, c3-database, c3-notifications |\n\n#### Purpose\nTeam workspace management.\n\n#### Responsibilities\n- Workspace CRUD\n- Member management\n- Invitation system\n- Role management\n\n#### Directory Structure\n```\nworkspaces/\n├── index.ts\n├── workspaces.controller.ts\n├── workspaces.service.ts\n├── workspaces.repository.ts\n├── members/\n│   ├── members.controller.ts\n│   ├── members.service.ts\n│   └── members.repository.ts\n├── invitations/\n│   ├── invitations.controller.ts\n│   ├── invitations.service.ts\n│   └── invitations.repository.ts\n├── workspaces.schema.ts\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/workspaces` | List user's workspaces |\n| POST | `/workspaces` | Create workspace |\n| GET | `/workspaces/:id` | Get workspace details |\n| PATCH | `/workspaces/:id` | Update workspace |\n| DELETE | `/workspaces/:id` | Delete workspace |\n| GET | `/workspaces/:id/members` | List members |\n| POST | `/workspaces/:id/members` | Add member |\n| DELETE | `/workspaces/:id/members/:userId` | Remove member |\n| POST | `/workspaces/:id/invitations` | Send invitation |\n\n---\n\n### c3-boards: Boards Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-boards |\n| **Location** | `apps/api/src/features/boards/` |\n| **Dependencies** | c3-tenancy, c3-database, c3-realtime |\n\n#### Purpose\nKanban board and column management.\n\n#### Responsibilities\n- Board CRUD within workspace\n- Column management (order, names)\n- Board-level permissions\n\n#### Directory Structure\n```\nboards/\n├── index.ts\n├── boards.controller.ts\n├── boards.service.ts\n├── boards.repository.ts\n├── columns/\n│   ├── columns.controller.ts\n│   ├── columns.service.ts\n│   └── columns.repository.ts\n├── boards.schema.ts\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/workspaces/:wid/boards` | List boards |\n| POST | `/workspaces/:wid/boards` | Create board |\n| GET | `/workspaces/:wid/boards/:id` | Get board with columns |\n| PATCH | `/workspaces/:wid/boards/:id` | Update board |\n| DELETE | `/workspaces/:wid/boards/:id` | Delete board |\n| POST | `/workspaces/:wid/boards/:id/columns` | Add column |\n| PATCH | `/workspaces/:wid/boards/:bid/columns/:id` | Update column |\n| DELETE | `/workspaces/:wid/boards/:bid/columns/:id` | Delete column |\n\n---\n\n### c3-tasks: Tasks Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-tasks |\n| **Location** | `apps/api/src/features/tasks/` |\n| **Dependencies** | c3-boards, c3-tenancy, c3-realtime, c3-notifications |\n\n#### Purpose\nCore task management functionality.\n\n#### Responsibilities\n- Task CRUD\n- Task movement between columns\n- Assignee management\n- Label management\n- Due date handling\n\n#### Directory Structure\n```\ntasks/\n├── index.ts\n├── tasks.controller.ts\n├── tasks.service.ts\n├── tasks.repository.ts\n├── assignees/\n│   ├── assignees.controller.ts\n│   └── assignees.service.ts\n├── labels/\n│   ├── labels.controller.ts\n│   ├── labels.service.ts\n│   └── labels.repository.ts\n├── tasks.schema.ts\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/workspaces/:wid/boards/:bid/tasks` | List tasks |\n| POST | `/workspaces/:wid/boards/:bid/tasks` | Create task |\n| GET | `/tasks/:id` | Get task details |\n| PATCH | `/tasks/:id` | Update task |\n| DELETE | `/tasks/:id` | Delete task |\n| POST | `/tasks/:id/move` | Move to column |\n| POST | `/tasks/:id/assignees` | Add assignee |\n| DELETE | `/tasks/:id/assignees/:userId` | Remove assignee |\n\n#### Task State Machine\n```\n┌──────────┐   move   ┌─────────────┐   move   ┌──────────┐\n│   TODO   │────────▶│ IN PROGRESS  │────────▶│   DONE   │\n└──────────┘         └─────────────┘          └──────────┘\n     ▲                      │                       │\n     └──────────────────────┴───────────────────────┘\n                        move\n```\n\n---\n\n### c3-comments: Comments Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-comments |\n| **Location** | `apps/api/src/features/comments/` |\n| **Dependencies** | c3-tasks, c3-tenancy, c3-realtime, c3-notifications |\n\n#### Purpose\nTask discussion and @mentions.\n\n#### Responsibilities\n- Comment CRUD on tasks\n- @mention parsing and notification\n- Real-time comment sync\n\n#### Directory Structure\n```\ncomments/\n├── index.ts\n├── comments.controller.ts\n├── comments.service.ts\n├── comments.repository.ts\n├── mentions.parser.ts     # Extract @mentions\n├── comments.schema.ts\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/tasks/:id/comments` | List comments |\n| POST | `/tasks/:id/comments` | Add comment |\n| PATCH | `/comments/:id` | Edit comment |\n| DELETE | `/comments/:id` | Delete comment |\n\n---\n\n### c3-notifications: Notifications Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-notifications |\n| **Location** | `apps/api/src/features/notifications/` |\n| **Dependencies** | c3-database, c3-cache-module, c3-realtime |\n\n#### Purpose\nIn-app and email notification delivery.\n\n#### Responsibilities\n- Create notification records\n- Queue email notifications\n- Real-time notification push\n- Notification preferences\n\n#### Directory Structure\n```\nnotifications/\n├── index.ts\n├── notifications.controller.ts\n├── notifications.service.ts\n├── notifications.repository.ts\n├── channels/\n│   ├── email.channel.ts\n│   ├── inapp.channel.ts\n│   └── push.channel.ts     # Future mobile\n├── templates/\n│   ├── task-assigned.ts\n│   ├── mention.ts\n│   └── due-reminder.ts\n├── notifications.schema.ts\n└── types.ts\n```\n\n#### Notification Types\n| Type | Trigger | Channels |\n|------|---------|----------|\n| `task.assigned` | User assigned to task | In-app, Email |\n| `task.due_soon` | Task due in 24h | In-app, Email |\n| `comment.mention` | @mentioned in comment | In-app, Email |\n| `workspace.invited` | Invited to workspace | Email |\n| `task.completed` | Assigned task completed | In-app |\n\n---\n\n## Web Application Components\n\nThe frontend (c3-web) follows a feature-based organization:\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                        WEB APPLICATION (c3-web)                              │\n│                                                                              │\n│  ┌────────────────────────────────────────────────────────────────────────┐ │\n│  │                          SHARED LAYER                                   │ │\n│  │                                                                         │ │\n│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │\n│  │  │   UI     │  │  Hooks   │  │   API    │  │  Store   │  │ Realtime │ │ │\n│  │  │Components│  │ (custom) │  │  Client  │  │ (Zustand)│  │(Socket)  │ │ │\n│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │\n│  │                                                                         │ │\n│  └────────────────────────────────────────────────────────────────────────┘ │\n│                                    │                                         │\n│                                    ▼                                         │\n│  ┌────────────────────────────────────────────────────────────────────────┐ │\n│  │                          FEATURE LAYER                                  │ │\n│  │                                                                         │ │\n│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │\n│  │  │   Auth   │  │Workspace │  │  Board   │  │  Task    │  │  Notif   │ │ │\n│  │  │ Feature  │  │ Feature  │  │ Feature  │  │ Feature  │  │ Feature  │ │ │\n│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │\n│  │                                                                         │ │\n│  └────────────────────────────────────────────────────────────────────────┘ │\n│                                                                              │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n### Frontend Feature Structure\n```\nfeatures/\n├── auth/\n│   ├── components/\n│   │   └── LoginButton.tsx\n│   ├── hooks/\n│   │   └── useAuth.ts\n│   └── index.ts\n│\n├── workspace/\n│   ├── components/\n│   │   ├── WorkspaceList.tsx\n│   │   ├── WorkspaceSettings.tsx\n│   │   └── MemberList.tsx\n│   ├── hooks/\n│   │   └── useWorkspace.ts\n│   └── index.ts\n│\n├── board/\n│   ├── components/\n│   │   ├── Board.tsx\n│   │   ├── Column.tsx\n│   │   └── BoardHeader.tsx\n│   ├── hooks/\n│   │   ├── useBoard.ts\n│   │   └── useBoardRealtime.ts\n│   └── index.ts\n│\n├── task/\n│   ├── components/\n│   │   ├── TaskCard.tsx\n│   │   ├── TaskModal.tsx\n│   │   └── TaskForm.tsx\n│   ├── hooks/\n│   │   └── useTask.ts\n│   └── index.ts\n│\n└── notifications/\n    ├── components/\n    │   ├── NotificationBell.tsx\n    │   └── NotificationList.tsx\n    ├── hooks/\n    │   └── useNotifications.ts\n    └── index.ts\n```\n\n---\n\n## Module Dependency Rules\n\n### Allowed Dependencies\n```\nFeature Modules → Foundation Modules ✓\nFeature Modules → Other Feature Modules (controlled) ✓\nFoundation Modules → Other Foundation Modules ✓\n```\n\n### Forbidden Dependencies\n```\nFoundation Modules → Feature Modules ✗\nCircular dependencies ✗\nDirect database access from controllers ✗\n```\n\n### Dependency Graph\n```\n                     ┌─────────────────────────────────────┐\n                     │           Foundation                │\n                     │                                     │\n                     │  Auth ◄──┬── Tenancy ──► Database  │\n                     │          │                         │\n                     │          └──► Cache ◄── Realtime   │\n                     └──────────────────┬─────────────────┘\n                                        │\n        ┌───────────────────────────────┼───────────────────────────────┐\n        │                               │                               │\n        ▼                               ▼                               ▼\n   ┌─────────┐                    ┌──────────┐                    ┌─────────┐\n   │  Users  │                    │Workspaces│◄───────────────────│ Notif.  │\n   └─────────┘                    └────┬─────┘                    └────▲────┘\n                                       │                               │\n                                       ▼                               │\n                                 ┌──────────┐                          │\n                                 │  Boards  │                          │\n                                 └────┬─────┘                          │\n                                      │                                │\n                                      ▼                                │\n                                ┌──────────┐                           │\n                                │  Tasks   │───────────────────────────┘\n                                └────┬─────┘\n                                     │\n                                     ▼\n                               ┌──────────┐\n                               │ Comments │\n                               └──────────┘\n```\n\n## Next: References\n\nSee [refs/](./refs/) for:\n- [API Contracts](./refs/api-contracts.md)\n- [Database Schema](./refs/database-schema.md)\n- [Error Codes](./refs/error-codes.md)\n"
      },
      "result": {
        "type": "create",
        "filePath": "/tmp/tmp.ePSVRl4JKW/.c3/c3-components.md",
        "content": "# C3 Components: TaskFlow Internal Architecture\n\n> Components are the major structural building blocks within each container.\n\n## Component Overview\n\nThe API server follows a **modular monolith** pattern with two categories:\n- **Foundation Modules**: Cross-cutting concerns (auth, caching, real-time)\n- **Feature Modules**: Domain-specific business logic\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                          API SERVER (c3-api)                                 │\n│                                                                              │\n│  ┌────────────────────────────────────────────────────────────────────────┐ │\n│  │                      FOUNDATION LAYER                                   │ │\n│  │                                                                         │ │\n│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │\n│  │  │   Auth   │  │ Tenancy  │  │ Database │  │  Cache   │  │ Realtime │ │ │\n│  │  │ (c3-auth)│  │(c3-tenan)│  │(c3-datab)│  │(c3-cache)│  │(c3-realt)│ │ │\n│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │\n│  │                                                                         │ │\n│  └────────────────────────────────────────────────────────────────────────┘ │\n│                                    │                                         │\n│                                    ▼                                         │\n│  ┌────────────────────────────────────────────────────────────────────────┐ │\n│  │                        FEATURE LAYER                                    │ │\n│  │                                                                         │ │\n│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │\n│  │  │  Users   │  │Workspaces│  │  Boards  │  │  Tasks   │  │ Comments │ │ │\n│  │  │(c3-users)│  │(c3-works)│  │(c3-board)│  │(c3-tasks)│  │(c3-comme)│ │ │\n│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │\n│  │                                                                         │ │\n│  │               ┌──────────────┐                                          │ │\n│  │               │ Notifications│                                          │ │\n│  │               │  (c3-notif)  │                                          │ │\n│  │               └──────────────┘                                          │ │\n│  │                                                                         │ │\n│  └────────────────────────────────────────────────────────────────────────┘ │\n│                                                                              │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Foundation Modules\n\n### c3-auth: Authentication Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-auth |\n| **Location** | `apps/api/src/foundation/auth/` |\n| **Dependencies** | c3-database, c3-cache |\n\n#### Purpose\nHandle user authentication, session management, and JWT token lifecycle.\n\n#### Responsibilities\n- Google OAuth integration\n- JWT token generation and validation\n- Session storage and refresh\n- Auth middleware for protected routes\n\n#### Directory Structure\n```\nauth/\n├── index.ts              # Module exports\n├── auth.controller.ts    # Route handlers\n├── auth.service.ts       # Business logic\n├── auth.middleware.ts    # Express middleware\n├── strategies/\n│   └── google.strategy.ts\n├── tokens/\n│   ├── jwt.service.ts\n│   └── refresh.service.ts\n└── types.ts              # Auth-specific types\n```\n\n#### Key Interfaces\n```typescript\n// User context attached to request\ninterface AuthContext {\n  userId: string;\n  email: string;\n  sessionId: string;\n}\n\n// JWT payload\ninterface TokenPayload {\n  sub: string;        // userId\n  email: string;\n  iat: number;\n  exp: number;\n}\n```\n\n#### Middleware Chain\n```\nRequest\n   │\n   ▼\n┌──────────────────┐\n│ extractToken()   │  Extract JWT from Authorization header\n└────────┬─────────┘\n         │\n         ▼\n┌──────────────────┐\n│ validateToken()  │  Verify JWT signature and expiry\n└────────┬─────────┘\n         │\n         ▼\n┌──────────────────┐\n│ loadUser()       │  Fetch user from cache/database\n└────────┬─────────┘\n         │\n         ▼\n┌──────────────────┐\n│ attachContext()  │  Add user to request context\n└────────┬─────────┘\n         │\n         ▼\n   Protected Route\n```\n\n---\n\n### c3-tenancy: Multi-Tenancy Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-tenancy |\n| **Location** | `apps/api/src/foundation/tenancy/` |\n| **Dependencies** | c3-auth, c3-database |\n\n#### Purpose\nEnforce workspace-level data isolation and access control.\n\n#### Responsibilities\n- Extract workspace context from URL\n- Verify user membership in workspace\n- Inject tenant context for queries\n- Enforce role-based permissions\n\n#### Directory Structure\n```\ntenancy/\n├── index.ts\n├── tenancy.middleware.ts   # Workspace extraction\n├── tenancy.service.ts      # Membership checks\n├── tenancy.context.ts      # AsyncLocalStorage context\n├── permissions.ts          # Role definitions\n└── types.ts\n```\n\n#### Key Interfaces\n```typescript\n// Workspace context (extends AuthContext)\ninterface TenantContext extends AuthContext {\n  workspaceId: string;\n  workspaceRole: 'admin' | 'member';\n}\n\n// Permission checks\ntype Permission =\n  | 'workspace:read'\n  | 'workspace:write'\n  | 'workspace:admin'\n  | 'board:read'\n  | 'board:write'\n  | 'task:read'\n  | 'task:write';\n```\n\n#### Middleware Chain\n```\nRequest (with auth)\n   │\n   ▼\n┌────────────────────────┐\n│ extractWorkspaceId()   │  From URL params or header\n└──────────┬─────────────┘\n           │\n           ▼\n┌────────────────────────┐\n│ verifyMembership()     │  Check user is workspace member\n└──────────┬─────────────┘\n           │\n           ▼\n┌────────────────────────┐\n│ loadWorkspaceRole()    │  Get user's role in workspace\n└──────────┬─────────────┘\n           │\n           ▼\n┌────────────────────────┐\n│ setTenantContext()     │  Store in AsyncLocalStorage\n└──────────┬─────────────┘\n           │\n           ▼\n   Workspace-scoped Route\n```\n\n---\n\n### c3-database: Database Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-database |\n| **Location** | `apps/api/src/foundation/database/` |\n| **Dependencies** | None (foundation) |\n\n#### Purpose\nManage PostgreSQL connections, migrations, and query building.\n\n#### Responsibilities\n- Connection pool management\n- Migration execution\n- Query builder configuration\n- Transaction handling\n\n#### Directory Structure\n```\ndatabase/\n├── index.ts\n├── connection.ts         # Pool configuration\n├── migrations/           # SQL migrations\n│   ├── 001_initial.sql\n│   ├── 002_workspaces.sql\n│   └── ...\n├── repositories/         # Base repository pattern\n│   └── base.repository.ts\n├── query-builder.ts      # Tenant-aware queries\n└── types.ts\n```\n\n#### Key Patterns\n```typescript\n// Tenant-aware repository base\nabstract class TenantRepository<T> {\n  // Automatically applies workspace_id filter\n  async findAll(): Promise<T[]>;\n  async findById(id: string): Promise<T | null>;\n  async create(data: Partial<T>): Promise<T>;\n  async update(id: string, data: Partial<T>): Promise<T>;\n  async delete(id: string): Promise<void>;\n}\n\n// Transaction support\nasync function withTransaction<T>(\n  fn: (tx: Transaction) => Promise<T>\n): Promise<T>;\n```\n\n---\n\n### c3-cache-module: Cache Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-cache-module |\n| **Location** | `apps/api/src/foundation/cache/` |\n| **Dependencies** | None (foundation) |\n\n#### Purpose\nRedis client abstraction for caching, pub/sub, and rate limiting.\n\n#### Responsibilities\n- Redis connection management\n- Cache get/set/invalidate\n- Pub/sub wrapper\n- Rate limiter implementation\n\n#### Directory Structure\n```\ncache/\n├── index.ts\n├── redis.client.ts       # Connection setup\n├── cache.service.ts      # Caching operations\n├── pubsub.service.ts     # Pub/sub wrapper\n├── rate-limiter.ts       # Rate limiting\n└── types.ts\n```\n\n#### Key Interfaces\n```typescript\ninterface CacheService {\n  get<T>(key: string): Promise<T | null>;\n  set<T>(key: string, value: T, ttlSeconds?: number): Promise<void>;\n  del(key: string): Promise<void>;\n  invalidatePattern(pattern: string): Promise<void>;\n}\n\ninterface PubSubService {\n  publish(channel: string, message: unknown): Promise<void>;\n  subscribe(channel: string, handler: (message: unknown) => void): void;\n  unsubscribe(channel: string): void;\n}\n```\n\n---\n\n### c3-realtime: Real-time Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-realtime |\n| **Location** | `apps/api/src/foundation/realtime/` |\n| **Dependencies** | c3-auth, c3-tenancy, c3-cache-module |\n\n#### Purpose\nWebSocket server for real-time collaboration features.\n\n#### Responsibilities\n- Socket.IO server setup\n- Connection authentication\n- Room management (per board)\n- Event broadcasting via Redis pub/sub\n- Presence tracking\n\n#### Directory Structure\n```\nrealtime/\n├── index.ts\n├── socket.server.ts      # Socket.IO setup\n├── socket.middleware.ts  # Auth for WebSocket\n├── rooms.service.ts      # Room management\n├── presence.service.ts   # Active user tracking\n├── events/\n│   ├── task.events.ts\n│   ├── board.events.ts\n│   └── comment.events.ts\n└── types.ts\n```\n\n#### WebSocket Architecture\n```\nClient A (Board 1)     Client B (Board 1)     Client C (Board 2)\n       │                      │                      │\n       └──────────┬───────────┘                      │\n                  │                                  │\n            ┌─────▼─────┐                     ┌──────▼────┐\n            │  Room:    │                     │  Room:    │\n            │  board-1  │                     │  board-2  │\n            └─────┬─────┘                     └───────────┘\n                  │\n                  ▼\n         ┌───────────────┐\n         │ Redis Pub/Sub │\n         │  (scaling)    │\n         └───────────────┘\n```\n\n---\n\n## Feature Modules\n\n### c3-users: Users Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-users |\n| **Location** | `apps/api/src/features/users/` |\n| **Dependencies** | c3-auth, c3-database, c3-cache-module |\n\n#### Purpose\nUser profile management and preferences.\n\n#### Responsibilities\n- User profile CRUD\n- User preferences (notifications, theme)\n- User search for @mentions\n\n#### Directory Structure\n```\nusers/\n├── index.ts\n├── users.controller.ts\n├── users.service.ts\n├── users.repository.ts\n├── users.schema.ts       # Zod validation\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/users/me` | Get current user profile |\n| PATCH | `/users/me` | Update profile |\n| GET | `/users/search` | Search users for mentions |\n\n---\n\n### c3-workspaces: Workspaces Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-workspaces |\n| **Location** | `apps/api/src/features/workspaces/` |\n| **Dependencies** | c3-tenancy, c3-database, c3-notifications |\n\n#### Purpose\nTeam workspace management.\n\n#### Responsibilities\n- Workspace CRUD\n- Member management\n- Invitation system\n- Role management\n\n#### Directory Structure\n```\nworkspaces/\n├── index.ts\n├── workspaces.controller.ts\n├── workspaces.service.ts\n├── workspaces.repository.ts\n├── members/\n│   ├── members.controller.ts\n│   ├── members.service.ts\n│   └── members.repository.ts\n├── invitations/\n│   ├── invitations.controller.ts\n│   ├── invitations.service.ts\n│   └── invitations.repository.ts\n├── workspaces.schema.ts\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/workspaces` | List user's workspaces |\n| POST | `/workspaces` | Create workspace |\n| GET | `/workspaces/:id` | Get workspace details |\n| PATCH | `/workspaces/:id` | Update workspace |\n| DELETE | `/workspaces/:id` | Delete workspace |\n| GET | `/workspaces/:id/members` | List members |\n| POST | `/workspaces/:id/members` | Add member |\n| DELETE | `/workspaces/:id/members/:userId` | Remove member |\n| POST | `/workspaces/:id/invitations` | Send invitation |\n\n---\n\n### c3-boards: Boards Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-boards |\n| **Location** | `apps/api/src/features/boards/` |\n| **Dependencies** | c3-tenancy, c3-database, c3-realtime |\n\n#### Purpose\nKanban board and column management.\n\n#### Responsibilities\n- Board CRUD within workspace\n- Column management (order, names)\n- Board-level permissions\n\n#### Directory Structure\n```\nboards/\n├── index.ts\n├── boards.controller.ts\n├── boards.service.ts\n├── boards.repository.ts\n├── columns/\n│   ├── columns.controller.ts\n│   ├── columns.service.ts\n│   └── columns.repository.ts\n├── boards.schema.ts\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/workspaces/:wid/boards` | List boards |\n| POST | `/workspaces/:wid/boards` | Create board |\n| GET | `/workspaces/:wid/boards/:id` | Get board with columns |\n| PATCH | `/workspaces/:wid/boards/:id` | Update board |\n| DELETE | `/workspaces/:wid/boards/:id` | Delete board |\n| POST | `/workspaces/:wid/boards/:id/columns` | Add column |\n| PATCH | `/workspaces/:wid/boards/:bid/columns/:id` | Update column |\n| DELETE | `/workspaces/:wid/boards/:bid/columns/:id` | Delete column |\n\n---\n\n### c3-tasks: Tasks Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-tasks |\n| **Location** | `apps/api/src/features/tasks/` |\n| **Dependencies** | c3-boards, c3-tenancy, c3-realtime, c3-notifications |\n\n#### Purpose\nCore task management functionality.\n\n#### Responsibilities\n- Task CRUD\n- Task movement between columns\n- Assignee management\n- Label management\n- Due date handling\n\n#### Directory Structure\n```\ntasks/\n├── index.ts\n├── tasks.controller.ts\n├── tasks.service.ts\n├── tasks.repository.ts\n├── assignees/\n│   ├── assignees.controller.ts\n│   └── assignees.service.ts\n├── labels/\n│   ├── labels.controller.ts\n│   ├── labels.service.ts\n│   └── labels.repository.ts\n├── tasks.schema.ts\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/workspaces/:wid/boards/:bid/tasks` | List tasks |\n| POST | `/workspaces/:wid/boards/:bid/tasks` | Create task |\n| GET | `/tasks/:id` | Get task details |\n| PATCH | `/tasks/:id` | Update task |\n| DELETE | `/tasks/:id` | Delete task |\n| POST | `/tasks/:id/move` | Move to column |\n| POST | `/tasks/:id/assignees` | Add assignee |\n| DELETE | `/tasks/:id/assignees/:userId` | Remove assignee |\n\n#### Task State Machine\n```\n┌──────────┐   move   ┌─────────────┐   move   ┌──────────┐\n│   TODO   │────────▶│ IN PROGRESS  │────────▶│   DONE   │\n└──────────┘         └─────────────┘          └──────────┘\n     ▲                      │                       │\n     └──────────────────────┴───────────────────────┘\n                        move\n```\n\n---\n\n### c3-comments: Comments Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-comments |\n| **Location** | `apps/api/src/features/comments/` |\n| **Dependencies** | c3-tasks, c3-tenancy, c3-realtime, c3-notifications |\n\n#### Purpose\nTask discussion and @mentions.\n\n#### Responsibilities\n- Comment CRUD on tasks\n- @mention parsing and notification\n- Real-time comment sync\n\n#### Directory Structure\n```\ncomments/\n├── index.ts\n├── comments.controller.ts\n├── comments.service.ts\n├── comments.repository.ts\n├── mentions.parser.ts     # Extract @mentions\n├── comments.schema.ts\n└── types.ts\n```\n\n#### API Endpoints\n| Method | Path | Description |\n|--------|------|-------------|\n| GET | `/tasks/:id/comments` | List comments |\n| POST | `/tasks/:id/comments` | Add comment |\n| PATCH | `/comments/:id` | Edit comment |\n| DELETE | `/comments/:id` | Delete comment |\n\n---\n\n### c3-notifications: Notifications Module\n\n| Property | Value |\n|----------|-------|\n| **ID** | c3-notifications |\n| **Location** | `apps/api/src/features/notifications/` |\n| **Dependencies** | c3-database, c3-cache-module, c3-realtime |\n\n#### Purpose\nIn-app and email notification delivery.\n\n#### Responsibilities\n- Create notification records\n- Queue email notifications\n- Real-time notification push\n- Notification preferences\n\n#### Directory Structure\n```\nnotifications/\n├── index.ts\n├── notifications.controller.ts\n├── notifications.service.ts\n├── notifications.repository.ts\n├── channels/\n│   ├── email.channel.ts\n│   ├── inapp.channel.ts\n│   └── push.channel.ts     # Future mobile\n├── templates/\n│   ├── task-assigned.ts\n│   ├── mention.ts\n│   └── due-reminder.ts\n├── notifications.schema.ts\n└── types.ts\n```\n\n#### Notification Types\n| Type | Trigger | Channels |\n|------|---------|----------|\n| `task.assigned` | User assigned to task | In-app, Email |\n| `task.due_soon` | Task due in 24h | In-app, Email |\n| `comment.mention` | @mentioned in comment | In-app, Email |\n| `workspace.invited` | Invited to workspace | Email |\n| `task.completed` | Assigned task completed | In-app |\n\n---\n\n## Web Application Components\n\nThe frontend (c3-web) follows a feature-based organization:\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                        WEB APPLICATION (c3-web)                              │\n│                                                                              │\n│  ┌────────────────────────────────────────────────────────────────────────┐ │\n│  │                          SHARED LAYER                                   │ │\n│  │                                                                         │ │\n│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │\n│  │  │   UI     │  │  Hooks   │  │   API    │  │  Store   │  │ Realtime │ │ │\n│  │  │Components│  │ (custom) │  │  Client  │  │ (Zustand)│  │(Socket)  │ │ │\n│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │\n│  │                                                                         │ │\n│  └────────────────────────────────────────────────────────────────────────┘ │\n│                                    │                                         │\n│                                    ▼                                         │\n│  ┌────────────────────────────────────────────────────────────────────────┐ │\n│  │                          FEATURE LAYER                                  │ │\n│  │                                                                         │ │\n│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │ │\n│  │  │   Auth   │  │Workspace │  │  Board   │  │  Task    │  │  Notif   │ │ │\n│  │  │ Feature  │  │ Feature  │  │ Feature  │  │ Feature  │  │ Feature  │ │ │\n│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │ │\n│  │                                                                         │ │\n│  └────────────────────────────────────────────────────────────────────────┘ │\n│                                                                              │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n### Frontend Feature Structure\n```\nfeatures/\n├── auth/\n│   ├── components/\n│   │   └── LoginButton.tsx\n│   ├── hooks/\n│   │   └── useAuth.ts\n│   └── index.ts\n│\n├── workspace/\n│   ├── components/\n│   │   ├── WorkspaceList.tsx\n│   │   ├── WorkspaceSettings.tsx\n│   │   └── MemberList.tsx\n│   ├── hooks/\n│   │   └── useWorkspace.ts\n│   └── index.ts\n│\n├── board/\n│   ├── components/\n│   │   ├── Board.tsx\n│   │   ├── Column.tsx\n│   │   └── BoardHeader.tsx\n│   ├── hooks/\n│   │   ├── useBoard.ts\n│   │   └── useBoardRealtime.ts\n│   └── index.ts\n│\n├── task/\n│   ├── components/\n│   │   ├── TaskCard.tsx\n│   │   ├── TaskModal.tsx\n│   │   └── TaskForm.tsx\n│   ├── hooks/\n│   │   └── useTask.ts\n│   └── index.ts\n│\n└── notifications/\n    ├── components/\n    │   ├── NotificationBell.tsx\n    │   └── NotificationList.tsx\n    ├── hooks/\n    │   └── useNotifications.ts\n    └── index.ts\n```\n\n---\n\n## Module Dependency Rules\n\n### Allowed Dependencies\n```\nFeature Modules → Foundation Modules ✓\nFeature Modules → Other Feature Modules (controlled) ✓\nFoundation Modules → Other Foundation Modules ✓\n```\n\n### Forbidden Dependencies\n```\nFoundation Modules → Feature Modules ✗\nCircular dependencies ✗\nDirect database access from controllers ✗\n```\n\n### Dependency Graph\n```\n                     ┌─────────────────────────────────────┐\n                     │           Foundation                │\n                     │                                     │\n                     │  Auth ◄──┬── Tenancy ──► Database  │\n                     │          │                         │\n                     │          └──► Cache ◄── Realtime   │\n                     └──────────────────┬─────────────────┘\n                                        │\n        ┌───────────────────────────────┼───────────────────────────────┐\n        │                               │                               │\n        ▼                               ▼                               ▼\n   ┌─────────┐                    ┌──────────┐                    ┌─────────┐\n   │  Users  │                    │Workspaces│◄───────────────────│ Notif.  │\n   └─────────┘                    └────┬─────┘                    └────▲────┘\n                                       │                               │\n                                       ▼                               │\n                                 ┌──────────┐                          │\n                                 │  Boards  │                          │\n                                 └────┬─────┘                          │\n                                      │                                │\n                                      ▼                                │\n                                ┌──────────┐                           │\n                                │  Tasks   │───────────────────────────┘\n                                └────┬─────┘\n                                     │\n                                     ▼\n                               ┌──────────┐\n                               │ Comments │\n                               └──────────┘\n```\n\n## Next: References\n\nSee [refs/](./refs/) for:\n- [API Contracts](./refs/api-contracts.md)\n- [Database Schema](./refs/database-schema.md)\n- [Error Codes](./refs/error-codes.md)\n",
        "structuredPatch": [],
        "originalFile": null
      }
    },
    {
      "timestamp": "2026-01-12T12:46:52.858Z",
      "event": "PreToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "completed",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "in_progress",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:46:52.866Z",
      "event": "PostToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "completed",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "in_progress",
            "activeForm": "Creating References documentation"
          }
        ]
      },
      "result": {
        "oldTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "in_progress",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "pending",
            "activeForm": "Creating References documentation"
          }
        ],
        "newTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "completed",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "in_progress",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:47:40.776Z",
      "event": "PreToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/refs/database-schema.md",
        "content": "# TaskFlow Database Schema\n\n> Reference: `ref-database-schema`\n\n## Entity Relationship Diagram\n\n```\n┌──────────────────────────────────────────────────────────────────────────────┐\n│                                                                              │\n│    ┌─────────┐         ┌──────────────────┐         ┌─────────────┐         │\n│    │  users  │────────►│ workspace_members │◄────────│ workspaces  │         │\n│    └────┬────┘         └──────────────────┘         └──────┬──────┘         │\n│         │                                                   │                │\n│         │              ┌────────────────┐                   │                │\n│         └─────────────►│  invitations   │◄──────────────────┘                │\n│                        └────────────────┘                                    │\n│                                                                              │\n│    ┌──────────────────────────────────────────────────────────────────────┐ │\n│    │                     WORKSPACE BOUNDARY                                │ │\n│    │                                                                       │ │\n│    │    ┌────────────┐                                                     │ │\n│    │    │   boards   │                                                     │ │\n│    │    └─────┬──────┘                                                     │ │\n│    │          │                                                            │ │\n│    │          ▼                                                            │ │\n│    │    ┌────────────┐                                                     │ │\n│    │    │  columns   │                                                     │ │\n│    │    └─────┬──────┘                                                     │ │\n│    │          │                                                            │ │\n│    │          ▼                                                            │ │\n│    │    ┌────────────┐    ┌───────────────┐    ┌────────────┐             │ │\n│    │    │   tasks    │───►│ task_assignees│    │   labels   │             │ │\n│    │    └─────┬──────┘    └───────────────┘    └──────┬─────┘             │ │\n│    │          │                                       │                    │ │\n│    │          │           ┌───────────────┐           │                    │ │\n│    │          └──────────►│  task_labels  │◄──────────┘                    │ │\n│    │          │           └───────────────┘                                │ │\n│    │          │                                                            │ │\n│    │          ▼                                                            │ │\n│    │    ┌────────────┐    ┌───────────────┐                                │ │\n│    │    │  comments  │    │  activities   │                                │ │\n│    │    └────────────┘    └───────────────┘                                │ │\n│    │                                                                       │ │\n│    └───────────────────────────────────────────────────────────────────────┘ │\n│                                                                              │\n│    ┌───────────────────┐                                                     │\n│    │   notifications   │                                                     │\n│    └───────────────────┘                                                     │\n│                                                                              │\n└──────────────────────────────────────────────────────────────────────────────┘\n```\n\n## Table Definitions\n\n### users\n\n```sql\nCREATE TABLE users (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    email           VARCHAR(255) NOT NULL UNIQUE,\n    name            VARCHAR(255) NOT NULL,\n    avatar_url      VARCHAR(500),\n    google_id       VARCHAR(255) UNIQUE,\n\n    -- Preferences\n    notification_email  BOOLEAN DEFAULT true,\n    theme              VARCHAR(20) DEFAULT 'light',\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    last_login_at   TIMESTAMP WITH TIME ZONE\n);\n\nCREATE INDEX idx_users_email ON users(email);\nCREATE INDEX idx_users_google_id ON users(google_id);\n```\n\n### workspaces\n\n```sql\nCREATE TABLE workspaces (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name            VARCHAR(255) NOT NULL,\n    slug            VARCHAR(100) NOT NULL UNIQUE,\n    description     TEXT,\n\n    -- Settings\n    default_board_id UUID,  -- FK added after boards table\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    created_by      UUID NOT NULL REFERENCES users(id)\n);\n\nCREATE INDEX idx_workspaces_slug ON workspaces(slug);\nCREATE INDEX idx_workspaces_created_by ON workspaces(created_by);\n```\n\n### workspace_members\n\n```sql\nCREATE TABLE workspace_members (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    role            VARCHAR(20) NOT NULL DEFAULT 'member',  -- 'admin', 'member'\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    UNIQUE(workspace_id, user_id)\n);\n\nCREATE INDEX idx_workspace_members_workspace ON workspace_members(workspace_id);\nCREATE INDEX idx_workspace_members_user ON workspace_members(user_id);\n```\n\n### invitations\n\n```sql\nCREATE TABLE invitations (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n    email           VARCHAR(255) NOT NULL,\n    role            VARCHAR(20) NOT NULL DEFAULT 'member',\n    token           VARCHAR(100) NOT NULL UNIQUE,\n\n    -- Status\n    status          VARCHAR(20) DEFAULT 'pending',  -- 'pending', 'accepted', 'expired'\n    expires_at      TIMESTAMP WITH TIME ZONE NOT NULL,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    invited_by      UUID NOT NULL REFERENCES users(id),\n    accepted_at     TIMESTAMP WITH TIME ZONE,\n\n    UNIQUE(workspace_id, email, status)  -- Only one pending per email per workspace\n);\n\nCREATE INDEX idx_invitations_workspace ON invitations(workspace_id);\nCREATE INDEX idx_invitations_email ON invitations(email);\nCREATE INDEX idx_invitations_token ON invitations(token);\n```\n\n### boards\n\n```sql\nCREATE TABLE boards (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n    name            VARCHAR(255) NOT NULL,\n    description     TEXT,\n    color           VARCHAR(7),  -- Hex color code\n    position        INTEGER NOT NULL DEFAULT 0,\n\n    -- Settings\n    is_archived     BOOLEAN DEFAULT false,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    created_by      UUID NOT NULL REFERENCES users(id)\n);\n\nCREATE INDEX idx_boards_workspace ON boards(workspace_id);\nCREATE INDEX idx_boards_workspace_position ON boards(workspace_id, position);\n```\n\n### columns\n\n```sql\nCREATE TABLE columns (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    board_id        UUID NOT NULL REFERENCES boards(id) ON DELETE CASCADE,\n    name            VARCHAR(100) NOT NULL,\n    position        INTEGER NOT NULL DEFAULT 0,\n    color           VARCHAR(7),  -- Hex color\n\n    -- Task limits\n    wip_limit       INTEGER,  -- Work in progress limit\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_columns_board ON columns(board_id);\nCREATE INDEX idx_columns_board_position ON columns(board_id, position);\n```\n\n### tasks\n\n```sql\nCREATE TABLE tasks (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    board_id        UUID NOT NULL REFERENCES boards(id) ON DELETE CASCADE,\n    column_id       UUID NOT NULL REFERENCES columns(id) ON DELETE CASCADE,\n\n    -- Content\n    title           VARCHAR(500) NOT NULL,\n    description     TEXT,\n    position        INTEGER NOT NULL DEFAULT 0,\n\n    -- Metadata\n    priority        VARCHAR(20) DEFAULT 'medium',  -- 'low', 'medium', 'high', 'urgent'\n    due_date        TIMESTAMP WITH TIME ZONE,\n    estimated_hours DECIMAL(5,2),\n\n    -- Status\n    is_completed    BOOLEAN DEFAULT false,\n    completed_at    TIMESTAMP WITH TIME ZONE,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    created_by      UUID NOT NULL REFERENCES users(id)\n);\n\nCREATE INDEX idx_tasks_board ON tasks(board_id);\nCREATE INDEX idx_tasks_column ON tasks(column_id);\nCREATE INDEX idx_tasks_column_position ON tasks(column_id, position);\nCREATE INDEX idx_tasks_due_date ON tasks(due_date) WHERE due_date IS NOT NULL;\nCREATE INDEX idx_tasks_created_by ON tasks(created_by);\n```\n\n### task_assignees\n\n```sql\nCREATE TABLE task_assignees (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    task_id         UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,\n    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    assigned_by     UUID NOT NULL REFERENCES users(id),\n\n    UNIQUE(task_id, user_id)\n);\n\nCREATE INDEX idx_task_assignees_task ON task_assignees(task_id);\nCREATE INDEX idx_task_assignees_user ON task_assignees(user_id);\n```\n\n### labels\n\n```sql\nCREATE TABLE labels (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n    name            VARCHAR(50) NOT NULL,\n    color           VARCHAR(7) NOT NULL,  -- Hex color\n\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    UNIQUE(workspace_id, name)\n);\n\nCREATE INDEX idx_labels_workspace ON labels(workspace_id);\n```\n\n### task_labels\n\n```sql\nCREATE TABLE task_labels (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    task_id         UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,\n    label_id        UUID NOT NULL REFERENCES labels(id) ON DELETE CASCADE,\n\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    UNIQUE(task_id, label_id)\n);\n\nCREATE INDEX idx_task_labels_task ON task_labels(task_id);\nCREATE INDEX idx_task_labels_label ON task_labels(label_id);\n```\n\n### comments\n\n```sql\nCREATE TABLE comments (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    task_id         UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,\n    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    content         TEXT NOT NULL,\n\n    -- Edit tracking\n    is_edited       BOOLEAN DEFAULT false,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_comments_task ON comments(task_id);\nCREATE INDEX idx_comments_user ON comments(user_id);\nCREATE INDEX idx_comments_task_created ON comments(task_id, created_at);\n```\n\n### activities\n\n```sql\nCREATE TABLE activities (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n\n    -- Actor\n    user_id         UUID NOT NULL REFERENCES users(id),\n\n    -- Target\n    entity_type     VARCHAR(50) NOT NULL,  -- 'task', 'board', 'comment', 'workspace'\n    entity_id       UUID NOT NULL,\n\n    -- Action\n    action          VARCHAR(50) NOT NULL,  -- 'created', 'updated', 'deleted', 'moved', etc.\n    changes         JSONB,  -- { field: { old: value, new: value } }\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_activities_workspace ON activities(workspace_id);\nCREATE INDEX idx_activities_entity ON activities(entity_type, entity_id);\nCREATE INDEX idx_activities_user ON activities(user_id);\nCREATE INDEX idx_activities_workspace_created ON activities(workspace_id, created_at DESC);\n```\n\n### notifications\n\n```sql\nCREATE TABLE notifications (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    -- Content\n    type            VARCHAR(50) NOT NULL,  -- 'task.assigned', 'comment.mention', etc.\n    title           VARCHAR(255) NOT NULL,\n    body            TEXT,\n\n    -- Reference\n    entity_type     VARCHAR(50),\n    entity_id       UUID,\n    workspace_id    UUID REFERENCES workspaces(id) ON DELETE CASCADE,\n\n    -- Status\n    is_read         BOOLEAN DEFAULT false,\n    read_at         TIMESTAMP WITH TIME ZONE,\n\n    -- Delivery\n    email_sent      BOOLEAN DEFAULT false,\n    email_sent_at   TIMESTAMP WITH TIME ZONE,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_notifications_user ON notifications(user_id);\nCREATE INDEX idx_notifications_user_unread ON notifications(user_id, is_read) WHERE is_read = false;\nCREATE INDEX idx_notifications_user_created ON notifications(user_id, created_at DESC);\n```\n\n## Row-Level Security (RLS)\n\nFor multi-tenant isolation, we use PostgreSQL Row-Level Security:\n\n```sql\n-- Enable RLS on tenant-scoped tables\nALTER TABLE boards ENABLE ROW LEVEL SECURITY;\nALTER TABLE columns ENABLE ROW LEVEL SECURITY;\nALTER TABLE tasks ENABLE ROW LEVEL SECURITY;\nALTER TABLE labels ENABLE ROW LEVEL SECURITY;\nALTER TABLE activities ENABLE ROW LEVEL SECURITY;\n\n-- Example policy for boards\nCREATE POLICY boards_tenant_isolation ON boards\n    USING (workspace_id = current_setting('app.current_workspace_id')::uuid);\n\n-- Set workspace context before queries\nSET app.current_workspace_id = 'workspace-uuid-here';\n```\n\n## Migrations\n\nMigrations are stored in `apps/api/src/foundation/database/migrations/`:\n\n| Migration | Description |\n|-----------|-------------|\n| `001_initial.sql` | Users table |\n| `002_workspaces.sql` | Workspaces, members, invitations |\n| `003_boards.sql` | Boards, columns |\n| `004_tasks.sql` | Tasks, assignees, labels |\n| `005_comments.sql` | Comments |\n| `006_activities.sql` | Activity log |\n| `007_notifications.sql` | Notifications |\n| `008_indexes.sql` | Performance indexes |\n| `009_rls.sql` | Row-level security policies |\n\n## TypeScript Types\n\n```typescript\n// Generated from schema\ninterface User {\n  id: string;\n  email: string;\n  name: string;\n  avatarUrl: string | null;\n  googleId: string | null;\n  notificationEmail: boolean;\n  theme: 'light' | 'dark';\n  createdAt: Date;\n  updatedAt: Date;\n  lastLoginAt: Date | null;\n}\n\ninterface Workspace {\n  id: string;\n  name: string;\n  slug: string;\n  description: string | null;\n  defaultBoardId: string | null;\n  createdAt: Date;\n  updatedAt: Date;\n  createdBy: string;\n}\n\ninterface Task {\n  id: string;\n  boardId: string;\n  columnId: string;\n  title: string;\n  description: string | null;\n  position: number;\n  priority: 'low' | 'medium' | 'high' | 'urgent';\n  dueDate: Date | null;\n  estimatedHours: number | null;\n  isCompleted: boolean;\n  completedAt: Date | null;\n  createdAt: Date;\n  updatedAt: Date;\n  createdBy: string;\n}\n```\n"
      }
    },
    {
      "timestamp": "2026-01-12T12:47:40.796Z",
      "event": "PostToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/refs/database-schema.md",
        "content": "# TaskFlow Database Schema\n\n> Reference: `ref-database-schema`\n\n## Entity Relationship Diagram\n\n```\n┌──────────────────────────────────────────────────────────────────────────────┐\n│                                                                              │\n│    ┌─────────┐         ┌──────────────────┐         ┌─────────────┐         │\n│    │  users  │────────►│ workspace_members │◄────────│ workspaces  │         │\n│    └────┬────┘         └──────────────────┘         └──────┬──────┘         │\n│         │                                                   │                │\n│         │              ┌────────────────┐                   │                │\n│         └─────────────►│  invitations   │◄──────────────────┘                │\n│                        └────────────────┘                                    │\n│                                                                              │\n│    ┌──────────────────────────────────────────────────────────────────────┐ │\n│    │                     WORKSPACE BOUNDARY                                │ │\n│    │                                                                       │ │\n│    │    ┌────────────┐                                                     │ │\n│    │    │   boards   │                                                     │ │\n│    │    └─────┬──────┘                                                     │ │\n│    │          │                                                            │ │\n│    │          ▼                                                            │ │\n│    │    ┌────────────┐                                                     │ │\n│    │    │  columns   │                                                     │ │\n│    │    └─────┬──────┘                                                     │ │\n│    │          │                                                            │ │\n│    │          ▼                                                            │ │\n│    │    ┌────────────┐    ┌───────────────┐    ┌────────────┐             │ │\n│    │    │   tasks    │───►│ task_assignees│    │   labels   │             │ │\n│    │    └─────┬──────┘    └───────────────┘    └──────┬─────┘             │ │\n│    │          │                                       │                    │ │\n│    │          │           ┌───────────────┐           │                    │ │\n│    │          └──────────►│  task_labels  │◄──────────┘                    │ │\n│    │          │           └───────────────┘                                │ │\n│    │          │                                                            │ │\n│    │          ▼                                                            │ │\n│    │    ┌────────────┐    ┌───────────────┐                                │ │\n│    │    │  comments  │    │  activities   │                                │ │\n│    │    └────────────┘    └───────────────┘                                │ │\n│    │                                                                       │ │\n│    └───────────────────────────────────────────────────────────────────────┘ │\n│                                                                              │\n│    ┌───────────────────┐                                                     │\n│    │   notifications   │                                                     │\n│    └───────────────────┘                                                     │\n│                                                                              │\n└──────────────────────────────────────────────────────────────────────────────┘\n```\n\n## Table Definitions\n\n### users\n\n```sql\nCREATE TABLE users (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    email           VARCHAR(255) NOT NULL UNIQUE,\n    name            VARCHAR(255) NOT NULL,\n    avatar_url      VARCHAR(500),\n    google_id       VARCHAR(255) UNIQUE,\n\n    -- Preferences\n    notification_email  BOOLEAN DEFAULT true,\n    theme              VARCHAR(20) DEFAULT 'light',\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    last_login_at   TIMESTAMP WITH TIME ZONE\n);\n\nCREATE INDEX idx_users_email ON users(email);\nCREATE INDEX idx_users_google_id ON users(google_id);\n```\n\n### workspaces\n\n```sql\nCREATE TABLE workspaces (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name            VARCHAR(255) NOT NULL,\n    slug            VARCHAR(100) NOT NULL UNIQUE,\n    description     TEXT,\n\n    -- Settings\n    default_board_id UUID,  -- FK added after boards table\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    created_by      UUID NOT NULL REFERENCES users(id)\n);\n\nCREATE INDEX idx_workspaces_slug ON workspaces(slug);\nCREATE INDEX idx_workspaces_created_by ON workspaces(created_by);\n```\n\n### workspace_members\n\n```sql\nCREATE TABLE workspace_members (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    role            VARCHAR(20) NOT NULL DEFAULT 'member',  -- 'admin', 'member'\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    UNIQUE(workspace_id, user_id)\n);\n\nCREATE INDEX idx_workspace_members_workspace ON workspace_members(workspace_id);\nCREATE INDEX idx_workspace_members_user ON workspace_members(user_id);\n```\n\n### invitations\n\n```sql\nCREATE TABLE invitations (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n    email           VARCHAR(255) NOT NULL,\n    role            VARCHAR(20) NOT NULL DEFAULT 'member',\n    token           VARCHAR(100) NOT NULL UNIQUE,\n\n    -- Status\n    status          VARCHAR(20) DEFAULT 'pending',  -- 'pending', 'accepted', 'expired'\n    expires_at      TIMESTAMP WITH TIME ZONE NOT NULL,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    invited_by      UUID NOT NULL REFERENCES users(id),\n    accepted_at     TIMESTAMP WITH TIME ZONE,\n\n    UNIQUE(workspace_id, email, status)  -- Only one pending per email per workspace\n);\n\nCREATE INDEX idx_invitations_workspace ON invitations(workspace_id);\nCREATE INDEX idx_invitations_email ON invitations(email);\nCREATE INDEX idx_invitations_token ON invitations(token);\n```\n\n### boards\n\n```sql\nCREATE TABLE boards (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n    name            VARCHAR(255) NOT NULL,\n    description     TEXT,\n    color           VARCHAR(7),  -- Hex color code\n    position        INTEGER NOT NULL DEFAULT 0,\n\n    -- Settings\n    is_archived     BOOLEAN DEFAULT false,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    created_by      UUID NOT NULL REFERENCES users(id)\n);\n\nCREATE INDEX idx_boards_workspace ON boards(workspace_id);\nCREATE INDEX idx_boards_workspace_position ON boards(workspace_id, position);\n```\n\n### columns\n\n```sql\nCREATE TABLE columns (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    board_id        UUID NOT NULL REFERENCES boards(id) ON DELETE CASCADE,\n    name            VARCHAR(100) NOT NULL,\n    position        INTEGER NOT NULL DEFAULT 0,\n    color           VARCHAR(7),  -- Hex color\n\n    -- Task limits\n    wip_limit       INTEGER,  -- Work in progress limit\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_columns_board ON columns(board_id);\nCREATE INDEX idx_columns_board_position ON columns(board_id, position);\n```\n\n### tasks\n\n```sql\nCREATE TABLE tasks (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    board_id        UUID NOT NULL REFERENCES boards(id) ON DELETE CASCADE,\n    column_id       UUID NOT NULL REFERENCES columns(id) ON DELETE CASCADE,\n\n    -- Content\n    title           VARCHAR(500) NOT NULL,\n    description     TEXT,\n    position        INTEGER NOT NULL DEFAULT 0,\n\n    -- Metadata\n    priority        VARCHAR(20) DEFAULT 'medium',  -- 'low', 'medium', 'high', 'urgent'\n    due_date        TIMESTAMP WITH TIME ZONE,\n    estimated_hours DECIMAL(5,2),\n\n    -- Status\n    is_completed    BOOLEAN DEFAULT false,\n    completed_at    TIMESTAMP WITH TIME ZONE,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    created_by      UUID NOT NULL REFERENCES users(id)\n);\n\nCREATE INDEX idx_tasks_board ON tasks(board_id);\nCREATE INDEX idx_tasks_column ON tasks(column_id);\nCREATE INDEX idx_tasks_column_position ON tasks(column_id, position);\nCREATE INDEX idx_tasks_due_date ON tasks(due_date) WHERE due_date IS NOT NULL;\nCREATE INDEX idx_tasks_created_by ON tasks(created_by);\n```\n\n### task_assignees\n\n```sql\nCREATE TABLE task_assignees (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    task_id         UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,\n    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    assigned_by     UUID NOT NULL REFERENCES users(id),\n\n    UNIQUE(task_id, user_id)\n);\n\nCREATE INDEX idx_task_assignees_task ON task_assignees(task_id);\nCREATE INDEX idx_task_assignees_user ON task_assignees(user_id);\n```\n\n### labels\n\n```sql\nCREATE TABLE labels (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n    name            VARCHAR(50) NOT NULL,\n    color           VARCHAR(7) NOT NULL,  -- Hex color\n\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    UNIQUE(workspace_id, name)\n);\n\nCREATE INDEX idx_labels_workspace ON labels(workspace_id);\n```\n\n### task_labels\n\n```sql\nCREATE TABLE task_labels (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    task_id         UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,\n    label_id        UUID NOT NULL REFERENCES labels(id) ON DELETE CASCADE,\n\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    UNIQUE(task_id, label_id)\n);\n\nCREATE INDEX idx_task_labels_task ON task_labels(task_id);\nCREATE INDEX idx_task_labels_label ON task_labels(label_id);\n```\n\n### comments\n\n```sql\nCREATE TABLE comments (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    task_id         UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,\n    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    content         TEXT NOT NULL,\n\n    -- Edit tracking\n    is_edited       BOOLEAN DEFAULT false,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_comments_task ON comments(task_id);\nCREATE INDEX idx_comments_user ON comments(user_id);\nCREATE INDEX idx_comments_task_created ON comments(task_id, created_at);\n```\n\n### activities\n\n```sql\nCREATE TABLE activities (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n\n    -- Actor\n    user_id         UUID NOT NULL REFERENCES users(id),\n\n    -- Target\n    entity_type     VARCHAR(50) NOT NULL,  -- 'task', 'board', 'comment', 'workspace'\n    entity_id       UUID NOT NULL,\n\n    -- Action\n    action          VARCHAR(50) NOT NULL,  -- 'created', 'updated', 'deleted', 'moved', etc.\n    changes         JSONB,  -- { field: { old: value, new: value } }\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_activities_workspace ON activities(workspace_id);\nCREATE INDEX idx_activities_entity ON activities(entity_type, entity_id);\nCREATE INDEX idx_activities_user ON activities(user_id);\nCREATE INDEX idx_activities_workspace_created ON activities(workspace_id, created_at DESC);\n```\n\n### notifications\n\n```sql\nCREATE TABLE notifications (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    -- Content\n    type            VARCHAR(50) NOT NULL,  -- 'task.assigned', 'comment.mention', etc.\n    title           VARCHAR(255) NOT NULL,\n    body            TEXT,\n\n    -- Reference\n    entity_type     VARCHAR(50),\n    entity_id       UUID,\n    workspace_id    UUID REFERENCES workspaces(id) ON DELETE CASCADE,\n\n    -- Status\n    is_read         BOOLEAN DEFAULT false,\n    read_at         TIMESTAMP WITH TIME ZONE,\n\n    -- Delivery\n    email_sent      BOOLEAN DEFAULT false,\n    email_sent_at   TIMESTAMP WITH TIME ZONE,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_notifications_user ON notifications(user_id);\nCREATE INDEX idx_notifications_user_unread ON notifications(user_id, is_read) WHERE is_read = false;\nCREATE INDEX idx_notifications_user_created ON notifications(user_id, created_at DESC);\n```\n\n## Row-Level Security (RLS)\n\nFor multi-tenant isolation, we use PostgreSQL Row-Level Security:\n\n```sql\n-- Enable RLS on tenant-scoped tables\nALTER TABLE boards ENABLE ROW LEVEL SECURITY;\nALTER TABLE columns ENABLE ROW LEVEL SECURITY;\nALTER TABLE tasks ENABLE ROW LEVEL SECURITY;\nALTER TABLE labels ENABLE ROW LEVEL SECURITY;\nALTER TABLE activities ENABLE ROW LEVEL SECURITY;\n\n-- Example policy for boards\nCREATE POLICY boards_tenant_isolation ON boards\n    USING (workspace_id = current_setting('app.current_workspace_id')::uuid);\n\n-- Set workspace context before queries\nSET app.current_workspace_id = 'workspace-uuid-here';\n```\n\n## Migrations\n\nMigrations are stored in `apps/api/src/foundation/database/migrations/`:\n\n| Migration | Description |\n|-----------|-------------|\n| `001_initial.sql` | Users table |\n| `002_workspaces.sql` | Workspaces, members, invitations |\n| `003_boards.sql` | Boards, columns |\n| `004_tasks.sql` | Tasks, assignees, labels |\n| `005_comments.sql` | Comments |\n| `006_activities.sql` | Activity log |\n| `007_notifications.sql` | Notifications |\n| `008_indexes.sql` | Performance indexes |\n| `009_rls.sql` | Row-level security policies |\n\n## TypeScript Types\n\n```typescript\n// Generated from schema\ninterface User {\n  id: string;\n  email: string;\n  name: string;\n  avatarUrl: string | null;\n  googleId: string | null;\n  notificationEmail: boolean;\n  theme: 'light' | 'dark';\n  createdAt: Date;\n  updatedAt: Date;\n  lastLoginAt: Date | null;\n}\n\ninterface Workspace {\n  id: string;\n  name: string;\n  slug: string;\n  description: string | null;\n  defaultBoardId: string | null;\n  createdAt: Date;\n  updatedAt: Date;\n  createdBy: string;\n}\n\ninterface Task {\n  id: string;\n  boardId: string;\n  columnId: string;\n  title: string;\n  description: string | null;\n  position: number;\n  priority: 'low' | 'medium' | 'high' | 'urgent';\n  dueDate: Date | null;\n  estimatedHours: number | null;\n  isCompleted: boolean;\n  completedAt: Date | null;\n  createdAt: Date;\n  updatedAt: Date;\n  createdBy: string;\n}\n```\n"
      },
      "result": {
        "type": "create",
        "filePath": "/tmp/tmp.ePSVRl4JKW/.c3/refs/database-schema.md",
        "content": "# TaskFlow Database Schema\n\n> Reference: `ref-database-schema`\n\n## Entity Relationship Diagram\n\n```\n┌──────────────────────────────────────────────────────────────────────────────┐\n│                                                                              │\n│    ┌─────────┐         ┌──────────────────┐         ┌─────────────┐         │\n│    │  users  │────────►│ workspace_members │◄────────│ workspaces  │         │\n│    └────┬────┘         └──────────────────┘         └──────┬──────┘         │\n│         │                                                   │                │\n│         │              ┌────────────────┐                   │                │\n│         └─────────────►│  invitations   │◄──────────────────┘                │\n│                        └────────────────┘                                    │\n│                                                                              │\n│    ┌──────────────────────────────────────────────────────────────────────┐ │\n│    │                     WORKSPACE BOUNDARY                                │ │\n│    │                                                                       │ │\n│    │    ┌────────────┐                                                     │ │\n│    │    │   boards   │                                                     │ │\n│    │    └─────┬──────┘                                                     │ │\n│    │          │                                                            │ │\n│    │          ▼                                                            │ │\n│    │    ┌────────────┐                                                     │ │\n│    │    │  columns   │                                                     │ │\n│    │    └─────┬──────┘                                                     │ │\n│    │          │                                                            │ │\n│    │          ▼                                                            │ │\n│    │    ┌────────────┐    ┌───────────────┐    ┌────────────┐             │ │\n│    │    │   tasks    │───►│ task_assignees│    │   labels   │             │ │\n│    │    └─────┬──────┘    └───────────────┘    └──────┬─────┘             │ │\n│    │          │                                       │                    │ │\n│    │          │           ┌───────────────┐           │                    │ │\n│    │          └──────────►│  task_labels  │◄──────────┘                    │ │\n│    │          │           └───────────────┘                                │ │\n│    │          │                                                            │ │\n│    │          ▼                                                            │ │\n│    │    ┌────────────┐    ┌───────────────┐                                │ │\n│    │    │  comments  │    │  activities   │                                │ │\n│    │    └────────────┘    └───────────────┘                                │ │\n│    │                                                                       │ │\n│    └───────────────────────────────────────────────────────────────────────┘ │\n│                                                                              │\n│    ┌───────────────────┐                                                     │\n│    │   notifications   │                                                     │\n│    └───────────────────┘                                                     │\n│                                                                              │\n└──────────────────────────────────────────────────────────────────────────────┘\n```\n\n## Table Definitions\n\n### users\n\n```sql\nCREATE TABLE users (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    email           VARCHAR(255) NOT NULL UNIQUE,\n    name            VARCHAR(255) NOT NULL,\n    avatar_url      VARCHAR(500),\n    google_id       VARCHAR(255) UNIQUE,\n\n    -- Preferences\n    notification_email  BOOLEAN DEFAULT true,\n    theme              VARCHAR(20) DEFAULT 'light',\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    last_login_at   TIMESTAMP WITH TIME ZONE\n);\n\nCREATE INDEX idx_users_email ON users(email);\nCREATE INDEX idx_users_google_id ON users(google_id);\n```\n\n### workspaces\n\n```sql\nCREATE TABLE workspaces (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name            VARCHAR(255) NOT NULL,\n    slug            VARCHAR(100) NOT NULL UNIQUE,\n    description     TEXT,\n\n    -- Settings\n    default_board_id UUID,  -- FK added after boards table\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    created_by      UUID NOT NULL REFERENCES users(id)\n);\n\nCREATE INDEX idx_workspaces_slug ON workspaces(slug);\nCREATE INDEX idx_workspaces_created_by ON workspaces(created_by);\n```\n\n### workspace_members\n\n```sql\nCREATE TABLE workspace_members (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    role            VARCHAR(20) NOT NULL DEFAULT 'member',  -- 'admin', 'member'\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    UNIQUE(workspace_id, user_id)\n);\n\nCREATE INDEX idx_workspace_members_workspace ON workspace_members(workspace_id);\nCREATE INDEX idx_workspace_members_user ON workspace_members(user_id);\n```\n\n### invitations\n\n```sql\nCREATE TABLE invitations (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n    email           VARCHAR(255) NOT NULL,\n    role            VARCHAR(20) NOT NULL DEFAULT 'member',\n    token           VARCHAR(100) NOT NULL UNIQUE,\n\n    -- Status\n    status          VARCHAR(20) DEFAULT 'pending',  -- 'pending', 'accepted', 'expired'\n    expires_at      TIMESTAMP WITH TIME ZONE NOT NULL,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    invited_by      UUID NOT NULL REFERENCES users(id),\n    accepted_at     TIMESTAMP WITH TIME ZONE,\n\n    UNIQUE(workspace_id, email, status)  -- Only one pending per email per workspace\n);\n\nCREATE INDEX idx_invitations_workspace ON invitations(workspace_id);\nCREATE INDEX idx_invitations_email ON invitations(email);\nCREATE INDEX idx_invitations_token ON invitations(token);\n```\n\n### boards\n\n```sql\nCREATE TABLE boards (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n    name            VARCHAR(255) NOT NULL,\n    description     TEXT,\n    color           VARCHAR(7),  -- Hex color code\n    position        INTEGER NOT NULL DEFAULT 0,\n\n    -- Settings\n    is_archived     BOOLEAN DEFAULT false,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    created_by      UUID NOT NULL REFERENCES users(id)\n);\n\nCREATE INDEX idx_boards_workspace ON boards(workspace_id);\nCREATE INDEX idx_boards_workspace_position ON boards(workspace_id, position);\n```\n\n### columns\n\n```sql\nCREATE TABLE columns (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    board_id        UUID NOT NULL REFERENCES boards(id) ON DELETE CASCADE,\n    name            VARCHAR(100) NOT NULL,\n    position        INTEGER NOT NULL DEFAULT 0,\n    color           VARCHAR(7),  -- Hex color\n\n    -- Task limits\n    wip_limit       INTEGER,  -- Work in progress limit\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_columns_board ON columns(board_id);\nCREATE INDEX idx_columns_board_position ON columns(board_id, position);\n```\n\n### tasks\n\n```sql\nCREATE TABLE tasks (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    board_id        UUID NOT NULL REFERENCES boards(id) ON DELETE CASCADE,\n    column_id       UUID NOT NULL REFERENCES columns(id) ON DELETE CASCADE,\n\n    -- Content\n    title           VARCHAR(500) NOT NULL,\n    description     TEXT,\n    position        INTEGER NOT NULL DEFAULT 0,\n\n    -- Metadata\n    priority        VARCHAR(20) DEFAULT 'medium',  -- 'low', 'medium', 'high', 'urgent'\n    due_date        TIMESTAMP WITH TIME ZONE,\n    estimated_hours DECIMAL(5,2),\n\n    -- Status\n    is_completed    BOOLEAN DEFAULT false,\n    completed_at    TIMESTAMP WITH TIME ZONE,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    created_by      UUID NOT NULL REFERENCES users(id)\n);\n\nCREATE INDEX idx_tasks_board ON tasks(board_id);\nCREATE INDEX idx_tasks_column ON tasks(column_id);\nCREATE INDEX idx_tasks_column_position ON tasks(column_id, position);\nCREATE INDEX idx_tasks_due_date ON tasks(due_date) WHERE due_date IS NOT NULL;\nCREATE INDEX idx_tasks_created_by ON tasks(created_by);\n```\n\n### task_assignees\n\n```sql\nCREATE TABLE task_assignees (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    task_id         UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,\n    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    assigned_by     UUID NOT NULL REFERENCES users(id),\n\n    UNIQUE(task_id, user_id)\n);\n\nCREATE INDEX idx_task_assignees_task ON task_assignees(task_id);\nCREATE INDEX idx_task_assignees_user ON task_assignees(user_id);\n```\n\n### labels\n\n```sql\nCREATE TABLE labels (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n    name            VARCHAR(50) NOT NULL,\n    color           VARCHAR(7) NOT NULL,  -- Hex color\n\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    UNIQUE(workspace_id, name)\n);\n\nCREATE INDEX idx_labels_workspace ON labels(workspace_id);\n```\n\n### task_labels\n\n```sql\nCREATE TABLE task_labels (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    task_id         UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,\n    label_id        UUID NOT NULL REFERENCES labels(id) ON DELETE CASCADE,\n\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    UNIQUE(task_id, label_id)\n);\n\nCREATE INDEX idx_task_labels_task ON task_labels(task_id);\nCREATE INDEX idx_task_labels_label ON task_labels(label_id);\n```\n\n### comments\n\n```sql\nCREATE TABLE comments (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    task_id         UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,\n    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    content         TEXT NOT NULL,\n\n    -- Edit tracking\n    is_edited       BOOLEAN DEFAULT false,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_comments_task ON comments(task_id);\nCREATE INDEX idx_comments_user ON comments(user_id);\nCREATE INDEX idx_comments_task_created ON comments(task_id, created_at);\n```\n\n### activities\n\n```sql\nCREATE TABLE activities (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    workspace_id    UUID NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,\n\n    -- Actor\n    user_id         UUID NOT NULL REFERENCES users(id),\n\n    -- Target\n    entity_type     VARCHAR(50) NOT NULL,  -- 'task', 'board', 'comment', 'workspace'\n    entity_id       UUID NOT NULL,\n\n    -- Action\n    action          VARCHAR(50) NOT NULL,  -- 'created', 'updated', 'deleted', 'moved', etc.\n    changes         JSONB,  -- { field: { old: value, new: value } }\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_activities_workspace ON activities(workspace_id);\nCREATE INDEX idx_activities_entity ON activities(entity_type, entity_id);\nCREATE INDEX idx_activities_user ON activities(user_id);\nCREATE INDEX idx_activities_workspace_created ON activities(workspace_id, created_at DESC);\n```\n\n### notifications\n\n```sql\nCREATE TABLE notifications (\n    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id         UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    -- Content\n    type            VARCHAR(50) NOT NULL,  -- 'task.assigned', 'comment.mention', etc.\n    title           VARCHAR(255) NOT NULL,\n    body            TEXT,\n\n    -- Reference\n    entity_type     VARCHAR(50),\n    entity_id       UUID,\n    workspace_id    UUID REFERENCES workspaces(id) ON DELETE CASCADE,\n\n    -- Status\n    is_read         BOOLEAN DEFAULT false,\n    read_at         TIMESTAMP WITH TIME ZONE,\n\n    -- Delivery\n    email_sent      BOOLEAN DEFAULT false,\n    email_sent_at   TIMESTAMP WITH TIME ZONE,\n\n    -- Timestamps\n    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_notifications_user ON notifications(user_id);\nCREATE INDEX idx_notifications_user_unread ON notifications(user_id, is_read) WHERE is_read = false;\nCREATE INDEX idx_notifications_user_created ON notifications(user_id, created_at DESC);\n```\n\n## Row-Level Security (RLS)\n\nFor multi-tenant isolation, we use PostgreSQL Row-Level Security:\n\n```sql\n-- Enable RLS on tenant-scoped tables\nALTER TABLE boards ENABLE ROW LEVEL SECURITY;\nALTER TABLE columns ENABLE ROW LEVEL SECURITY;\nALTER TABLE tasks ENABLE ROW LEVEL SECURITY;\nALTER TABLE labels ENABLE ROW LEVEL SECURITY;\nALTER TABLE activities ENABLE ROW LEVEL SECURITY;\n\n-- Example policy for boards\nCREATE POLICY boards_tenant_isolation ON boards\n    USING (workspace_id = current_setting('app.current_workspace_id')::uuid);\n\n-- Set workspace context before queries\nSET app.current_workspace_id = 'workspace-uuid-here';\n```\n\n## Migrations\n\nMigrations are stored in `apps/api/src/foundation/database/migrations/`:\n\n| Migration | Description |\n|-----------|-------------|\n| `001_initial.sql` | Users table |\n| `002_workspaces.sql` | Workspaces, members, invitations |\n| `003_boards.sql` | Boards, columns |\n| `004_tasks.sql` | Tasks, assignees, labels |\n| `005_comments.sql` | Comments |\n| `006_activities.sql` | Activity log |\n| `007_notifications.sql` | Notifications |\n| `008_indexes.sql` | Performance indexes |\n| `009_rls.sql` | Row-level security policies |\n\n## TypeScript Types\n\n```typescript\n// Generated from schema\ninterface User {\n  id: string;\n  email: string;\n  name: string;\n  avatarUrl: string | null;\n  googleId: string | null;\n  notificationEmail: boolean;\n  theme: 'light' | 'dark';\n  createdAt: Date;\n  updatedAt: Date;\n  lastLoginAt: Date | null;\n}\n\ninterface Workspace {\n  id: string;\n  name: string;\n  slug: string;\n  description: string | null;\n  defaultBoardId: string | null;\n  createdAt: Date;\n  updatedAt: Date;\n  createdBy: string;\n}\n\ninterface Task {\n  id: string;\n  boardId: string;\n  columnId: string;\n  title: string;\n  description: string | null;\n  position: number;\n  priority: 'low' | 'medium' | 'high' | 'urgent';\n  dueDate: Date | null;\n  estimatedHours: number | null;\n  isCompleted: boolean;\n  completedAt: Date | null;\n  createdAt: Date;\n  updatedAt: Date;\n  createdBy: string;\n}\n```\n",
        "structuredPatch": [],
        "originalFile": null
      }
    },
    {
      "timestamp": "2026-01-12T12:48:32.122Z",
      "event": "PreToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/refs/api-contracts.md",
        "content": "# TaskFlow API Contracts\n\n> Reference: `ref-api-contracts`\n\n## Overview\n\nThe TaskFlow API is a RESTful JSON API with the following conventions:\n- Base URL: `/api/v1`\n- Authentication: Bearer JWT tokens\n- Content-Type: `application/json`\n- All responses follow a standard envelope\n\n## Response Envelope\n\n### Success Response\n```typescript\n{\n  \"data\": T,                    // The response payload\n  \"meta\": {                     // Optional metadata\n    \"page\": number,\n    \"pageSize\": number,\n    \"total\": number,\n    \"cursor\": string\n  }\n}\n```\n\n### Error Response\n```typescript\n{\n  \"error\": {\n    \"code\": string,             // Machine-readable error code\n    \"message\": string,          // Human-readable message\n    \"details\": object | null,   // Additional context\n    \"requestId\": string         // For debugging\n  }\n}\n```\n\n## Authentication\n\n### Google OAuth Flow\n\n#### 1. Initiate Login\n```http\nGET /api/v1/auth/google\n```\n\nRedirects to Google OAuth consent page.\n\n#### 2. OAuth Callback\n```http\nGET /api/v1/auth/google/callback?code={code}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"expiresIn\": 3600,\n    \"user\": {\n      \"id\": \"uuid\",\n      \"email\": \"user@example.com\",\n      \"name\": \"John Doe\",\n      \"avatarUrl\": \"https://...\"\n    }\n  }\n}\n```\n\n#### 3. Refresh Token\n```http\nPOST /api/v1/auth/refresh\nAuthorization: Bearer {refreshToken}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"expiresIn\": 3600\n  }\n}\n```\n\n#### 4. Logout\n```http\nPOST /api/v1/auth/logout\nAuthorization: Bearer {accessToken}\n```\n\n**Response:**\n```json\n{\n  \"data\": { \"success\": true }\n}\n```\n\n---\n\n## Users\n\n### Get Current User\n```http\nGET /api/v1/users/me\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"email\": \"user@example.com\",\n    \"name\": \"John Doe\",\n    \"avatarUrl\": \"https://...\",\n    \"notificationEmail\": true,\n    \"theme\": \"light\",\n    \"createdAt\": \"2024-01-15T10:30:00Z\",\n    \"workspaces\": [\n      {\n        \"id\": \"uuid\",\n        \"name\": \"My Team\",\n        \"slug\": \"my-team\",\n        \"role\": \"admin\"\n      }\n    ]\n  }\n}\n```\n\n### Update Profile\n```http\nPATCH /api/v1/users/me\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Jane Doe\",\n  \"notificationEmail\": false,\n  \"theme\": \"dark\"\n}\n```\n\n### Search Users\n```http\nGET /api/v1/users/search?q={query}&workspaceId={workspaceId}\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"email\": \"user@example.com\",\n      \"name\": \"John Doe\",\n      \"avatarUrl\": \"https://...\"\n    }\n  ]\n}\n```\n\n---\n\n## Workspaces\n\n### List Workspaces\n```http\nGET /api/v1/workspaces\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"name\": \"My Team\",\n      \"slug\": \"my-team\",\n      \"description\": \"Our team workspace\",\n      \"role\": \"admin\",\n      \"memberCount\": 5,\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### Create Workspace\n```http\nPOST /api/v1/workspaces\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"New Team\",\n  \"description\": \"A new workspace\"\n}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"name\": \"New Team\",\n    \"slug\": \"new-team\",\n    \"description\": \"A new workspace\",\n    \"role\": \"admin\",\n    \"createdAt\": \"2024-01-15T10:30:00Z\"\n  }\n}\n```\n\n### Get Workspace\n```http\nGET /api/v1/workspaces/{workspaceId}\nAuthorization: Bearer {token}\n```\n\n### Update Workspace\n```http\nPATCH /api/v1/workspaces/{workspaceId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Updated Name\",\n  \"description\": \"Updated description\"\n}\n```\n\n### Delete Workspace\n```http\nDELETE /api/v1/workspaces/{workspaceId}\nAuthorization: Bearer {token}\n```\n\n### List Members\n```http\nGET /api/v1/workspaces/{workspaceId}/members\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"user\": {\n        \"id\": \"uuid\",\n        \"email\": \"user@example.com\",\n        \"name\": \"John Doe\",\n        \"avatarUrl\": \"https://...\"\n      },\n      \"role\": \"admin\",\n      \"joinedAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### Update Member Role\n```http\nPATCH /api/v1/workspaces/{workspaceId}/members/{userId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"role\": \"admin\"\n}\n```\n\n### Remove Member\n```http\nDELETE /api/v1/workspaces/{workspaceId}/members/{userId}\nAuthorization: Bearer {token}\n```\n\n### Send Invitation\n```http\nPOST /api/v1/workspaces/{workspaceId}/invitations\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"email\": \"newuser@example.com\",\n  \"role\": \"member\"\n}\n```\n\n### Accept Invitation\n```http\nPOST /api/v1/invitations/{token}/accept\nAuthorization: Bearer {token}\n```\n\n---\n\n## Boards\n\n### List Boards\n```http\nGET /api/v1/workspaces/{workspaceId}/boards\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"name\": \"Sprint 1\",\n      \"description\": \"Current sprint board\",\n      \"color\": \"#3B82F6\",\n      \"position\": 0,\n      \"taskCount\": 15,\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### Create Board\n```http\nPOST /api/v1/workspaces/{workspaceId}/boards\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"New Board\",\n  \"description\": \"A new kanban board\",\n  \"color\": \"#10B981\"\n}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"name\": \"New Board\",\n    \"description\": \"A new kanban board\",\n    \"color\": \"#10B981\",\n    \"position\": 1,\n    \"columns\": [\n      { \"id\": \"uuid\", \"name\": \"To Do\", \"position\": 0 },\n      { \"id\": \"uuid\", \"name\": \"In Progress\", \"position\": 1 },\n      { \"id\": \"uuid\", \"name\": \"Done\", \"position\": 2 }\n    ],\n    \"createdAt\": \"2024-01-15T10:30:00Z\"\n  }\n}\n```\n\n### Get Board (with all data)\n```http\nGET /api/v1/workspaces/{workspaceId}/boards/{boardId}\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"name\": \"Sprint 1\",\n    \"description\": \"Current sprint\",\n    \"color\": \"#3B82F6\",\n    \"columns\": [\n      {\n        \"id\": \"uuid\",\n        \"name\": \"To Do\",\n        \"position\": 0,\n        \"wipLimit\": 10,\n        \"tasks\": [\n          {\n            \"id\": \"uuid\",\n            \"title\": \"Implement login\",\n            \"position\": 0,\n            \"priority\": \"high\",\n            \"dueDate\": \"2024-01-20T00:00:00Z\",\n            \"assignees\": [\n              { \"id\": \"uuid\", \"name\": \"John\", \"avatarUrl\": \"...\" }\n            ],\n            \"labels\": [\n              { \"id\": \"uuid\", \"name\": \"frontend\", \"color\": \"#EF4444\" }\n            ],\n            \"commentCount\": 3\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Update Board\n```http\nPATCH /api/v1/workspaces/{workspaceId}/boards/{boardId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Updated Name\",\n  \"color\": \"#8B5CF6\"\n}\n```\n\n### Delete Board\n```http\nDELETE /api/v1/workspaces/{workspaceId}/boards/{boardId}\nAuthorization: Bearer {token}\n```\n\n### Create Column\n```http\nPOST /api/v1/workspaces/{workspaceId}/boards/{boardId}/columns\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Review\",\n  \"position\": 2,\n  \"wipLimit\": 5\n}\n```\n\n### Update Column\n```http\nPATCH /api/v1/workspaces/{workspaceId}/boards/{boardId}/columns/{columnId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Code Review\",\n  \"position\": 2\n}\n```\n\n### Delete Column\n```http\nDELETE /api/v1/workspaces/{workspaceId}/boards/{boardId}/columns/{columnId}\nAuthorization: Bearer {token}\n```\n\n---\n\n## Tasks\n\n### List Tasks\n```http\nGET /api/v1/workspaces/{workspaceId}/boards/{boardId}/tasks\nAuthorization: Bearer {token}\n```\n\nQuery parameters:\n- `columnId` - Filter by column\n- `assigneeId` - Filter by assignee\n- `priority` - Filter by priority\n- `dueDate` - Filter by due date (before/after)\n\n### Create Task\n```http\nPOST /api/v1/workspaces/{workspaceId}/boards/{boardId}/tasks\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"columnId\": \"uuid\",\n  \"title\": \"Implement feature X\",\n  \"description\": \"Detailed description...\",\n  \"priority\": \"high\",\n  \"dueDate\": \"2024-01-25T00:00:00Z\",\n  \"assigneeIds\": [\"uuid1\", \"uuid2\"],\n  \"labelIds\": [\"uuid1\"]\n}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"columnId\": \"uuid\",\n    \"title\": \"Implement feature X\",\n    \"description\": \"Detailed description...\",\n    \"position\": 0,\n    \"priority\": \"high\",\n    \"dueDate\": \"2024-01-25T00:00:00Z\",\n    \"isCompleted\": false,\n    \"assignees\": [...],\n    \"labels\": [...],\n    \"createdAt\": \"2024-01-15T10:30:00Z\",\n    \"createdBy\": { \"id\": \"uuid\", \"name\": \"John\" }\n  }\n}\n```\n\n### Get Task\n```http\nGET /api/v1/tasks/{taskId}\nAuthorization: Bearer {token}\n```\n\n**Response:** Full task with comments, activity\n\n### Update Task\n```http\nPATCH /api/v1/tasks/{taskId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"title\": \"Updated title\",\n  \"description\": \"Updated description\",\n  \"priority\": \"urgent\",\n  \"dueDate\": \"2024-01-30T00:00:00Z\"\n}\n```\n\n### Move Task\n```http\nPOST /api/v1/tasks/{taskId}/move\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"columnId\": \"uuid\",\n  \"position\": 2\n}\n```\n\n### Delete Task\n```http\nDELETE /api/v1/tasks/{taskId}\nAuthorization: Bearer {token}\n```\n\n### Add Assignee\n```http\nPOST /api/v1/tasks/{taskId}/assignees\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"userId\": \"uuid\"\n}\n```\n\n### Remove Assignee\n```http\nDELETE /api/v1/tasks/{taskId}/assignees/{userId}\nAuthorization: Bearer {token}\n```\n\n### Add Label\n```http\nPOST /api/v1/tasks/{taskId}/labels\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"labelId\": \"uuid\"\n}\n```\n\n### Remove Label\n```http\nDELETE /api/v1/tasks/{taskId}/labels/{labelId}\nAuthorization: Bearer {token}\n```\n\n---\n\n## Comments\n\n### List Comments\n```http\nGET /api/v1/tasks/{taskId}/comments\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"content\": \"This looks good! @jane can you review?\",\n      \"user\": {\n        \"id\": \"uuid\",\n        \"name\": \"John Doe\",\n        \"avatarUrl\": \"...\"\n      },\n      \"isEdited\": false,\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### Create Comment\n```http\nPOST /api/v1/tasks/{taskId}/comments\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"content\": \"Great work! Let's merge this.\"\n}\n```\n\n### Update Comment\n```http\nPATCH /api/v1/comments/{commentId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"content\": \"Updated comment text\"\n}\n```\n\n### Delete Comment\n```http\nDELETE /api/v1/comments/{commentId}\nAuthorization: Bearer {token}\n```\n\n---\n\n## Labels\n\n### List Labels\n```http\nGET /api/v1/workspaces/{workspaceId}/labels\nAuthorization: Bearer {token}\n```\n\n### Create Label\n```http\nPOST /api/v1/workspaces/{workspaceId}/labels\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"bug\",\n  \"color\": \"#EF4444\"\n}\n```\n\n### Update Label\n```http\nPATCH /api/v1/workspaces/{workspaceId}/labels/{labelId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"critical-bug\",\n  \"color\": \"#DC2626\"\n}\n```\n\n### Delete Label\n```http\nDELETE /api/v1/workspaces/{workspaceId}/labels/{labelId}\nAuthorization: Bearer {token}\n```\n\n---\n\n## Notifications\n\n### List Notifications\n```http\nGET /api/v1/notifications\nAuthorization: Bearer {token}\n```\n\nQuery parameters:\n- `unreadOnly` - Only unread notifications\n- `limit` - Number to return (default 20)\n- `cursor` - Pagination cursor\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"type\": \"task.assigned\",\n      \"title\": \"You were assigned to a task\",\n      \"body\": \"John assigned you to 'Implement login'\",\n      \"isRead\": false,\n      \"entityType\": \"task\",\n      \"entityId\": \"uuid\",\n      \"workspaceId\": \"uuid\",\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ],\n  \"meta\": {\n    \"unreadCount\": 5,\n    \"cursor\": \"next-cursor\"\n  }\n}\n```\n\n### Mark as Read\n```http\nPOST /api/v1/notifications/{notificationId}/read\nAuthorization: Bearer {token}\n```\n\n### Mark All as Read\n```http\nPOST /api/v1/notifications/read-all\nAuthorization: Bearer {token}\n```\n\n---\n\n## WebSocket Events\n\n### Connection\n```javascript\nconst socket = io('wss://api.taskflow.io', {\n  auth: { token: 'jwt-token' }\n});\n```\n\n### Join Board Room\n```javascript\nsocket.emit('board.join', { boardId: 'uuid' });\nsocket.on('board.joined', ({ boardId, activeUsers }) => { });\n```\n\n### Leave Board Room\n```javascript\nsocket.emit('board.leave', { boardId: 'uuid' });\n```\n\n### Task Events\n\n```javascript\n// Client → Server\nsocket.emit('task.create', {\n  boardId: 'uuid',\n  columnId: 'uuid',\n  title: 'New task'\n});\n\nsocket.emit('task.update', {\n  taskId: 'uuid',\n  changes: { title: 'Updated' }\n});\n\nsocket.emit('task.move', {\n  taskId: 'uuid',\n  columnId: 'uuid',\n  position: 2\n});\n\n// Server → Client\nsocket.on('task.created', (task) => { });\nsocket.on('task.updated', (task) => { });\nsocket.on('task.moved', ({ taskId, columnId, position }) => { });\nsocket.on('task.deleted', ({ taskId }) => { });\n```\n\n### Presence Events\n```javascript\nsocket.on('user.joined', ({ userId, user, boardId }) => { });\nsocket.on('user.left', ({ userId, boardId }) => { });\nsocket.on('user.cursor', ({ userId, position }) => { });  // Future: cursor tracking\n```\n\n---\n\n## Error Codes\n\nSee [error-codes.md](./error-codes.md) for complete error code reference.\n\n| Code | HTTP Status | Description |\n|------|-------------|-------------|\n| `AUTH_REQUIRED` | 401 | No valid token provided |\n| `AUTH_EXPIRED` | 401 | Token has expired |\n| `FORBIDDEN` | 403 | Insufficient permissions |\n| `NOT_FOUND` | 404 | Resource not found |\n| `VALIDATION_ERROR` | 400 | Invalid request body |\n| `CONFLICT` | 409 | Resource already exists |\n| `RATE_LIMITED` | 429 | Too many requests |\n"
      }
    },
    {
      "timestamp": "2026-01-12T12:48:32.136Z",
      "event": "PostToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/refs/api-contracts.md",
        "content": "# TaskFlow API Contracts\n\n> Reference: `ref-api-contracts`\n\n## Overview\n\nThe TaskFlow API is a RESTful JSON API with the following conventions:\n- Base URL: `/api/v1`\n- Authentication: Bearer JWT tokens\n- Content-Type: `application/json`\n- All responses follow a standard envelope\n\n## Response Envelope\n\n### Success Response\n```typescript\n{\n  \"data\": T,                    // The response payload\n  \"meta\": {                     // Optional metadata\n    \"page\": number,\n    \"pageSize\": number,\n    \"total\": number,\n    \"cursor\": string\n  }\n}\n```\n\n### Error Response\n```typescript\n{\n  \"error\": {\n    \"code\": string,             // Machine-readable error code\n    \"message\": string,          // Human-readable message\n    \"details\": object | null,   // Additional context\n    \"requestId\": string         // For debugging\n  }\n}\n```\n\n## Authentication\n\n### Google OAuth Flow\n\n#### 1. Initiate Login\n```http\nGET /api/v1/auth/google\n```\n\nRedirects to Google OAuth consent page.\n\n#### 2. OAuth Callback\n```http\nGET /api/v1/auth/google/callback?code={code}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"expiresIn\": 3600,\n    \"user\": {\n      \"id\": \"uuid\",\n      \"email\": \"user@example.com\",\n      \"name\": \"John Doe\",\n      \"avatarUrl\": \"https://...\"\n    }\n  }\n}\n```\n\n#### 3. Refresh Token\n```http\nPOST /api/v1/auth/refresh\nAuthorization: Bearer {refreshToken}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"expiresIn\": 3600\n  }\n}\n```\n\n#### 4. Logout\n```http\nPOST /api/v1/auth/logout\nAuthorization: Bearer {accessToken}\n```\n\n**Response:**\n```json\n{\n  \"data\": { \"success\": true }\n}\n```\n\n---\n\n## Users\n\n### Get Current User\n```http\nGET /api/v1/users/me\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"email\": \"user@example.com\",\n    \"name\": \"John Doe\",\n    \"avatarUrl\": \"https://...\",\n    \"notificationEmail\": true,\n    \"theme\": \"light\",\n    \"createdAt\": \"2024-01-15T10:30:00Z\",\n    \"workspaces\": [\n      {\n        \"id\": \"uuid\",\n        \"name\": \"My Team\",\n        \"slug\": \"my-team\",\n        \"role\": \"admin\"\n      }\n    ]\n  }\n}\n```\n\n### Update Profile\n```http\nPATCH /api/v1/users/me\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Jane Doe\",\n  \"notificationEmail\": false,\n  \"theme\": \"dark\"\n}\n```\n\n### Search Users\n```http\nGET /api/v1/users/search?q={query}&workspaceId={workspaceId}\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"email\": \"user@example.com\",\n      \"name\": \"John Doe\",\n      \"avatarUrl\": \"https://...\"\n    }\n  ]\n}\n```\n\n---\n\n## Workspaces\n\n### List Workspaces\n```http\nGET /api/v1/workspaces\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"name\": \"My Team\",\n      \"slug\": \"my-team\",\n      \"description\": \"Our team workspace\",\n      \"role\": \"admin\",\n      \"memberCount\": 5,\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### Create Workspace\n```http\nPOST /api/v1/workspaces\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"New Team\",\n  \"description\": \"A new workspace\"\n}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"name\": \"New Team\",\n    \"slug\": \"new-team\",\n    \"description\": \"A new workspace\",\n    \"role\": \"admin\",\n    \"createdAt\": \"2024-01-15T10:30:00Z\"\n  }\n}\n```\n\n### Get Workspace\n```http\nGET /api/v1/workspaces/{workspaceId}\nAuthorization: Bearer {token}\n```\n\n### Update Workspace\n```http\nPATCH /api/v1/workspaces/{workspaceId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Updated Name\",\n  \"description\": \"Updated description\"\n}\n```\n\n### Delete Workspace\n```http\nDELETE /api/v1/workspaces/{workspaceId}\nAuthorization: Bearer {token}\n```\n\n### List Members\n```http\nGET /api/v1/workspaces/{workspaceId}/members\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"user\": {\n        \"id\": \"uuid\",\n        \"email\": \"user@example.com\",\n        \"name\": \"John Doe\",\n        \"avatarUrl\": \"https://...\"\n      },\n      \"role\": \"admin\",\n      \"joinedAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### Update Member Role\n```http\nPATCH /api/v1/workspaces/{workspaceId}/members/{userId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"role\": \"admin\"\n}\n```\n\n### Remove Member\n```http\nDELETE /api/v1/workspaces/{workspaceId}/members/{userId}\nAuthorization: Bearer {token}\n```\n\n### Send Invitation\n```http\nPOST /api/v1/workspaces/{workspaceId}/invitations\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"email\": \"newuser@example.com\",\n  \"role\": \"member\"\n}\n```\n\n### Accept Invitation\n```http\nPOST /api/v1/invitations/{token}/accept\nAuthorization: Bearer {token}\n```\n\n---\n\n## Boards\n\n### List Boards\n```http\nGET /api/v1/workspaces/{workspaceId}/boards\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"name\": \"Sprint 1\",\n      \"description\": \"Current sprint board\",\n      \"color\": \"#3B82F6\",\n      \"position\": 0,\n      \"taskCount\": 15,\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### Create Board\n```http\nPOST /api/v1/workspaces/{workspaceId}/boards\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"New Board\",\n  \"description\": \"A new kanban board\",\n  \"color\": \"#10B981\"\n}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"name\": \"New Board\",\n    \"description\": \"A new kanban board\",\n    \"color\": \"#10B981\",\n    \"position\": 1,\n    \"columns\": [\n      { \"id\": \"uuid\", \"name\": \"To Do\", \"position\": 0 },\n      { \"id\": \"uuid\", \"name\": \"In Progress\", \"position\": 1 },\n      { \"id\": \"uuid\", \"name\": \"Done\", \"position\": 2 }\n    ],\n    \"createdAt\": \"2024-01-15T10:30:00Z\"\n  }\n}\n```\n\n### Get Board (with all data)\n```http\nGET /api/v1/workspaces/{workspaceId}/boards/{boardId}\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"name\": \"Sprint 1\",\n    \"description\": \"Current sprint\",\n    \"color\": \"#3B82F6\",\n    \"columns\": [\n      {\n        \"id\": \"uuid\",\n        \"name\": \"To Do\",\n        \"position\": 0,\n        \"wipLimit\": 10,\n        \"tasks\": [\n          {\n            \"id\": \"uuid\",\n            \"title\": \"Implement login\",\n            \"position\": 0,\n            \"priority\": \"high\",\n            \"dueDate\": \"2024-01-20T00:00:00Z\",\n            \"assignees\": [\n              { \"id\": \"uuid\", \"name\": \"John\", \"avatarUrl\": \"...\" }\n            ],\n            \"labels\": [\n              { \"id\": \"uuid\", \"name\": \"frontend\", \"color\": \"#EF4444\" }\n            ],\n            \"commentCount\": 3\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Update Board\n```http\nPATCH /api/v1/workspaces/{workspaceId}/boards/{boardId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Updated Name\",\n  \"color\": \"#8B5CF6\"\n}\n```\n\n### Delete Board\n```http\nDELETE /api/v1/workspaces/{workspaceId}/boards/{boardId}\nAuthorization: Bearer {token}\n```\n\n### Create Column\n```http\nPOST /api/v1/workspaces/{workspaceId}/boards/{boardId}/columns\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Review\",\n  \"position\": 2,\n  \"wipLimit\": 5\n}\n```\n\n### Update Column\n```http\nPATCH /api/v1/workspaces/{workspaceId}/boards/{boardId}/columns/{columnId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Code Review\",\n  \"position\": 2\n}\n```\n\n### Delete Column\n```http\nDELETE /api/v1/workspaces/{workspaceId}/boards/{boardId}/columns/{columnId}\nAuthorization: Bearer {token}\n```\n\n---\n\n## Tasks\n\n### List Tasks\n```http\nGET /api/v1/workspaces/{workspaceId}/boards/{boardId}/tasks\nAuthorization: Bearer {token}\n```\n\nQuery parameters:\n- `columnId` - Filter by column\n- `assigneeId` - Filter by assignee\n- `priority` - Filter by priority\n- `dueDate` - Filter by due date (before/after)\n\n### Create Task\n```http\nPOST /api/v1/workspaces/{workspaceId}/boards/{boardId}/tasks\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"columnId\": \"uuid\",\n  \"title\": \"Implement feature X\",\n  \"description\": \"Detailed description...\",\n  \"priority\": \"high\",\n  \"dueDate\": \"2024-01-25T00:00:00Z\",\n  \"assigneeIds\": [\"uuid1\", \"uuid2\"],\n  \"labelIds\": [\"uuid1\"]\n}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"columnId\": \"uuid\",\n    \"title\": \"Implement feature X\",\n    \"description\": \"Detailed description...\",\n    \"position\": 0,\n    \"priority\": \"high\",\n    \"dueDate\": \"2024-01-25T00:00:00Z\",\n    \"isCompleted\": false,\n    \"assignees\": [...],\n    \"labels\": [...],\n    \"createdAt\": \"2024-01-15T10:30:00Z\",\n    \"createdBy\": { \"id\": \"uuid\", \"name\": \"John\" }\n  }\n}\n```\n\n### Get Task\n```http\nGET /api/v1/tasks/{taskId}\nAuthorization: Bearer {token}\n```\n\n**Response:** Full task with comments, activity\n\n### Update Task\n```http\nPATCH /api/v1/tasks/{taskId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"title\": \"Updated title\",\n  \"description\": \"Updated description\",\n  \"priority\": \"urgent\",\n  \"dueDate\": \"2024-01-30T00:00:00Z\"\n}\n```\n\n### Move Task\n```http\nPOST /api/v1/tasks/{taskId}/move\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"columnId\": \"uuid\",\n  \"position\": 2\n}\n```\n\n### Delete Task\n```http\nDELETE /api/v1/tasks/{taskId}\nAuthorization: Bearer {token}\n```\n\n### Add Assignee\n```http\nPOST /api/v1/tasks/{taskId}/assignees\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"userId\": \"uuid\"\n}\n```\n\n### Remove Assignee\n```http\nDELETE /api/v1/tasks/{taskId}/assignees/{userId}\nAuthorization: Bearer {token}\n```\n\n### Add Label\n```http\nPOST /api/v1/tasks/{taskId}/labels\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"labelId\": \"uuid\"\n}\n```\n\n### Remove Label\n```http\nDELETE /api/v1/tasks/{taskId}/labels/{labelId}\nAuthorization: Bearer {token}\n```\n\n---\n\n## Comments\n\n### List Comments\n```http\nGET /api/v1/tasks/{taskId}/comments\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"content\": \"This looks good! @jane can you review?\",\n      \"user\": {\n        \"id\": \"uuid\",\n        \"name\": \"John Doe\",\n        \"avatarUrl\": \"...\"\n      },\n      \"isEdited\": false,\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### Create Comment\n```http\nPOST /api/v1/tasks/{taskId}/comments\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"content\": \"Great work! Let's merge this.\"\n}\n```\n\n### Update Comment\n```http\nPATCH /api/v1/comments/{commentId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"content\": \"Updated comment text\"\n}\n```\n\n### Delete Comment\n```http\nDELETE /api/v1/comments/{commentId}\nAuthorization: Bearer {token}\n```\n\n---\n\n## Labels\n\n### List Labels\n```http\nGET /api/v1/workspaces/{workspaceId}/labels\nAuthorization: Bearer {token}\n```\n\n### Create Label\n```http\nPOST /api/v1/workspaces/{workspaceId}/labels\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"bug\",\n  \"color\": \"#EF4444\"\n}\n```\n\n### Update Label\n```http\nPATCH /api/v1/workspaces/{workspaceId}/labels/{labelId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"critical-bug\",\n  \"color\": \"#DC2626\"\n}\n```\n\n### Delete Label\n```http\nDELETE /api/v1/workspaces/{workspaceId}/labels/{labelId}\nAuthorization: Bearer {token}\n```\n\n---\n\n## Notifications\n\n### List Notifications\n```http\nGET /api/v1/notifications\nAuthorization: Bearer {token}\n```\n\nQuery parameters:\n- `unreadOnly` - Only unread notifications\n- `limit` - Number to return (default 20)\n- `cursor` - Pagination cursor\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"type\": \"task.assigned\",\n      \"title\": \"You were assigned to a task\",\n      \"body\": \"John assigned you to 'Implement login'\",\n      \"isRead\": false,\n      \"entityType\": \"task\",\n      \"entityId\": \"uuid\",\n      \"workspaceId\": \"uuid\",\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ],\n  \"meta\": {\n    \"unreadCount\": 5,\n    \"cursor\": \"next-cursor\"\n  }\n}\n```\n\n### Mark as Read\n```http\nPOST /api/v1/notifications/{notificationId}/read\nAuthorization: Bearer {token}\n```\n\n### Mark All as Read\n```http\nPOST /api/v1/notifications/read-all\nAuthorization: Bearer {token}\n```\n\n---\n\n## WebSocket Events\n\n### Connection\n```javascript\nconst socket = io('wss://api.taskflow.io', {\n  auth: { token: 'jwt-token' }\n});\n```\n\n### Join Board Room\n```javascript\nsocket.emit('board.join', { boardId: 'uuid' });\nsocket.on('board.joined', ({ boardId, activeUsers }) => { });\n```\n\n### Leave Board Room\n```javascript\nsocket.emit('board.leave', { boardId: 'uuid' });\n```\n\n### Task Events\n\n```javascript\n// Client → Server\nsocket.emit('task.create', {\n  boardId: 'uuid',\n  columnId: 'uuid',\n  title: 'New task'\n});\n\nsocket.emit('task.update', {\n  taskId: 'uuid',\n  changes: { title: 'Updated' }\n});\n\nsocket.emit('task.move', {\n  taskId: 'uuid',\n  columnId: 'uuid',\n  position: 2\n});\n\n// Server → Client\nsocket.on('task.created', (task) => { });\nsocket.on('task.updated', (task) => { });\nsocket.on('task.moved', ({ taskId, columnId, position }) => { });\nsocket.on('task.deleted', ({ taskId }) => { });\n```\n\n### Presence Events\n```javascript\nsocket.on('user.joined', ({ userId, user, boardId }) => { });\nsocket.on('user.left', ({ userId, boardId }) => { });\nsocket.on('user.cursor', ({ userId, position }) => { });  // Future: cursor tracking\n```\n\n---\n\n## Error Codes\n\nSee [error-codes.md](./error-codes.md) for complete error code reference.\n\n| Code | HTTP Status | Description |\n|------|-------------|-------------|\n| `AUTH_REQUIRED` | 401 | No valid token provided |\n| `AUTH_EXPIRED` | 401 | Token has expired |\n| `FORBIDDEN` | 403 | Insufficient permissions |\n| `NOT_FOUND` | 404 | Resource not found |\n| `VALIDATION_ERROR` | 400 | Invalid request body |\n| `CONFLICT` | 409 | Resource already exists |\n| `RATE_LIMITED` | 429 | Too many requests |\n"
      },
      "result": {
        "type": "create",
        "filePath": "/tmp/tmp.ePSVRl4JKW/.c3/refs/api-contracts.md",
        "content": "# TaskFlow API Contracts\n\n> Reference: `ref-api-contracts`\n\n## Overview\n\nThe TaskFlow API is a RESTful JSON API with the following conventions:\n- Base URL: `/api/v1`\n- Authentication: Bearer JWT tokens\n- Content-Type: `application/json`\n- All responses follow a standard envelope\n\n## Response Envelope\n\n### Success Response\n```typescript\n{\n  \"data\": T,                    // The response payload\n  \"meta\": {                     // Optional metadata\n    \"page\": number,\n    \"pageSize\": number,\n    \"total\": number,\n    \"cursor\": string\n  }\n}\n```\n\n### Error Response\n```typescript\n{\n  \"error\": {\n    \"code\": string,             // Machine-readable error code\n    \"message\": string,          // Human-readable message\n    \"details\": object | null,   // Additional context\n    \"requestId\": string         // For debugging\n  }\n}\n```\n\n## Authentication\n\n### Google OAuth Flow\n\n#### 1. Initiate Login\n```http\nGET /api/v1/auth/google\n```\n\nRedirects to Google OAuth consent page.\n\n#### 2. OAuth Callback\n```http\nGET /api/v1/auth/google/callback?code={code}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"expiresIn\": 3600,\n    \"user\": {\n      \"id\": \"uuid\",\n      \"email\": \"user@example.com\",\n      \"name\": \"John Doe\",\n      \"avatarUrl\": \"https://...\"\n    }\n  }\n}\n```\n\n#### 3. Refresh Token\n```http\nPOST /api/v1/auth/refresh\nAuthorization: Bearer {refreshToken}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"expiresIn\": 3600\n  }\n}\n```\n\n#### 4. Logout\n```http\nPOST /api/v1/auth/logout\nAuthorization: Bearer {accessToken}\n```\n\n**Response:**\n```json\n{\n  \"data\": { \"success\": true }\n}\n```\n\n---\n\n## Users\n\n### Get Current User\n```http\nGET /api/v1/users/me\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"email\": \"user@example.com\",\n    \"name\": \"John Doe\",\n    \"avatarUrl\": \"https://...\",\n    \"notificationEmail\": true,\n    \"theme\": \"light\",\n    \"createdAt\": \"2024-01-15T10:30:00Z\",\n    \"workspaces\": [\n      {\n        \"id\": \"uuid\",\n        \"name\": \"My Team\",\n        \"slug\": \"my-team\",\n        \"role\": \"admin\"\n      }\n    ]\n  }\n}\n```\n\n### Update Profile\n```http\nPATCH /api/v1/users/me\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Jane Doe\",\n  \"notificationEmail\": false,\n  \"theme\": \"dark\"\n}\n```\n\n### Search Users\n```http\nGET /api/v1/users/search?q={query}&workspaceId={workspaceId}\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"email\": \"user@example.com\",\n      \"name\": \"John Doe\",\n      \"avatarUrl\": \"https://...\"\n    }\n  ]\n}\n```\n\n---\n\n## Workspaces\n\n### List Workspaces\n```http\nGET /api/v1/workspaces\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"name\": \"My Team\",\n      \"slug\": \"my-team\",\n      \"description\": \"Our team workspace\",\n      \"role\": \"admin\",\n      \"memberCount\": 5,\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### Create Workspace\n```http\nPOST /api/v1/workspaces\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"New Team\",\n  \"description\": \"A new workspace\"\n}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"name\": \"New Team\",\n    \"slug\": \"new-team\",\n    \"description\": \"A new workspace\",\n    \"role\": \"admin\",\n    \"createdAt\": \"2024-01-15T10:30:00Z\"\n  }\n}\n```\n\n### Get Workspace\n```http\nGET /api/v1/workspaces/{workspaceId}\nAuthorization: Bearer {token}\n```\n\n### Update Workspace\n```http\nPATCH /api/v1/workspaces/{workspaceId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Updated Name\",\n  \"description\": \"Updated description\"\n}\n```\n\n### Delete Workspace\n```http\nDELETE /api/v1/workspaces/{workspaceId}\nAuthorization: Bearer {token}\n```\n\n### List Members\n```http\nGET /api/v1/workspaces/{workspaceId}/members\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"user\": {\n        \"id\": \"uuid\",\n        \"email\": \"user@example.com\",\n        \"name\": \"John Doe\",\n        \"avatarUrl\": \"https://...\"\n      },\n      \"role\": \"admin\",\n      \"joinedAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### Update Member Role\n```http\nPATCH /api/v1/workspaces/{workspaceId}/members/{userId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"role\": \"admin\"\n}\n```\n\n### Remove Member\n```http\nDELETE /api/v1/workspaces/{workspaceId}/members/{userId}\nAuthorization: Bearer {token}\n```\n\n### Send Invitation\n```http\nPOST /api/v1/workspaces/{workspaceId}/invitations\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"email\": \"newuser@example.com\",\n  \"role\": \"member\"\n}\n```\n\n### Accept Invitation\n```http\nPOST /api/v1/invitations/{token}/accept\nAuthorization: Bearer {token}\n```\n\n---\n\n## Boards\n\n### List Boards\n```http\nGET /api/v1/workspaces/{workspaceId}/boards\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"name\": \"Sprint 1\",\n      \"description\": \"Current sprint board\",\n      \"color\": \"#3B82F6\",\n      \"position\": 0,\n      \"taskCount\": 15,\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### Create Board\n```http\nPOST /api/v1/workspaces/{workspaceId}/boards\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"New Board\",\n  \"description\": \"A new kanban board\",\n  \"color\": \"#10B981\"\n}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"name\": \"New Board\",\n    \"description\": \"A new kanban board\",\n    \"color\": \"#10B981\",\n    \"position\": 1,\n    \"columns\": [\n      { \"id\": \"uuid\", \"name\": \"To Do\", \"position\": 0 },\n      { \"id\": \"uuid\", \"name\": \"In Progress\", \"position\": 1 },\n      { \"id\": \"uuid\", \"name\": \"Done\", \"position\": 2 }\n    ],\n    \"createdAt\": \"2024-01-15T10:30:00Z\"\n  }\n}\n```\n\n### Get Board (with all data)\n```http\nGET /api/v1/workspaces/{workspaceId}/boards/{boardId}\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"name\": \"Sprint 1\",\n    \"description\": \"Current sprint\",\n    \"color\": \"#3B82F6\",\n    \"columns\": [\n      {\n        \"id\": \"uuid\",\n        \"name\": \"To Do\",\n        \"position\": 0,\n        \"wipLimit\": 10,\n        \"tasks\": [\n          {\n            \"id\": \"uuid\",\n            \"title\": \"Implement login\",\n            \"position\": 0,\n            \"priority\": \"high\",\n            \"dueDate\": \"2024-01-20T00:00:00Z\",\n            \"assignees\": [\n              { \"id\": \"uuid\", \"name\": \"John\", \"avatarUrl\": \"...\" }\n            ],\n            \"labels\": [\n              { \"id\": \"uuid\", \"name\": \"frontend\", \"color\": \"#EF4444\" }\n            ],\n            \"commentCount\": 3\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Update Board\n```http\nPATCH /api/v1/workspaces/{workspaceId}/boards/{boardId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Updated Name\",\n  \"color\": \"#8B5CF6\"\n}\n```\n\n### Delete Board\n```http\nDELETE /api/v1/workspaces/{workspaceId}/boards/{boardId}\nAuthorization: Bearer {token}\n```\n\n### Create Column\n```http\nPOST /api/v1/workspaces/{workspaceId}/boards/{boardId}/columns\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Review\",\n  \"position\": 2,\n  \"wipLimit\": 5\n}\n```\n\n### Update Column\n```http\nPATCH /api/v1/workspaces/{workspaceId}/boards/{boardId}/columns/{columnId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"Code Review\",\n  \"position\": 2\n}\n```\n\n### Delete Column\n```http\nDELETE /api/v1/workspaces/{workspaceId}/boards/{boardId}/columns/{columnId}\nAuthorization: Bearer {token}\n```\n\n---\n\n## Tasks\n\n### List Tasks\n```http\nGET /api/v1/workspaces/{workspaceId}/boards/{boardId}/tasks\nAuthorization: Bearer {token}\n```\n\nQuery parameters:\n- `columnId` - Filter by column\n- `assigneeId` - Filter by assignee\n- `priority` - Filter by priority\n- `dueDate` - Filter by due date (before/after)\n\n### Create Task\n```http\nPOST /api/v1/workspaces/{workspaceId}/boards/{boardId}/tasks\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"columnId\": \"uuid\",\n  \"title\": \"Implement feature X\",\n  \"description\": \"Detailed description...\",\n  \"priority\": \"high\",\n  \"dueDate\": \"2024-01-25T00:00:00Z\",\n  \"assigneeIds\": [\"uuid1\", \"uuid2\"],\n  \"labelIds\": [\"uuid1\"]\n}\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uuid\",\n    \"columnId\": \"uuid\",\n    \"title\": \"Implement feature X\",\n    \"description\": \"Detailed description...\",\n    \"position\": 0,\n    \"priority\": \"high\",\n    \"dueDate\": \"2024-01-25T00:00:00Z\",\n    \"isCompleted\": false,\n    \"assignees\": [...],\n    \"labels\": [...],\n    \"createdAt\": \"2024-01-15T10:30:00Z\",\n    \"createdBy\": { \"id\": \"uuid\", \"name\": \"John\" }\n  }\n}\n```\n\n### Get Task\n```http\nGET /api/v1/tasks/{taskId}\nAuthorization: Bearer {token}\n```\n\n**Response:** Full task with comments, activity\n\n### Update Task\n```http\nPATCH /api/v1/tasks/{taskId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"title\": \"Updated title\",\n  \"description\": \"Updated description\",\n  \"priority\": \"urgent\",\n  \"dueDate\": \"2024-01-30T00:00:00Z\"\n}\n```\n\n### Move Task\n```http\nPOST /api/v1/tasks/{taskId}/move\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"columnId\": \"uuid\",\n  \"position\": 2\n}\n```\n\n### Delete Task\n```http\nDELETE /api/v1/tasks/{taskId}\nAuthorization: Bearer {token}\n```\n\n### Add Assignee\n```http\nPOST /api/v1/tasks/{taskId}/assignees\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"userId\": \"uuid\"\n}\n```\n\n### Remove Assignee\n```http\nDELETE /api/v1/tasks/{taskId}/assignees/{userId}\nAuthorization: Bearer {token}\n```\n\n### Add Label\n```http\nPOST /api/v1/tasks/{taskId}/labels\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"labelId\": \"uuid\"\n}\n```\n\n### Remove Label\n```http\nDELETE /api/v1/tasks/{taskId}/labels/{labelId}\nAuthorization: Bearer {token}\n```\n\n---\n\n## Comments\n\n### List Comments\n```http\nGET /api/v1/tasks/{taskId}/comments\nAuthorization: Bearer {token}\n```\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"content\": \"This looks good! @jane can you review?\",\n      \"user\": {\n        \"id\": \"uuid\",\n        \"name\": \"John Doe\",\n        \"avatarUrl\": \"...\"\n      },\n      \"isEdited\": false,\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n### Create Comment\n```http\nPOST /api/v1/tasks/{taskId}/comments\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"content\": \"Great work! Let's merge this.\"\n}\n```\n\n### Update Comment\n```http\nPATCH /api/v1/comments/{commentId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"content\": \"Updated comment text\"\n}\n```\n\n### Delete Comment\n```http\nDELETE /api/v1/comments/{commentId}\nAuthorization: Bearer {token}\n```\n\n---\n\n## Labels\n\n### List Labels\n```http\nGET /api/v1/workspaces/{workspaceId}/labels\nAuthorization: Bearer {token}\n```\n\n### Create Label\n```http\nPOST /api/v1/workspaces/{workspaceId}/labels\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"bug\",\n  \"color\": \"#EF4444\"\n}\n```\n\n### Update Label\n```http\nPATCH /api/v1/workspaces/{workspaceId}/labels/{labelId}\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"name\": \"critical-bug\",\n  \"color\": \"#DC2626\"\n}\n```\n\n### Delete Label\n```http\nDELETE /api/v1/workspaces/{workspaceId}/labels/{labelId}\nAuthorization: Bearer {token}\n```\n\n---\n\n## Notifications\n\n### List Notifications\n```http\nGET /api/v1/notifications\nAuthorization: Bearer {token}\n```\n\nQuery parameters:\n- `unreadOnly` - Only unread notifications\n- `limit` - Number to return (default 20)\n- `cursor` - Pagination cursor\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"type\": \"task.assigned\",\n      \"title\": \"You were assigned to a task\",\n      \"body\": \"John assigned you to 'Implement login'\",\n      \"isRead\": false,\n      \"entityType\": \"task\",\n      \"entityId\": \"uuid\",\n      \"workspaceId\": \"uuid\",\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ],\n  \"meta\": {\n    \"unreadCount\": 5,\n    \"cursor\": \"next-cursor\"\n  }\n}\n```\n\n### Mark as Read\n```http\nPOST /api/v1/notifications/{notificationId}/read\nAuthorization: Bearer {token}\n```\n\n### Mark All as Read\n```http\nPOST /api/v1/notifications/read-all\nAuthorization: Bearer {token}\n```\n\n---\n\n## WebSocket Events\n\n### Connection\n```javascript\nconst socket = io('wss://api.taskflow.io', {\n  auth: { token: 'jwt-token' }\n});\n```\n\n### Join Board Room\n```javascript\nsocket.emit('board.join', { boardId: 'uuid' });\nsocket.on('board.joined', ({ boardId, activeUsers }) => { });\n```\n\n### Leave Board Room\n```javascript\nsocket.emit('board.leave', { boardId: 'uuid' });\n```\n\n### Task Events\n\n```javascript\n// Client → Server\nsocket.emit('task.create', {\n  boardId: 'uuid',\n  columnId: 'uuid',\n  title: 'New task'\n});\n\nsocket.emit('task.update', {\n  taskId: 'uuid',\n  changes: { title: 'Updated' }\n});\n\nsocket.emit('task.move', {\n  taskId: 'uuid',\n  columnId: 'uuid',\n  position: 2\n});\n\n// Server → Client\nsocket.on('task.created', (task) => { });\nsocket.on('task.updated', (task) => { });\nsocket.on('task.moved', ({ taskId, columnId, position }) => { });\nsocket.on('task.deleted', ({ taskId }) => { });\n```\n\n### Presence Events\n```javascript\nsocket.on('user.joined', ({ userId, user, boardId }) => { });\nsocket.on('user.left', ({ userId, boardId }) => { });\nsocket.on('user.cursor', ({ userId, position }) => { });  // Future: cursor tracking\n```\n\n---\n\n## Error Codes\n\nSee [error-codes.md](./error-codes.md) for complete error code reference.\n\n| Code | HTTP Status | Description |\n|------|-------------|-------------|\n| `AUTH_REQUIRED` | 401 | No valid token provided |\n| `AUTH_EXPIRED` | 401 | Token has expired |\n| `FORBIDDEN` | 403 | Insufficient permissions |\n| `NOT_FOUND` | 404 | Resource not found |\n| `VALIDATION_ERROR` | 400 | Invalid request body |\n| `CONFLICT` | 409 | Resource already exists |\n| `RATE_LIMITED` | 429 | Too many requests |\n",
        "structuredPatch": [],
        "originalFile": null
      }
    },
    {
      "timestamp": "2026-01-12T12:49:05.591Z",
      "event": "PreToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/refs/error-codes.md",
        "content": "# TaskFlow Error Codes\n\n> Reference: `ref-error-codes`\n\n## Error Response Format\n\nAll API errors follow this format:\n\n```typescript\n{\n  \"error\": {\n    \"code\": string,           // Machine-readable error code\n    \"message\": string,        // Human-readable message\n    \"details\": object | null, // Additional context (validation errors, etc.)\n    \"requestId\": string       // Unique request ID for debugging\n  }\n}\n```\n\n## Error Code Categories\n\n### Authentication Errors (AUTH_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `AUTH_REQUIRED` | 401 | No authentication token provided | Include `Authorization: Bearer {token}` header |\n| `AUTH_INVALID` | 401 | Token is malformed or signature invalid | Obtain a new token via login |\n| `AUTH_EXPIRED` | 401 | Token has expired | Use refresh token to get new access token |\n| `AUTH_REVOKED` | 401 | Token has been revoked (logout) | Re-authenticate via login |\n| `AUTH_OAUTH_FAILED` | 400 | OAuth flow failed | Retry OAuth flow |\n| `AUTH_OAUTH_EMAIL_REQUIRED` | 400 | Email not provided by OAuth provider | Use different auth method or grant email permission |\n\n### Authorization Errors (FORBIDDEN_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `FORBIDDEN` | 403 | Generic permission denied | Check user has required role |\n| `FORBIDDEN_WORKSPACE` | 403 | Not a member of the workspace | Request invitation to workspace |\n| `FORBIDDEN_ADMIN_REQUIRED` | 403 | Admin role required for this action | Contact workspace admin |\n| `FORBIDDEN_OWNER_ONLY` | 403 | Only resource owner can perform action | Use owner account |\n| `FORBIDDEN_SELF_ACTION` | 403 | Cannot perform action on yourself | Use different target |\n\n### Resource Errors (NOT_FOUND_*, CONFLICT_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `NOT_FOUND` | 404 | Generic resource not found | Verify resource ID |\n| `NOT_FOUND_USER` | 404 | User does not exist | Check user ID |\n| `NOT_FOUND_WORKSPACE` | 404 | Workspace does not exist | Check workspace ID |\n| `NOT_FOUND_BOARD` | 404 | Board does not exist | Check board ID |\n| `NOT_FOUND_TASK` | 404 | Task does not exist | Check task ID |\n| `NOT_FOUND_COLUMN` | 404 | Column does not exist | Check column ID |\n| `NOT_FOUND_COMMENT` | 404 | Comment does not exist | Check comment ID |\n| `NOT_FOUND_INVITATION` | 404 | Invitation does not exist | Check invitation token |\n| `CONFLICT_EMAIL` | 409 | Email already registered | Use existing account or different email |\n| `CONFLICT_SLUG` | 409 | Workspace slug already taken | Choose different workspace name |\n| `CONFLICT_MEMBER` | 409 | User already a workspace member | No action needed |\n| `CONFLICT_INVITATION` | 409 | Pending invitation already exists | Use existing invitation |\n\n### Validation Errors (VALIDATION_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `VALIDATION_ERROR` | 400 | Request validation failed | Check `details` for specific field errors |\n| `VALIDATION_REQUIRED` | 400 | Required field missing | Provide required field |\n| `VALIDATION_FORMAT` | 400 | Field format invalid | Check field format requirements |\n| `VALIDATION_RANGE` | 400 | Value out of allowed range | Adjust value to valid range |\n| `VALIDATION_UNIQUE` | 400 | Value must be unique | Use different value |\n\n### Rate Limiting Errors (RATE_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `RATE_LIMITED` | 429 | Too many requests | Wait and retry after `Retry-After` header |\n| `RATE_LIMITED_AUTH` | 429 | Too many auth attempts | Wait before retrying login |\n| `RATE_LIMITED_API` | 429 | API rate limit exceeded | Reduce request frequency |\n\n### Business Logic Errors (BUSINESS_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `BUSINESS_WIP_LIMIT` | 400 | Column WIP limit reached | Move tasks out before adding |\n| `BUSINESS_LAST_ADMIN` | 400 | Cannot remove last admin | Assign another admin first |\n| `BUSINESS_SELF_INVITE` | 400 | Cannot invite yourself | Share invite with others |\n| `BUSINESS_INVITATION_EXPIRED` | 400 | Invitation has expired | Request new invitation |\n| `BUSINESS_INVITATION_USED` | 400 | Invitation already used | No action needed |\n\n### Server Errors (SERVER_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `SERVER_ERROR` | 500 | Internal server error | Retry later, report if persistent |\n| `SERVER_UNAVAILABLE` | 503 | Service temporarily unavailable | Retry after delay |\n| `SERVER_TIMEOUT` | 504 | Request timed out | Retry with shorter operation |\n| `SERVER_DATABASE` | 500 | Database error | Retry later |\n| `SERVER_CACHE` | 500 | Cache service error | Request may still succeed |\n\n## Validation Error Details\n\nWhen `VALIDATION_ERROR` is returned, the `details` field contains field-specific errors:\n\n```json\n{\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Request validation failed\",\n    \"details\": {\n      \"fields\": {\n        \"email\": {\n          \"code\": \"VALIDATION_FORMAT\",\n          \"message\": \"Invalid email format\"\n        },\n        \"name\": {\n          \"code\": \"VALIDATION_REQUIRED\",\n          \"message\": \"Name is required\"\n        },\n        \"priority\": {\n          \"code\": \"VALIDATION_RANGE\",\n          \"message\": \"Priority must be one of: low, medium, high, urgent\"\n        }\n      }\n    },\n    \"requestId\": \"req_abc123\"\n  }\n}\n```\n\n## Error Handling Best Practices\n\n### Client-Side\n\n```typescript\nasync function apiRequest(endpoint: string, options: RequestInit) {\n  const response = await fetch(endpoint, options);\n\n  if (!response.ok) {\n    const error = await response.json();\n\n    switch (error.error.code) {\n      case 'AUTH_EXPIRED':\n        // Try to refresh token\n        await refreshToken();\n        return apiRequest(endpoint, options);\n\n      case 'AUTH_REQUIRED':\n      case 'AUTH_INVALID':\n      case 'AUTH_REVOKED':\n        // Redirect to login\n        redirectToLogin();\n        break;\n\n      case 'RATE_LIMITED':\n        // Wait and retry\n        const retryAfter = response.headers.get('Retry-After') || 60;\n        await sleep(retryAfter * 1000);\n        return apiRequest(endpoint, options);\n\n      case 'VALIDATION_ERROR':\n        // Show field-specific errors\n        showValidationErrors(error.error.details.fields);\n        break;\n\n      default:\n        // Show generic error\n        showError(error.error.message);\n    }\n\n    throw new ApiError(error.error);\n  }\n\n  return response.json();\n}\n```\n\n### Server-Side\n\n```typescript\n// Custom error classes\nclass AppError extends Error {\n  constructor(\n    public code: string,\n    public statusCode: number,\n    message: string,\n    public details?: object\n  ) {\n    super(message);\n  }\n}\n\nclass AuthError extends AppError {\n  constructor(code: string, message: string) {\n    super(code, 401, message);\n  }\n}\n\nclass NotFoundError extends AppError {\n  constructor(resource: string, id: string) {\n    super(`NOT_FOUND_${resource.toUpperCase()}`, 404, `${resource} not found`);\n  }\n}\n\n// Express error handler\nfunction errorHandler(err: Error, req: Request, res: Response, next: NextFunction) {\n  const requestId = req.id;\n\n  if (err instanceof AppError) {\n    return res.status(err.statusCode).json({\n      error: {\n        code: err.code,\n        message: err.message,\n        details: err.details,\n        requestId\n      }\n    });\n  }\n\n  // Log unexpected errors\n  logger.error({ err, requestId }, 'Unexpected error');\n\n  return res.status(500).json({\n    error: {\n      code: 'SERVER_ERROR',\n      message: 'An unexpected error occurred',\n      requestId\n    }\n  });\n}\n```\n\n## HTTP Status Code Mapping\n\n| Status | Error Codes |\n|--------|-------------|\n| 400 | `VALIDATION_*`, `BUSINESS_*`, `AUTH_OAUTH_*` |\n| 401 | `AUTH_*` (except OAUTH) |\n| 403 | `FORBIDDEN_*` |\n| 404 | `NOT_FOUND_*` |\n| 409 | `CONFLICT_*` |\n| 429 | `RATE_*` |\n| 500 | `SERVER_ERROR`, `SERVER_DATABASE`, `SERVER_CACHE` |\n| 503 | `SERVER_UNAVAILABLE` |\n| 504 | `SERVER_TIMEOUT` |\n"
      }
    },
    {
      "timestamp": "2026-01-12T12:49:05.612Z",
      "event": "PostToolUse",
      "tool": "Write",
      "input": {
        "file_path": "/tmp/tmp.ePSVRl4JKW/.c3/refs/error-codes.md",
        "content": "# TaskFlow Error Codes\n\n> Reference: `ref-error-codes`\n\n## Error Response Format\n\nAll API errors follow this format:\n\n```typescript\n{\n  \"error\": {\n    \"code\": string,           // Machine-readable error code\n    \"message\": string,        // Human-readable message\n    \"details\": object | null, // Additional context (validation errors, etc.)\n    \"requestId\": string       // Unique request ID for debugging\n  }\n}\n```\n\n## Error Code Categories\n\n### Authentication Errors (AUTH_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `AUTH_REQUIRED` | 401 | No authentication token provided | Include `Authorization: Bearer {token}` header |\n| `AUTH_INVALID` | 401 | Token is malformed or signature invalid | Obtain a new token via login |\n| `AUTH_EXPIRED` | 401 | Token has expired | Use refresh token to get new access token |\n| `AUTH_REVOKED` | 401 | Token has been revoked (logout) | Re-authenticate via login |\n| `AUTH_OAUTH_FAILED` | 400 | OAuth flow failed | Retry OAuth flow |\n| `AUTH_OAUTH_EMAIL_REQUIRED` | 400 | Email not provided by OAuth provider | Use different auth method or grant email permission |\n\n### Authorization Errors (FORBIDDEN_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `FORBIDDEN` | 403 | Generic permission denied | Check user has required role |\n| `FORBIDDEN_WORKSPACE` | 403 | Not a member of the workspace | Request invitation to workspace |\n| `FORBIDDEN_ADMIN_REQUIRED` | 403 | Admin role required for this action | Contact workspace admin |\n| `FORBIDDEN_OWNER_ONLY` | 403 | Only resource owner can perform action | Use owner account |\n| `FORBIDDEN_SELF_ACTION` | 403 | Cannot perform action on yourself | Use different target |\n\n### Resource Errors (NOT_FOUND_*, CONFLICT_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `NOT_FOUND` | 404 | Generic resource not found | Verify resource ID |\n| `NOT_FOUND_USER` | 404 | User does not exist | Check user ID |\n| `NOT_FOUND_WORKSPACE` | 404 | Workspace does not exist | Check workspace ID |\n| `NOT_FOUND_BOARD` | 404 | Board does not exist | Check board ID |\n| `NOT_FOUND_TASK` | 404 | Task does not exist | Check task ID |\n| `NOT_FOUND_COLUMN` | 404 | Column does not exist | Check column ID |\n| `NOT_FOUND_COMMENT` | 404 | Comment does not exist | Check comment ID |\n| `NOT_FOUND_INVITATION` | 404 | Invitation does not exist | Check invitation token |\n| `CONFLICT_EMAIL` | 409 | Email already registered | Use existing account or different email |\n| `CONFLICT_SLUG` | 409 | Workspace slug already taken | Choose different workspace name |\n| `CONFLICT_MEMBER` | 409 | User already a workspace member | No action needed |\n| `CONFLICT_INVITATION` | 409 | Pending invitation already exists | Use existing invitation |\n\n### Validation Errors (VALIDATION_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `VALIDATION_ERROR` | 400 | Request validation failed | Check `details` for specific field errors |\n| `VALIDATION_REQUIRED` | 400 | Required field missing | Provide required field |\n| `VALIDATION_FORMAT` | 400 | Field format invalid | Check field format requirements |\n| `VALIDATION_RANGE` | 400 | Value out of allowed range | Adjust value to valid range |\n| `VALIDATION_UNIQUE` | 400 | Value must be unique | Use different value |\n\n### Rate Limiting Errors (RATE_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `RATE_LIMITED` | 429 | Too many requests | Wait and retry after `Retry-After` header |\n| `RATE_LIMITED_AUTH` | 429 | Too many auth attempts | Wait before retrying login |\n| `RATE_LIMITED_API` | 429 | API rate limit exceeded | Reduce request frequency |\n\n### Business Logic Errors (BUSINESS_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `BUSINESS_WIP_LIMIT` | 400 | Column WIP limit reached | Move tasks out before adding |\n| `BUSINESS_LAST_ADMIN` | 400 | Cannot remove last admin | Assign another admin first |\n| `BUSINESS_SELF_INVITE` | 400 | Cannot invite yourself | Share invite with others |\n| `BUSINESS_INVITATION_EXPIRED` | 400 | Invitation has expired | Request new invitation |\n| `BUSINESS_INVITATION_USED` | 400 | Invitation already used | No action needed |\n\n### Server Errors (SERVER_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `SERVER_ERROR` | 500 | Internal server error | Retry later, report if persistent |\n| `SERVER_UNAVAILABLE` | 503 | Service temporarily unavailable | Retry after delay |\n| `SERVER_TIMEOUT` | 504 | Request timed out | Retry with shorter operation |\n| `SERVER_DATABASE` | 500 | Database error | Retry later |\n| `SERVER_CACHE` | 500 | Cache service error | Request may still succeed |\n\n## Validation Error Details\n\nWhen `VALIDATION_ERROR` is returned, the `details` field contains field-specific errors:\n\n```json\n{\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Request validation failed\",\n    \"details\": {\n      \"fields\": {\n        \"email\": {\n          \"code\": \"VALIDATION_FORMAT\",\n          \"message\": \"Invalid email format\"\n        },\n        \"name\": {\n          \"code\": \"VALIDATION_REQUIRED\",\n          \"message\": \"Name is required\"\n        },\n        \"priority\": {\n          \"code\": \"VALIDATION_RANGE\",\n          \"message\": \"Priority must be one of: low, medium, high, urgent\"\n        }\n      }\n    },\n    \"requestId\": \"req_abc123\"\n  }\n}\n```\n\n## Error Handling Best Practices\n\n### Client-Side\n\n```typescript\nasync function apiRequest(endpoint: string, options: RequestInit) {\n  const response = await fetch(endpoint, options);\n\n  if (!response.ok) {\n    const error = await response.json();\n\n    switch (error.error.code) {\n      case 'AUTH_EXPIRED':\n        // Try to refresh token\n        await refreshToken();\n        return apiRequest(endpoint, options);\n\n      case 'AUTH_REQUIRED':\n      case 'AUTH_INVALID':\n      case 'AUTH_REVOKED':\n        // Redirect to login\n        redirectToLogin();\n        break;\n\n      case 'RATE_LIMITED':\n        // Wait and retry\n        const retryAfter = response.headers.get('Retry-After') || 60;\n        await sleep(retryAfter * 1000);\n        return apiRequest(endpoint, options);\n\n      case 'VALIDATION_ERROR':\n        // Show field-specific errors\n        showValidationErrors(error.error.details.fields);\n        break;\n\n      default:\n        // Show generic error\n        showError(error.error.message);\n    }\n\n    throw new ApiError(error.error);\n  }\n\n  return response.json();\n}\n```\n\n### Server-Side\n\n```typescript\n// Custom error classes\nclass AppError extends Error {\n  constructor(\n    public code: string,\n    public statusCode: number,\n    message: string,\n    public details?: object\n  ) {\n    super(message);\n  }\n}\n\nclass AuthError extends AppError {\n  constructor(code: string, message: string) {\n    super(code, 401, message);\n  }\n}\n\nclass NotFoundError extends AppError {\n  constructor(resource: string, id: string) {\n    super(`NOT_FOUND_${resource.toUpperCase()}`, 404, `${resource} not found`);\n  }\n}\n\n// Express error handler\nfunction errorHandler(err: Error, req: Request, res: Response, next: NextFunction) {\n  const requestId = req.id;\n\n  if (err instanceof AppError) {\n    return res.status(err.statusCode).json({\n      error: {\n        code: err.code,\n        message: err.message,\n        details: err.details,\n        requestId\n      }\n    });\n  }\n\n  // Log unexpected errors\n  logger.error({ err, requestId }, 'Unexpected error');\n\n  return res.status(500).json({\n    error: {\n      code: 'SERVER_ERROR',\n      message: 'An unexpected error occurred',\n      requestId\n    }\n  });\n}\n```\n\n## HTTP Status Code Mapping\n\n| Status | Error Codes |\n|--------|-------------|\n| 400 | `VALIDATION_*`, `BUSINESS_*`, `AUTH_OAUTH_*` |\n| 401 | `AUTH_*` (except OAUTH) |\n| 403 | `FORBIDDEN_*` |\n| 404 | `NOT_FOUND_*` |\n| 409 | `CONFLICT_*` |\n| 429 | `RATE_*` |\n| 500 | `SERVER_ERROR`, `SERVER_DATABASE`, `SERVER_CACHE` |\n| 503 | `SERVER_UNAVAILABLE` |\n| 504 | `SERVER_TIMEOUT` |\n"
      },
      "result": {
        "type": "create",
        "filePath": "/tmp/tmp.ePSVRl4JKW/.c3/refs/error-codes.md",
        "content": "# TaskFlow Error Codes\n\n> Reference: `ref-error-codes`\n\n## Error Response Format\n\nAll API errors follow this format:\n\n```typescript\n{\n  \"error\": {\n    \"code\": string,           // Machine-readable error code\n    \"message\": string,        // Human-readable message\n    \"details\": object | null, // Additional context (validation errors, etc.)\n    \"requestId\": string       // Unique request ID for debugging\n  }\n}\n```\n\n## Error Code Categories\n\n### Authentication Errors (AUTH_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `AUTH_REQUIRED` | 401 | No authentication token provided | Include `Authorization: Bearer {token}` header |\n| `AUTH_INVALID` | 401 | Token is malformed or signature invalid | Obtain a new token via login |\n| `AUTH_EXPIRED` | 401 | Token has expired | Use refresh token to get new access token |\n| `AUTH_REVOKED` | 401 | Token has been revoked (logout) | Re-authenticate via login |\n| `AUTH_OAUTH_FAILED` | 400 | OAuth flow failed | Retry OAuth flow |\n| `AUTH_OAUTH_EMAIL_REQUIRED` | 400 | Email not provided by OAuth provider | Use different auth method or grant email permission |\n\n### Authorization Errors (FORBIDDEN_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `FORBIDDEN` | 403 | Generic permission denied | Check user has required role |\n| `FORBIDDEN_WORKSPACE` | 403 | Not a member of the workspace | Request invitation to workspace |\n| `FORBIDDEN_ADMIN_REQUIRED` | 403 | Admin role required for this action | Contact workspace admin |\n| `FORBIDDEN_OWNER_ONLY` | 403 | Only resource owner can perform action | Use owner account |\n| `FORBIDDEN_SELF_ACTION` | 403 | Cannot perform action on yourself | Use different target |\n\n### Resource Errors (NOT_FOUND_*, CONFLICT_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `NOT_FOUND` | 404 | Generic resource not found | Verify resource ID |\n| `NOT_FOUND_USER` | 404 | User does not exist | Check user ID |\n| `NOT_FOUND_WORKSPACE` | 404 | Workspace does not exist | Check workspace ID |\n| `NOT_FOUND_BOARD` | 404 | Board does not exist | Check board ID |\n| `NOT_FOUND_TASK` | 404 | Task does not exist | Check task ID |\n| `NOT_FOUND_COLUMN` | 404 | Column does not exist | Check column ID |\n| `NOT_FOUND_COMMENT` | 404 | Comment does not exist | Check comment ID |\n| `NOT_FOUND_INVITATION` | 404 | Invitation does not exist | Check invitation token |\n| `CONFLICT_EMAIL` | 409 | Email already registered | Use existing account or different email |\n| `CONFLICT_SLUG` | 409 | Workspace slug already taken | Choose different workspace name |\n| `CONFLICT_MEMBER` | 409 | User already a workspace member | No action needed |\n| `CONFLICT_INVITATION` | 409 | Pending invitation already exists | Use existing invitation |\n\n### Validation Errors (VALIDATION_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `VALIDATION_ERROR` | 400 | Request validation failed | Check `details` for specific field errors |\n| `VALIDATION_REQUIRED` | 400 | Required field missing | Provide required field |\n| `VALIDATION_FORMAT` | 400 | Field format invalid | Check field format requirements |\n| `VALIDATION_RANGE` | 400 | Value out of allowed range | Adjust value to valid range |\n| `VALIDATION_UNIQUE` | 400 | Value must be unique | Use different value |\n\n### Rate Limiting Errors (RATE_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `RATE_LIMITED` | 429 | Too many requests | Wait and retry after `Retry-After` header |\n| `RATE_LIMITED_AUTH` | 429 | Too many auth attempts | Wait before retrying login |\n| `RATE_LIMITED_API` | 429 | API rate limit exceeded | Reduce request frequency |\n\n### Business Logic Errors (BUSINESS_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `BUSINESS_WIP_LIMIT` | 400 | Column WIP limit reached | Move tasks out before adding |\n| `BUSINESS_LAST_ADMIN` | 400 | Cannot remove last admin | Assign another admin first |\n| `BUSINESS_SELF_INVITE` | 400 | Cannot invite yourself | Share invite with others |\n| `BUSINESS_INVITATION_EXPIRED` | 400 | Invitation has expired | Request new invitation |\n| `BUSINESS_INVITATION_USED` | 400 | Invitation already used | No action needed |\n\n### Server Errors (SERVER_*)\n\n| Code | HTTP | Description | Resolution |\n|------|------|-------------|------------|\n| `SERVER_ERROR` | 500 | Internal server error | Retry later, report if persistent |\n| `SERVER_UNAVAILABLE` | 503 | Service temporarily unavailable | Retry after delay |\n| `SERVER_TIMEOUT` | 504 | Request timed out | Retry with shorter operation |\n| `SERVER_DATABASE` | 500 | Database error | Retry later |\n| `SERVER_CACHE` | 500 | Cache service error | Request may still succeed |\n\n## Validation Error Details\n\nWhen `VALIDATION_ERROR` is returned, the `details` field contains field-specific errors:\n\n```json\n{\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Request validation failed\",\n    \"details\": {\n      \"fields\": {\n        \"email\": {\n          \"code\": \"VALIDATION_FORMAT\",\n          \"message\": \"Invalid email format\"\n        },\n        \"name\": {\n          \"code\": \"VALIDATION_REQUIRED\",\n          \"message\": \"Name is required\"\n        },\n        \"priority\": {\n          \"code\": \"VALIDATION_RANGE\",\n          \"message\": \"Priority must be one of: low, medium, high, urgent\"\n        }\n      }\n    },\n    \"requestId\": \"req_abc123\"\n  }\n}\n```\n\n## Error Handling Best Practices\n\n### Client-Side\n\n```typescript\nasync function apiRequest(endpoint: string, options: RequestInit) {\n  const response = await fetch(endpoint, options);\n\n  if (!response.ok) {\n    const error = await response.json();\n\n    switch (error.error.code) {\n      case 'AUTH_EXPIRED':\n        // Try to refresh token\n        await refreshToken();\n        return apiRequest(endpoint, options);\n\n      case 'AUTH_REQUIRED':\n      case 'AUTH_INVALID':\n      case 'AUTH_REVOKED':\n        // Redirect to login\n        redirectToLogin();\n        break;\n\n      case 'RATE_LIMITED':\n        // Wait and retry\n        const retryAfter = response.headers.get('Retry-After') || 60;\n        await sleep(retryAfter * 1000);\n        return apiRequest(endpoint, options);\n\n      case 'VALIDATION_ERROR':\n        // Show field-specific errors\n        showValidationErrors(error.error.details.fields);\n        break;\n\n      default:\n        // Show generic error\n        showError(error.error.message);\n    }\n\n    throw new ApiError(error.error);\n  }\n\n  return response.json();\n}\n```\n\n### Server-Side\n\n```typescript\n// Custom error classes\nclass AppError extends Error {\n  constructor(\n    public code: string,\n    public statusCode: number,\n    message: string,\n    public details?: object\n  ) {\n    super(message);\n  }\n}\n\nclass AuthError extends AppError {\n  constructor(code: string, message: string) {\n    super(code, 401, message);\n  }\n}\n\nclass NotFoundError extends AppError {\n  constructor(resource: string, id: string) {\n    super(`NOT_FOUND_${resource.toUpperCase()}`, 404, `${resource} not found`);\n  }\n}\n\n// Express error handler\nfunction errorHandler(err: Error, req: Request, res: Response, next: NextFunction) {\n  const requestId = req.id;\n\n  if (err instanceof AppError) {\n    return res.status(err.statusCode).json({\n      error: {\n        code: err.code,\n        message: err.message,\n        details: err.details,\n        requestId\n      }\n    });\n  }\n\n  // Log unexpected errors\n  logger.error({ err, requestId }, 'Unexpected error');\n\n  return res.status(500).json({\n    error: {\n      code: 'SERVER_ERROR',\n      message: 'An unexpected error occurred',\n      requestId\n    }\n  });\n}\n```\n\n## HTTP Status Code Mapping\n\n| Status | Error Codes |\n|--------|-------------|\n| 400 | `VALIDATION_*`, `BUSINESS_*`, `AUTH_OAUTH_*` |\n| 401 | `AUTH_*` (except OAUTH) |\n| 403 | `FORBIDDEN_*` |\n| 404 | `NOT_FOUND_*` |\n| 409 | `CONFLICT_*` |\n| 429 | `RATE_*` |\n| 500 | `SERVER_ERROR`, `SERVER_DATABASE`, `SERVER_CACHE` |\n| 503 | `SERVER_UNAVAILABLE` |\n| 504 | `SERVER_TIMEOUT` |\n",
        "structuredPatch": [],
        "originalFile": null
      }
    },
    {
      "timestamp": "2026-01-12T12:49:10.650Z",
      "event": "PreToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "completed",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "completed",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:49:10.656Z",
      "event": "PostToolUse",
      "tool": "TodoWrite",
      "input": {
        "todos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "completed",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "completed",
            "activeForm": "Creating References documentation"
          }
        ]
      },
      "result": {
        "oldTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "completed",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "in_progress",
            "activeForm": "Creating References documentation"
          }
        ],
        "newTodos": [
          {
            "content": "Create .c3 directory structure",
            "status": "completed",
            "activeForm": "Creating .c3 directory structure"
          },
          {
            "content": "Write ADR-000 Initial Architecture Decision",
            "status": "completed",
            "activeForm": "Writing ADR-000 Initial Architecture Decision"
          },
          {
            "content": "Create C3 Context Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Context Level documentation"
          },
          {
            "content": "Create C3 Container Level documentation",
            "status": "completed",
            "activeForm": "Creating C3 Container Level documentation"
          },
          {
            "content": "Create C3 Component Level documentation (Foundation + Features)",
            "status": "completed",
            "activeForm": "Creating C3 Component Level documentation"
          },
          {
            "content": "Create References documentation (shared patterns)",
            "status": "completed",
            "activeForm": "Creating References documentation"
          }
        ]
      }
    },
    {
      "timestamp": "2026-01-12T12:49:13.948Z",
      "event": "PreToolUse",
      "tool": "Bash",
      "input": {
        "command": "find .c3 -type f -name \"*.md\" | head -20 && echo \"---\" && wc -l .c3/*.md .c3/refs/*.md",
        "description": "List all C3 documentation files and line counts"
      }
    },
    {
      "timestamp": "2026-01-12T12:49:13.971Z",
      "event": "PostToolUse",
      "tool": "Bash",
      "input": {
        "command": "find .c3 -type f -name \"*.md\" | head -20 && echo \"---\" && wc -l .c3/*.md .c3/refs/*.md",
        "description": "List all C3 documentation files and line counts"
      },
      "result": {
        "stdout": ".c3/adr-000-initial-architecture.md\n.c3/c3-components.md\n.c3/c3-context.md\n.c3/refs/database-schema.md\n.c3/refs/error-codes.md\n.c3/refs/api-contracts.md\n.c3/c3-containers.md\n.c3/c3-architecture.md\n---\n   287 .c3/adr-000-initial-architecture.md\n    64 .c3/c3-architecture.md\n   770 .c3/c3-components.md\n   336 .c3/c3-containers.md\n   138 .c3/c3-context.md\n   800 .c3/refs/api-contracts.md\n   445 .c3/refs/database-schema.md\n   242 .c3/refs/error-codes.md\n  3082 total",
        "stderr": "",
        "interrupted": false,
        "isImage": false
      }
    }
  ],
  "judgment": {
    "pass": true,
    "score": 100,
    "expectations": [
      {
        "text": "ADR-000 exists and serves as the architectural blueprint",
        "pass": true,
        "reasoning": "ADR-000 exists at .c3/adr-000-initial-architecture.md with comprehensive content including status, context, decision rationale, technology stack, system boundaries, container architecture, module architecture, data architecture, real-time architecture, authentication flow, API design principles, directory structure, module dependencies, consequences, implementation phases, and references. It clearly serves as the architectural blueprint for TaskFlow."
      },
      {
        "text": "Context README describes TaskFlow's purpose and high-level architecture",
        "pass": true,
        "reasoning": "The c3-context.md file describes TaskFlow as a 'task management SaaS platform enabling small teams to collaborate on projects through shared task boards with real-time updates.' It includes system purpose, context diagram, actors (Team Member, Workspace Admin), external systems, core capabilities, quality attributes, tenant model, and security boundary - all providing comprehensive high-level architecture context."
      },
      {
        "text": "At least 3 containers are defined (frontend, API, database or similar)",
        "pass": true,
        "reasoning": "The c3-containers.md file defines 5 containers: c3-web (React SPA Web Application), c3-api (Express.js API Server), c3-workers (Background Workers with Bull), c3-db (PostgreSQL Database), and c3-cache (Redis). This exceeds the minimum requirement of 3 containers."
      },
      {
        "text": "Real-time/WebSocket considerations are documented",
        "pass": true,
        "reasoning": "Real-time features are extensively documented across multiple files. ADR-000 includes a dedicated 'Real-time Architecture' section with Socket.IO rooms, Redis pub/sub for scaling, and optimistic updates. c3-components.md has a full 'c3-realtime: Real-time Module' section. c3-containers.md documents WebSocket events. The api-contracts.md includes WebSocket Events section with connection, room joining, and task/presence events."
      },
      {
        "text": "Component placeholders exist for key features (auth, tasks, teams)",
        "pass": true,
        "reasoning": "The c3-components.md file defines comprehensive component placeholders for: c3-auth (Authentication Module), c3-tasks (Tasks Module), c3-workspaces (Workspaces/Teams Module), plus additional feature modules including c3-users, c3-boards, c3-comments, c3-notifications, and foundation modules like c3-tenancy, c3-database, c3-cache-module, and c3-realtime. Each has directory structures, responsibilities, and key interfaces defined."
      }
    ],
    "summary": "All expectations are fully met. The C3 onboarding created a comprehensive architectural blueprint with ADR-000 as the primary design artifact, detailed context documentation, 5 container definitions, extensive real-time/WebSocket documentation, and well-defined component placeholders for all key features."
  }
}