#!/usr/bin/env bash
#
# C3 SessionStart Hook
#
# Checks if .c3/README.md exists in the project.
# If exists: outputs JSON with additionalContext to inject harness into conversation
# If not: exits silently
#

set -uo pipefail

# Get project directory
PROJECT_DIR="${CLAUDE_PROJECT_DIR:-$(pwd)}"

# Check if .c3/README.md exists
if [[ -f "$PROJECT_DIR/.c3/README.md" ]]; then
    # Output JSON format for context injection
    cat << 'EOF'
{
  "hookSpecificOutput": {
    "hookEventName": "SessionStart",
    "additionalContext": "<c3-architecture-harness>\nThis project has C3 architecture documentation (.c3/).\n\n## C3 Agent Routing\n\n| Request Type | Agent | When to Use |\n|--------------|-------|-------------|\n| question | `c3-skill:c3-navigator` | \"where is X\", \"how does X work\", \"explain X\" |\n| change | `c3-skill:c3-orchestrator` | \"add component\", \"refactor X\", \"implement feature\" |\n| audit | `/c3` skill | \"audit architecture\", \"validate C3 docs\" |\n\n**IMPORTANT**: When user asks architecture questions or requests changes in a .c3 project, you MUST use the Task tool to spawn the appropriate agent BEFORE responding.\n</c3-architecture-harness>"
  }
}
EOF
fi

exit 0
