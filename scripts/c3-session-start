#!/usr/bin/env bash
#
# C3 SessionStart Hook
#
# Checks if .c3/README.md exists in the project.
# If exists: outputs harness message to activate C3 skill usage
# If not: exits silently
#
# For SessionStart hooks, stdout is added to context when exit code is 0.

set -uo pipefail

# Get project directory
PROJECT_DIR="${CLAUDE_PROJECT_DIR:-$(pwd)}"

# Check if .c3/README.md exists
if [[ -f "$PROJECT_DIR/.c3/README.md" ]]; then
    cat << 'EOF'
<c3-architecture-harness>
This project has C3 architecture documentation (.c3/).

## REQUIRED: Use C3 Agents for Architecture Work

**When user asks about architecture, code structure, or "where is X":**
→ Use agent: `c3-skill:c3-navigator` - Provides visual answers with diagrams

**When user asks to add, change, modify, refactor, or implement something:**
→ Use agent: `c3-skill:c3-orchestrator` - Guides through impact analysis with Socratic dialogue before ADR

**When user asks to audit, validate, or check C3 docs:**
→ Load skill: `/c3` - Run audit checks

## Why Agents Over Skills?

The c3-orchestrator agent provides:
- **Dedicated context** for token-efficient analysis
- **Parallel sub-agents** (analyzer, impact, patterns) for thorough understanding
- **Iterative refinement** until user has clarity
- **ADR with verification checklist** before any changes

## C3 Capabilities

- **Context (c3-0)**: System overview, actors, containers, external systems
- **Containers (c3-N)**: Component inventory, technology stack, linkages
- **Components (c3-NNN)**: Implementation details with code references
- **ADRs**: Architectural decision records with implementation plans
- **Refs**: Reusable patterns and conventions

## Commands Available

- `/c3` - Audit or adopt C3
- `/query` - Navigate architecture docs
- `/onboard` - Initial C3 setup

Use the appropriate agent BEFORE responding to architectural questions or change requests.
</c3-architecture-harness>
EOF
fi

exit 0
